<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.0.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"www.chenwj.cn","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="学习，坚持。">
<meta property="og:type" content="website">
<meta property="og:title" content="茄子的博客">
<meta property="og:url" content="http://www.chenwj.cn/page/4/index.html">
<meta property="og:site_name" content="茄子的博客">
<meta property="og:description" content="学习，坚持。">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="陈伟杰">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://www.chenwj.cn/page/4/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>茄子的博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="茄子的博客" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">茄子的博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">技术博客</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="tags fa-fw"></i>标签<span class="badge">68</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="th fa-fw"></i>分类<span class="badge">26</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="archive fa-fw"></i>归档<span class="badge">74</span></a>

  </li>
        <li class="menu-item menu-item-sitemap">

    <a href="/sitemap.xml" rel="section"><i class="sitemap fa-fw"></i>站点地图</a>

  </li>
        <li class="menu-item menu-item-commonweal">

    <a href="/404/" rel="section"><i class="heartbeat fa-fw"></i>公益 404</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.chenwj.cn/2018-10-24/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA-%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8%E4%B8%8E%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D%E7%AD%96%E7%95%A5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/favicon.ico">
      <meta itemprop="name" content="陈伟杰">
      <meta itemprop="description" content="学习，坚持。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="茄子的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018-10-24/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA-%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8%E4%B8%8E%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D%E7%AD%96%E7%95%A5/" class="post-title-link" itemprop="url">深入理解java虚拟机-垃圾收集器与内存分配策略</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-10-24 09:10:25" itemprop="dateCreated datePublished" datetime="2018-10-24T09:10:25+08:00">2018-10-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-08-21 01:03:09" itemprop="dateModified" datetime="2020-08-21T01:03:09+08:00">2020-08-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/jvm/" itemprop="url" rel="index"><span itemprop="name">jvm</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>17k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>16 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>java内存运行区域的各个部分，其中程序计数器、虚拟机栈、本地方法栈三个区域岁线程而生而灭；栈中的栈帧随着方法的进入和退出而有条不紊的执行和出栈和入栈操作，每一个帧栈中分配多少内存基本上在类的结构确定下来的时候就已经确定了，所以这些区域就不需要考虑垃圾回收。<br>而java堆和方法则不一样，一个接口中的多个实现类需要的内存可能不一样，一个方法中的多个分支需要的内存可能不一样，我们只有在程序处于运行期间才知道回创建那些对象，这些内存的分配都是动态的，垃圾收集器所关注的事这部分内存。</p>
<h1 id="对象存活判断算法"><a href="#对象存活判断算法" class="headerlink" title="对象存活判断算法"></a>对象存活判断算法</h1><h2 id="引用计数法"><a href="#引用计数法" class="headerlink" title="引用计数法"></a>引用计数法</h2><p>给对象添加一个引用计数器，每当有一个地方引用时加一，当引用失效时建议，为0时对象就不可以引用。优点是效率高，缺点是难以解决循环引用的问题。</p>
<p>例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * 循环引用的垃圾回收</span><br><span class="line"> *</span><br><span class="line"> * @author :  chen weijie</span><br><span class="line"> * @Date: 2018-10-24 9:20 AM</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class ForEachReferenceDemo &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public Object instance &#x3D; null;</span><br><span class="line">    private static final int _1MB &#x3D; 1024 * 1024;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;这个成员变量的唯一作用就是站点内存，一边在GC日志中可以看清楚是否被回收过</span><br><span class="line"></span><br><span class="line">    private byte[] bigSize &#x3D; new byte[2 * _1MB];</span><br><span class="line">    public static void testGC() &#123;</span><br><span class="line">        ForEachReferenceDemo objectA &#x3D; new ForEachReferenceDemo();</span><br><span class="line">        ForEachReferenceDemo objectB &#x3D; new ForEachReferenceDemo();</span><br><span class="line">        objectA.instance &#x3D; objectA;</span><br><span class="line">        objectB.instance &#x3D; objectB;</span><br><span class="line">        objectA &#x3D; null;</span><br><span class="line">        objectB &#x3D; null;</span><br><span class="line">        System.gc();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        testGC();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>由5263K-&gt;648K(19456K) 可以得知内存有回收，所以虚拟机回收的算法并不是使用引用计数算法。</p>
<h2 id="可达性分析算法"><a href="#可达性分析算法" class="headerlink" title="可达性分析算法"></a>可达性分析算法</h2><p>这个算法的基本思路就是通过称为GC Roots 的对象作为起点，从这些节点作为起点向下搜索，走过的路径称为引用链，当一个对象没有 与任何一用力按相连时，证明对象是不可达的。</p>
<ul>
<li>java语言中可以作为GC roots的对象包括以下几种：</li>
</ul>
<p>1.虚拟机栈（帧栈中的本地变量表）中引用的对象；<br>2.方法区中类静态变量属性引用的对象；<br>3.方法区中常量引用的对象；<br>4.本地方法栈中JNI（一般的native方法）引用的对象；</p>
<h2 id="再谈引用"><a href="#再谈引用" class="headerlink" title="再谈引用"></a>再谈引用</h2><p>一般的引用是指，reference类型的数据中存储的数值代表的是另外一块内存的起始地址；</p>
<p>细分引用：</p>
<p>1.强引用：代码中普遍存在，Object o = new Object() 。只要强引用存在，垃圾收集器永远不会回收掉被引用的对象；<br>2.软引用：有用但是非必须的，在系统将要发生内存溢出异常之前，将会把这些对象进行第二次回收；<br>3.弱引用：非必须对象，但是强度比弱引用更低，被弱引用关联的对象只能生存到下一次垃圾收集发生之前；<br>4.虚引用：最弱的，完全对垃圾收集不产生影响，只不过在垃圾收集器回收时收到一个系统通知；</p>
<h2 id="生存还是死亡"><a href="#生存还是死亡" class="headerlink" title="生存还是死亡"></a>生存还是死亡</h2><p>即使在可达性分析算法中不可达的对象，也并非是非死不可的。至少要经过两次标记。</p>
<p>当对象在进行可达性分析后发现对象没有与GC Roots相连时，它将会被进行一次标记和一次筛选。筛选的条件是该对象是否有必要执行finalize()方法，当对象没有覆盖finalize()方法或者finalize()方法已经被虚拟机调用过，这2种情况就是没有必要执行。</p>
<p>如果有必要执行finalize方法，那么对象就会被放置到F-Queen队列中。finalize是对象逃脱死亡的最后机会，只要在此期间重新与任何一个对象发生关联即可，这样他会逃脱回收。</p>
<h2 id="方法区回收"><a href="#方法区回收" class="headerlink" title="方法区回收"></a>方法区回收</h2><p>方法区（HotSpot虚拟机中的永久带）是没有垃圾收集的，因为他的垃圾收集效率远低于此。因为新生代中的垃圾收集一般可以回收70%-90%的空间。</p>
<p>方法区（永久带）的垃圾收集包括废弃常量和无用类。</p>
<h3 id="废弃常量回收"><a href="#废弃常量回收" class="headerlink" title="废弃常量回收"></a>废弃常量回收</h3><p>例如一个abc字符串已经进入了常量池中，但是系统没有任何一个String对象引用该字符串。</p>
<h3 id="无用类回收"><a href="#无用类回收" class="headerlink" title="无用类回收"></a>无用类回收</h3><p>满足以下三个条件：</p>
<p>1.该类的所有的实例都已经被回收，就是java堆中不存在该对象的实例；<br>2.加载该类的classLoader类已经被回收；<br>3.该类对应的java.lang.Class对象没有任何地方引用，无法再任何地方通过反射获取该类；</p>
<p>满足以上三个条件可以回收，但是类的回收需要对参数进行设置。</p>
<p>大量的使用反射，动态代理，CGLib等byteCode框架、动态生成JSP的以及OSGi这类频繁自定义classLoader的场景都需要虚拟机聚类类卸载的功能，保证永久带不会溢出；</p>
<h1 id="垃圾收集算法"><a href="#垃圾收集算法" class="headerlink" title="垃圾收集算法"></a>垃圾收集算法</h1><h2 id="标记清除算法（mark-Sweep）"><a href="#标记清除算法（mark-Sweep）" class="headerlink" title="标记清除算法（mark-Sweep）"></a>标记清除算法（mark-Sweep）</h2><p>首先标记需要回收的对象，标记完统一回收被标记的对象。不足：一是 效率问题，标记和清除效率都不高；二是 标记清除后会产生大量的不连续的内存空间，无法为较大的对象分配空间。</p>
<h2 id="复制算法（copying）"><a href="#复制算法（copying）" class="headerlink" title="复制算法（copying）"></a>复制算法（copying）</h2><p>为了解决效率问题，使用的复制算法，由于新生代的对象98%都是“朝生夕死”的，将内存区域划分为eden、from survivor、to survivor区 比例为8:1:1,每次回收都是将eden和一个survivor中的存活的对象复制到另一个survivor中。如果此时另一个survivor区域没有足够的空间时，将对象直接放到老年代。</p>
<p>很明显缺点就是：浪费空间以及当有大量对象需要复制时效率很低；一般新生代使用这种算法</p>
<h2 id="标记整理算法（mark-compact）"><a href="#标记整理算法（mark-compact）" class="headerlink" title="标记整理算法（mark-compact）"></a>标记整理算法（mark-compact）</h2><p>复制算法在对象存活率较高的情况下需要进行较多的复制，效率会变低。根据老年代的特点，有一种标记整理（mark-compact）算法，标记过程与标记清理算法一样，后续步骤不是直接清理回收对象，而是让存货对象向一段移动，然后清理端边以外的内存。</p>
<h2 id="分代收集算法"><a href="#分代收集算法" class="headerlink" title="分代收集算法"></a>分代收集算法</h2><p>当前虚拟机的收集算法都是用分代收集。 </p>
<p>新生代：新生代中每次垃圾收集时，都会有大批对象死去，只有少量存活，采用复制算法，只需要付出少量的存活对象的复制成本就可以完成收集；</p>
<p>老年代：老年代存活率比较高，没有额外的空间分配担保，必须使用’标记清理’或者’标记整理’算法回收；</p>
<h1 id="HotSpot的算法实现"><a href="#HotSpot的算法实现" class="headerlink" title="HotSpot的算法实现"></a>HotSpot的算法实现</h1><p>在GC的过程中不可以出现分析过程中对象引用关系还在不断变化的情况，该点不满足的话，准确性就无法保证，所有GC进行时都是需要停顿的（Stop the world）</p>
<p>当执行系统停下来后，并不需要一个不漏的检查完所有的执行上下文和全局引用位置，虚拟机是有办法知道哪些地方存放对象引用。在HotSpot的实现中是使用一组称为OopMap的结构来达到这个目的的。</p>
<h2 id="安全点"><a href="#安全点" class="headerlink" title="安全点"></a>安全点</h2><p>HotSpot没有为每条指令都生产OopMap，只有在特定的位置记录了这些信息，这些位置被称为安全点（safePoint）,即程序执行时并非在所有地方的都能停顿下来GC，只有到达安全点才会暂停。</p>
<p>有2种方式可以让线程停止到最近的安全点上停顿下来：抢占式中断和主动式中断。</p>
<ul>
<li>抢占式中断不需要线程的执行代码主动去配合，在GC发生时，首先所有线程中断，如果发现线程中断的地方不在安全点，让线程回复，让它跑到安全点上。几乎没有虚拟机采用抢占式中断来暂停线程从而响应GC事件</li>
<li>主动式中断的思想是当GC需要中断线程的时候，不直接对线程操作，仅仅简单设置一个标记，各个线程执行时主动去轮训这个标记，发现标记位真时就中断挂起。</li>
</ul>
<h2 id="安全区域"><a href="#安全区域" class="headerlink" title="安全区域"></a>安全区域</h2><p>safePoint似乎近乎完美的解决了如何进入GC的问题，但是如果线程处于Sleep或者blocked状态时，这时候线程无法响应JVM的重拳请求，走到安全的地方挂起，这就需要一个安全区域（safe region）来解决问题。</p>
<h1 id="垃圾收集器"><a href="#垃圾收集器" class="headerlink" title="垃圾收集器"></a>垃圾收集器</h1><p><img src="/images/jvm/HotSpot%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%9A%84%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8.png" alt="HotSpot虚拟机的垃圾收集器"></p>
<p>上图展示了HotSpot虚拟机的垃圾收集器，如果两个收集器之间存在连线，则说明他们可以搭配使用，所以你所处的区域咋代表他们属于新生代收集器还是老年代收集器。</p>
<p>虚拟机收集器没有最好的收集器，只有在某种场景下最适合的收集器。</p>
<h2 id="Serial收集器"><a href="#Serial收集器" class="headerlink" title="Serial收集器"></a>Serial收集器</h2><p>Serial收集器是最基本、历史最悠久的收集器，单线程收集器，</p>
<p>单线程收集器并不意味着它只会使用一个CPU或者一条收集线程去完成垃圾收集，重要的是GC时，必须暂停其它所有的工作线程，至到收集完成。</p>
<p>该收集器优点是：它是虚拟机运行在Client模式下的默认新生代收集器。简单而高效，因为对于单个CPU的环境说，Serial收集器由于没有线程交互的开销，他是最高效的。</p>
<p><img src="/images/jvm/Serial%E6%94%B6%E9%9B%86%E5%99%A8.png" alt="Serial收集器"></p>
<h2 id="ParNew收集器"><a href="#ParNew收集器" class="headerlink" title="ParNew收集器"></a>ParNew收集器</h2><p>ParNew收集器就是Serial收集器的多线程版本，使用多线程收集。</p>
<p><img src="/images/jvm/ParNew%E6%94%B6%E9%9B%86%E5%99%A8.png" alt="ParNew收集器"></p>
<p>它是运行在Server模式下的虚拟机中首选的新生代垃圾收集器，主要是因为除了Serial只有ParNew是CMS收集器一起使用的垃圾收集器。</p>
<p>ParNew收集器在单CPU的环境中没有Serial好。</p>
<ul>
<li>并行 是指多条垃圾收集线程并行工作。</li>
<li>并发 是指工作线程与垃圾收集线程同时执行（可以同时执行，可能是交替执行），用户线程在继续运行，而垃圾收集程序在另一个CPU上运行。</li>
</ul>
<h2 id="Parallel-Scavenge-收集器"><a href="#Parallel-Scavenge-收集器" class="headerlink" title="Parallel Scavenge 收集器"></a>Parallel Scavenge 收集器</h2><ul>
<li><p>Parallel Scavenge 收集器是一个新生代收集器，并行的多线程收集器，采用复制算法。这些和ParNew一样。它的关注点与其他收集器不同，CMS等收集器的关注点是尽可能的缩短用户线程的停顿时间，而Parallel Scavenge 收集器的目标则是到达一个可控的吞吐量。吞吐量= 运行用户代码时间/（运行用户代码时间+垃圾回收时间）</p>
</li>
<li><p>停顿时间越短就越适合需要与用户交互的程序，可以提高用体验。吞吐量则可以高效的利用CPU时间，尽快完成程序的运算任务，适合在后台运算不需要太多交互的任务。对于同一个垃圾回收器来说：吞吐量和响应时间是相斥的属性。</p>
</li>
</ul>
<h3 id="参数设置"><a href="#参数设置" class="headerlink" title="参数设置"></a>参数设置</h3><ul>
<li>Parallel Scavenge 收集器 使用两个参数用于控制吞吐量：</li>
</ul>
<ol>
<li>-XX:GCTimeRatio(直接设置吞吐量大小，默认99)、</li>
<li>-XX:MAXGCPauseMillis(最大垃圾收集停顿时间)</li>
</ol>
<p>由于与吞吐量关系密切，Parallel Scavenge收集器也经常称为“吞吐量优先”收集器。除上述两个参数之外，Parallel Scavenge收集器还有一个参数-XX：+UseAdaptiveSizePolicy值得关<br>注。这是一个开关参数，当这个参数打开之后，就不需要手工指定新生代的大小（-Xmn）、Eden与Survivor区的比例（-XX：SurvivorRatio）、晋升老年代对象年龄（-XX：<br>PretenureSizeThreshold）等细节参数了，虚拟机会根据当前系统的运行情况收集性能监控信息，动态调整这些参数以提供最合适的停顿时间或者最大的吞吐量，这种调节方式称为GC自适应的调节策略（GC Ergonomics）</p>
<h2 id="Serial-Old收集器"><a href="#Serial-Old收集器" class="headerlink" title="Serial Old收集器"></a>Serial Old收集器</h2><p>Serial Old是Serial收集器的老年代版本，它同样是一个单线程收集器，使用“标记-整理”算法。这个收集器的主要意义也是在于给Client模式下的虚拟机使用。</p>
<p>如果在Server模式下，那么它主要还有两大用途：一种用途是在JDK 1.5以及之前的版本中与Parallel Scavenge收集器搭配使用，另一种用途就是作为CMS收集器的后备预案，在并发收集发生Concurrent Mode Failure时使用</p>
<p><img src="/images/jvm/SerialOld%E6%94%B6%E9%9B%86%E5%99%A8.png" alt="SerialOld收集器"></p>
<h2 id="Parallel-Old收集器"><a href="#Parallel-Old收集器" class="headerlink" title="Parallel Old收集器"></a>Parallel Old收集器</h2><p>Parallel Old是Parallel Scavenge收集器的老年代版本，使用多线程和“标记-整理”算法。</p>
<p>![Parallel Old收集器与Parallel Scavenge收集器](/images/jvm/Parallel Old收集器与Parallel Scavenge收集器.png)</p>
<h2 id="CMS收集器"><a href="#CMS收集器" class="headerlink" title="CMS收集器"></a>CMS收集器</h2><h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h3><p>CMS（Concurrent Mark Sweep）收集器是一种以获取最短回收停顿时间为目标的收集器。基于“标记—清除”算法实现</p>
<h3 id="运行步骤"><a href="#运行步骤" class="headerlink" title="运行步骤"></a>运行步骤</h3><p>他的运行分为四个步骤：</p>
<ul>
<li>初始标记（CMS initial mark）：初始标记仅仅只是标记一下GC Roots能直接关联到的对象，速度很快；</li>
<li>并发标记（CMS concurrent mark）：并发标记阶段就是进行GC RootsTracing的过程；</li>
<li>重新标记（CMS remark）：重新标记阶段则是为了修正并发标记期间因用户程序继续运作而导致标记产生变动的那一部分对象的标记记录</li>
<li>并发清除（CMS concurrent sweep）：多个垃圾回收线程一起清除。</li>
</ul>
<p>整个过程中耗时最长的并发标记和并发清除过程收集器线程都可以与用户线程一起工作，所以用时很短。</p>
<p>![Concurrent Mark Sweep收集器运行示意图](/images/jvm/Concurrent Mark Sweep收集器运行示意图.png)</p>
<h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><ul>
<li>CMS收集器对CPU资源非常敏感，虽然不会导致用户线程停顿，但是会因为占用了一部分线程（或者说CPU资源）而导致应用程序变慢，总吞吐量会降低</li>
</ul>
<p>CMS默认启动的回收线程数是（CPU数量+3）/4，也就是当CPU在4个以上时，并发回收时垃圾收集线程不少于25%的CPU资源，并且随着CPU数量的增加而下降。但是当CPU不足4个（譬如2个）时，CMS对用户程序的影响就可能变得很大，如果本来CPU负载就比较大，还分出一半的运算能力去执行收集器线程，就<br>可能导致用户程序的执行速度忽然降低了50%，其实也让人无法接受</p>
<p>为了解决这种问题，使用了一种增量式并发器，就是在并发标记、清理的时候让GC线程、用户线程交替运行，尽量减少GC线程的独占资源的时间，这样整个垃圾收集的过程会更长，但对用户程序的影响就会显得少一些，也就是速度下降没有那么明显</p>
<ul>
<li>CMS收集器无法处理浮动垃圾（Floating  Garbage），可能出现“Concurrent  Mode Failure”失败而导致另一次Full GC的产生</li>
</ul>
<p>由于CMS并发清理阶段用户线程还在运行着，伴随程序运行自然就还会有新的垃圾不断产生，这一部分垃圾出现在标记过程之后，CMS无法在当次收集中处理掉它们，只好留待下一次GC时再清理掉。这一部分垃圾就称为“浮动垃圾”</p>
<p>在JDK  1.6中，CMS收集器的启动阈值已经提升至92%。要是CMS运行期间预留的内存无法满足程序需要，就会出现一次“Concurrent Mode Failure”失败，这时虚拟机将启动后备预案：临时启用Serial Old收集器来<br>重新进行老年代的垃圾收集，这样停顿时间就很长了。所以说参数-XX：CMSInitiatingOccupancyFraction设置得太高很容易导致大量“Concurrent Mode Failure”失败，性能反而降低。</p>
<ul>
<li>CMS是一款基于“标记—清除”算法实现的收集器，就可能想到这意味着收集结束时会有大量空间碎片产生，往往会出现老年代还有很大空间剩余，但是无法找到足够大的连续空间来分配当前对象，不得不提前触发一次FullGC</li>
</ul>
<p>两种解决方法：</p>
<ol>
<li>CMS收集器提供了一个-XX：+UseCMSCompactAtFullCollection开关参数（默认就是开启的），用于在CMS收集器顶不住要进行FullGC时开启内存碎片的合并整理过程，内存整理的过程是无法并发的，空间碎片问题没有了，但停顿时间不得不变长。</li>
<li>另外一个参数-XX：CMSFullGCsBeforeCompaction，这个参数是用于设置执行多少次不压缩的Full  GC后，跟着来一次带压缩的（默认值为0，表示每次进入Full GC时都进行碎片整理）</li>
</ol>
<h2 id="G1收集器"><a href="#G1收集器" class="headerlink" title="G1收集器"></a>G1收集器</h2><p>G1（Garbage-First）收集器是当今收集器技术发展的最前沿成果之一,G1是一款面向服务端应用的垃圾收集器。它的使命是替代CMS收集器。</p>
<h3 id="与CMS相比的特点："><a href="#与CMS相比的特点：" class="headerlink" title="与CMS相比的特点："></a>与CMS相比的特点：</h3><ul>
<li>并行与并发：G1能充分利用多CPU、多核环境下的硬件优势，使用多个CPU（CPU或者CPU核心）来缩短Stop-The-World停顿的时间，部分其他收集器原本需要停顿Java线程执行的GC动作，G1收集器仍然可以通过并发的方式让Java程序继续执行</li>
<li>分代收集：与其他收集器一样，分代概念在G1中依然得以保留。虽然G1可以不需要其他收集器配合就能独立管理整个GC堆，但它能够采用不同的方式去处理新创建的对象和已经存活了一段时间、熬过多次GC的旧对象以获取更好的收集效果。</li>
<li>空间整理：G1从整体上来看是基于‘标记-整理算法’，局部（两个region）来看，是基于复制算法来是实现的，无论如何，这两种算法都意味着G1运作期间不会产生内存空间碎片，收集后提供规整的可用内存。</li>
<li>可预测的停顿：G1除了追求停顿外，还能建立可预测的停顿时间模型，可以让使用者在一个长度M毫秒的时间段内消耗在垃圾收集上的时间不超过N毫秒。</li>
</ul>
<h3 id="详细描述"><a href="#详细描述" class="headerlink" title="详细描述"></a>详细描述</h3><p>使用G1收集器时，Java堆的内存布局就与其他收集器有很大差别，它将整个Java堆划分为多个大小相等的独立区域（Region），虽然还保留有新生代和老年代的概念，但新生代和老年代不再是物理隔离的了，它们都是一部分Region（不需要连续）的集合</p>
<p>G1收集器之所以能建立可预测的停顿时间模型，是因为它可以有计划地避免在整个Java堆中进行全区域的垃圾收集。G1跟踪各个Region里面的垃圾堆积的价值大小（回收所获得的空间大小以及回收所需时间的经验值），在后台维护一个优先列表，每次根据允许的收集时<br>间，优先回收价值最大的Region（这也就是Garbage-First名称的来由）。这种使用Region划分内存空间以及有优先级的区域回收方式，保证了G1收集器在有限的时间内可以获取尽可能高的收集效率</p>
<p>在G1收集器中，Region之间的对象引用以及其他收集器中的新生代与老年代之间的对象引用，虚拟机都是使用Remembered Set来避免全堆扫描的</p>
<h3 id="运行步骤-1"><a href="#运行步骤-1" class="headerlink" title="运行步骤"></a>运行步骤</h3><ul>
<li>初始标记（Initial Marking） ：与CMS相同</li>
<li>并发标记（Concurrent Marking）：并发标记阶段是从GC Root开始对堆中对象进行可达性分析，找出存活的对象，这阶段耗时较长，但可与用户程序并发执行</li>
<li>最终标记（Final Marking）：是为了修正在并发标记期间因用户程序继续运作而导致标记产生变动的那一部分标记记录，虚拟机将这段时间对象变化记录在线程Remembered Set Logs里面，最终标记阶段需要把Remembered Set Logs的数据合并到Remembered Set</li>
<li>筛选回收（Live Data Counting and Evacuation）：首先对各个Region的回收价值和成本进行排序，根据用户所期望的GC停顿时间来制定回收计划</li>
</ul>
<p><img src="/images/jvm/G1%E6%94%B6%E9%9B%86%E5%99%A8%E7%9A%84%E8%BF%90%E8%A1%8C%E7%A4%BA%E6%84%8F%E5%9B%BE.png" alt="G1收集器的运行示意图"></p>
<p>如果你现在采用的收集器没有出现问题，那就没有任何理由现在去选择G1，如果你的应用追求低停顿，那G1现在已经可以作为一个可尝试的选择，如果你的应用追求吞吐量，那G1并不会为你带来什么特别的好处</p>
<h1 id="GC日志的理解"><a href="#GC日志的理解" class="headerlink" title="GC日志的理解"></a>GC日志的理解</h1><ul>
<li>典型的日志1</li>
</ul>
<p><img src="/images/jvm/JVM%E6%97%A5%E5%BF%971.png" alt="JVM日志1"></p>
<p>最前面的数字“33.125：”和“100.667：”代表了GC发生的时间，这个数字的含义是从Java虚拟机启动以来经过的秒数</p>
<p>GC日志开头的“[GC”和“[Full  GC”说明了这次垃圾收集的停顿类型，如果有“Full”，说明这次GC是发生了Stop-The-World的。</p>
<p><img src="/images/jvm/ParNew%E6%97%A5%E5%BF%97%E4%B9%9F%E4%BC%9A%E4%BA%A7%E7%94%9FfullGC%E6%97%A5%E5%BF%97.png" alt="ParNew日志也会产生fullGC日志"><br>这段新生代收集器ParNew的日志也会出现“[Full GC”（这一般是因为出现了分配担保失败之类的问题，所以才导致STW）。</p>
<p>如果是调用System.gc（）方法所触发的收集，那么在这里将显示“[Full GC（System）”</p>
<p>接下来的“[DefNew”、“[Tenured”、“[Perm”表示GC发生的区域，这里显示的区域名称与使用的GC收集器是密切相关的。<br>例如上面样例所使用的Serial收集器中的新生代名为“Default New  Generation”，所以显示的是“[DefNew”。<br>如果是ParNew收集器，新生代名称就会变为“[ParNew”，意为“Parallel New Generation”。<br>如果采用Parallel Scavenge收集器，那它配套的新生代称为“PSYoungGen”，老年代和永久代同理，名称也是由收集器决定的。</p>
<p>后面方括号内部的“3324K-＞152K（3712K）”含义是“GC前该内存区域已使用容量-＞GC后该内存区域已使用容量（该内存区域总容量）”。而在方括号之外的“3324K-＞<br>152K（11904K）”表示“GC前Java堆已使用容量-＞GC后Java堆已使用容量（Java堆总容量）”。再往后，“0.0025925 secs”表示该内存区域GC所占用的时间，单位是秒。<br>有的收集器会给出更具体的时间数据，如“[Times：user=0.01 sys=0.00，real=0.02 secs]”，这里面的user、sys和real与Linux的time命令所输出的时间含义一致，分别代表用户态消耗的CPU时间、内核<br>态消耗的CPU事件和操作从开始到结束所经过的墙钟时间（Wall Clock Time）。</p>
<ul>
<li>典型的日志2</li>
</ul>
<p>程序运行时配置如下参数:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">-Xms20M -Xmx20M -Xmn10M -verbose:gc -XX:+PrintGCDetails -XX:SurvivorRatio&#x3D;8 -XX:+PrintGCTimeStamps</span><br><span class="line">最终，程序输出：</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">0.070: [GC (Allocation Failure) [PSYoungGen: 7127K-&gt;616K(9216K)] 11223K-&gt;4720K(19456K), 0.0008663 secs] [Times: user&#x3D;0.00 sys&#x3D;0.00, real&#x3D;0.00 secs] </span><br><span class="line">0.072: [GC (Allocation Failure) --[PSYoungGen: 6923K-&gt;6923K(9216K)] 11027K-&gt;15123K(19456K), 0.0016749 secs] [Times: user&#x3D;0.02 sys&#x3D;0.00, real&#x3D;0.00 secs] </span><br><span class="line">0.073: [Full GC (Ergonomics) [PSYoungGen: 6923K-&gt;0K(9216K)] [ParOldGen: 8200K-&gt;6660K(10240K)] 15123K-&gt;6660K(19456K), [Metaspace: 2559K-&gt;2559K(1056768K)], 0.0044663 secs] [Times: user&#x3D;0.00 sys&#x3D;0.00, real&#x3D;0.00 secs] </span><br><span class="line">Heap</span><br><span class="line"> PSYoungGen      total 9216K, used 4404K [0x00000000ff600000, 0x0000000100000000, 0x0000000100000000)</span><br><span class="line">  eden space 8192K, 53% used [0x00000000ff600000,0x00000000ffa4d1a0,0x00000000ffe00000)</span><br><span class="line">  from space 1024K, 0% used [0x00000000ffe00000,0x00000000ffe00000,0x00000000fff00000)</span><br><span class="line">  to   space 1024K, 0% used [0x00000000fff00000,0x00000000fff00000,0x0000000100000000)</span><br><span class="line"> ParOldGen       total 10240K, used 6660K [0x00000000fec00000, 0x00000000ff600000, 0x00000000ff600000)</span><br><span class="line">  object space 10240K, 65% used [0x00000000fec00000,0x00000000ff281398,0x00000000ff600000)</span><br><span class="line"> Metaspace       used 2565K, capacity 4486K, committed 4864K, reserved 1056768K</span><br><span class="line">  class space    used 281K, capacity 386K, committed 512K, reserved 1048576K</span><br></pre></td></tr></table></figure>

<p>GC日志分析：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1、最前面的数字 &quot;0,070&quot; 代表了GC发生的时间，这个数字的含义是从Java虚拟机启动以来经过的秒数</span><br><span class="line">2、GC日志开头的“[GC 和 [Full GC” 说明了这次垃圾收集的停顿类型，而不是用来区分新生代GC还是年老代GC的。</span><br><span class="line">3、PSYoungGen, ParOldGen，PSPermGen表示GC发生的区域，这里显示的区域名称与使用的GC收集器密切相关，不同收集器对于不同区域所显示的名称可能不同。</span><br><span class="line">4、后面方括号内部的 “ 7127K-&gt;616K(9216K) ”含义是“GC前该内存区域已使用容量 -&gt; GC后该内存区域已使用容量（该内存区域总容量）”。方括号之外的 11223K-&gt;4720K(19456K) 表示GC前java堆已使用容量 -&gt; GC后java堆已使用容量(Java堆总容量)</span><br><span class="line">5、0.0008663 secs表示该内存区域GC所占用的时间，单位是秒。</span><br><span class="line">6、[Times: user&#x3D;0.00 sys&#x3D;0.00, real&#x3D;0.00 secs] 这里面的user、sys、和real与Linux的time命令所输出的时间含义一致。分别代表用户消耗的CPU时间，内存态消耗的CPU时间，和操作从开始到结束所经过的墙钟时间。</span><br></pre></td></tr></table></figure>

<p>JVM的GC日志的主要参数包括如下几个：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-XX:+PrintGC 输出GC日志</span><br><span class="line">-XX:+PrintGCDetails 输出GC的详细日志</span><br><span class="line">-XX:+PrintGCTimeStamps 输出GC的时间戳（以基准时间的形式）</span><br><span class="line">-XX:+PrintGCDateStamps 输出GC的时间戳（以日期的形式，如 2013-05-04T21:53:59.234+0800）</span><br><span class="line">-XX:+PrintHeapAtGC 在进行GC的前后打印出堆的信息</span><br><span class="line">-XX:+PrintGCApplicationStoppedTime &#x2F;&#x2F; 输出GC造成应用暂停的时间</span><br><span class="line">-Xloggc:..&#x2F;logs&#x2F;gc.log 日志文件的输出路径</span><br></pre></td></tr></table></figure>
<h1 id="垃圾收集器参数的总结"><a href="#垃圾收集器参数的总结" class="headerlink" title="垃圾收集器参数的总结"></a>垃圾收集器参数的总结</h1><p><img src="/images/jvm/%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8%E5%8F%82%E6%95%B01.png" alt="垃圾收集器参数1"><br><img src="/images/jvm/%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8%E5%8F%82%E6%95%B02.png" alt="垃圾收集器参数2"></p>
<h1 id="内存分配与回收策略"><a href="#内存分配与回收策略" class="headerlink" title="内存分配与回收策略"></a>内存分配与回收策略</h1><p>对象的内存分配，对象主要分配在新生代的Eden区上，如果启动了本地线程分配缓冲，将按线程优先在TLAB上分配。<br>少数情况下也可能会直接分配在老年代中，分配的规则并不是百分之百固定的，其细节取决于当前使用的是哪一种垃圾收集器组合，还有虚拟机中与内存相关的参数的设置。</p>
<p>以下的虚拟机使用的是在Parallel Scavenge/Parallel Old收集器下的分配策略。</p>
<h2 id="对象优先在Eden分配"><a href="#对象优先在Eden分配" class="headerlink" title="对象优先在Eden分配"></a>对象优先在Eden分配</h2><p>大多数情况下，对象在新生代Eden区中分配。当Eden区没有足够空间进行分配时，虚拟机将发起一次Minor GC。</p>
<p>虚拟机提供了-XX：+PrintGCDetails这个收集器日志参数，告诉虚拟机在发生垃圾收集行为时打印内存回收日志，并且在进程退出的时候输出当前的内存各区域分配情况。</p>
<p>例子1</p>
<p>以下代码尝试分配3个2MB大小和1个4MB大小的对象，在运行时通过-Xms20M、-Xmx20M、-Xmn10M这3个参数限制了Java堆大小为20MB，不可扩<br>展，其中10MB分配给新生代，剩下的10MB分配给老年代。-XX：SurvivorRatio=8决定了新生代中Eden区与一个Survivor区的空间比例是8:1，从输出的结果也可以清晰地看到“eden<br>space  8192K、from  space  1024K、to  space  1024K”的信息，新生代总可用空间为9216KB（Eden区+1个Survivor区的总容量）</p>
<ul>
<li><p>新生代GC（Minor GC）：指发生在新生代的垃圾收集动作，因为Java对象大多都具备朝生夕灭的特性，所以Minor GC非常频繁，一般回收速度也比较快。</p>
</li>
<li><p>老年代GC（Major GC/Full GC）：指发生在老年代的GC，出现了Major GC，经常会伴随至少一次的Minor GC（但非绝对的，在Parallel Scavenge收集器的收集策略里就有直接进行<br>Major GC的策略选择过程）。Major GC的速度一般会比Minor GC慢10倍以上。</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * VM参数：-verbose：gc -Xms20M-Xmx20M-Xmn10M-XX：+PrintGCDetails</span><br><span class="line"> * -XX：SurvivorRatio&#x3D;8</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class MinorGCTest &#123;</span><br><span class="line">    private static final int _1MB &#x3D; 1024 * 1024;</span><br><span class="line">    public static void testAllocation() &#123;</span><br><span class="line">        byte[] allocation1, allocation2, allocation3, allocation4;</span><br><span class="line">        allocation1 &#x3D; new byte[2 * _1MB];</span><br><span class="line">        allocation2 &#x3D; new byte[2 * _1MB];</span><br><span class="line">        allocation3 &#x3D; new byte[2 * _1MB];</span><br><span class="line">        allocation4 &#x3D; new byte[2 * _1MB]; &#x2F;&#x2F;出现一次minor GC</span><br><span class="line">    &#125;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        testAllocation();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[GC [PSYoungGen: 7311K-&gt;632K(9216K)] 7311K-&gt;6776K(19456K), 0.0093838 secs] [Times: user&#x3D;0.03 sys&#x3D;0.00, real&#x3D;0.01 secs] </span><br><span class="line">[Full GC [PSYoungGen: 632K-&gt;0K(9216K)] [ParOldGen: 6144K-&gt;6656K(10240K)] 6776K-&gt;6656K(19456K) [PSPermGen: 2752K-&gt;2751K(21504K)], 0.0385372 secs] [Times: user&#x3D;0.05 sys&#x3D;0.00, real&#x3D;0.04 secs] </span><br><span class="line">Heap</span><br><span class="line"> PSYoungGen      total 9216K, used 2213K [0x00000000ff600000, 0x0000000100000000, 0x0000000100000000)</span><br><span class="line">  eden space 8192K, 27% used [0x00000000ff600000,0x00000000ff829788,0x00000000ffe00000)</span><br><span class="line">  from space 1024K, 0% used [0x00000000ffe00000,0x00000000ffe00000,0x00000000fff00000)</span><br><span class="line">  to   space 1024K, 0% used [0x00000000fff00000,0x00000000fff00000,0x0000000100000000)</span><br><span class="line"> ParOldGen       total 10240K, used 6656K [0x00000000fec00000, 0x00000000ff600000, 0x00000000ff600000)</span><br><span class="line">  object space 10240K, 65% used [0x00000000fec00000,0x00000000ff280040,0x00000000ff600000)</span><br><span class="line"> PSPermGen       total 21504K, used 2758K [0x00000000f9a00000, 0x00000000faf00000, 0x00000000fec00000)</span><br><span class="line">  object space 21504K, 12% used [0x00000000f9a00000,0x00000000f9cb18c0,0x00000000faf00000)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="大对象直接进入老年代"><a href="#大对象直接进入老年代" class="headerlink" title="大对象直接进入老年代"></a>大对象直接进入老年代</h2><p>所谓的大对象是指，需要大量连续内存空间的Java对象，最典型的大对象就是那种很长的字符串以及数组（笔者列出的例子中的byte[]数组就是典型的大对象）。大对象对虚拟机<br>的内存分配来说就是一个坏消息（替Java虚拟机抱怨一句，比遇到一个大对象更加坏的消息就是遇到一群“朝生夕灭”的“短命大对象”，写程序的时候应当避免），经常出现大对象容易<br>导致内存还有不少空间时就提前触发垃圾收集以获取足够的连续空间来“安置”它们</p>
<p>虚拟机提供了一个-XX：PretenureSizeThreshold参数，令大于这个设置值的对象直接在老年代分配。这样做的目的是避免在Eden区及两个Survivor区之间发生大量的内存复制.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * VM参数：-verbose：gc-Xms20M-Xmx20M-Xmn10M-XX：+PrintGCDetails-XX：SurvivorRatio&#x3D;8</span><br><span class="line"> * -XX：PretenureSizeThreshold&#x3D;3145728</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class BigObjectGCDemo &#123;</span><br><span class="line">    private static final int _1MB &#x3D; 1024 * 1024;</span><br><span class="line">    public static void testPretenureSizeThreshold() &#123;</span><br><span class="line">        byte[] allocation;</span><br><span class="line">        &#x2F;&#x2F;直接分配在老年代中</span><br><span class="line">        allocation &#x3D; new byte[4 * _1MB];</span><br><span class="line">    &#125;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        testPretenureSizeThreshold();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> PSYoungGen      total 9216K, used 5263K [0x00000000ff600000, 0x0000000100000000, 0x0000000100000000)</span><br><span class="line">  eden space 8192K, 64% used [0x00000000ff600000,0x00000000ffb23c70,0x00000000ffe00000)</span><br><span class="line">  from space 1024K, 0% used [0x00000000fff00000,0x00000000fff00000,0x0000000100000000)</span><br><span class="line">  to   space 1024K, 0% used [0x00000000ffe00000,0x00000000ffe00000,0x00000000fff00000)</span><br><span class="line"> ParOldGen       total 10240K, used 0K [0x00000000fec00000, 0x00000000ff600000, 0x00000000ff600000)</span><br><span class="line">  object space 10240K, 0% used [0x00000000fec00000,0x00000000fec00000,0x00000000ff600000)</span><br><span class="line"> PSPermGen       total 21504K, used 2759K [0x00000000f9a00000, 0x00000000faf00000, 0x00000000fec00000)</span><br><span class="line">  object space 21504K, 12% used [0x00000000f9a00000,0x00000000f9cb1c28,0x00000000faf00000)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>PretenureSizeThreshold参数只对Serial和ParNew两款收集器有效，Parallel  Scavenge收集器不认识这个参数，Parallel  Scavenge收集器一般并不需要设置</p>
<h2 id="长期存活的对象将进入老年代"><a href="#长期存活的对象将进入老年代" class="headerlink" title="长期存活的对象将进入老年代"></a>长期存活的对象将进入老年代</h2><p>虚拟机给每个对象定义了一个对象年龄（Age）计数器。如果对象在Eden出生并经过第一次Minor GC后仍然存活，并且能被Survivor容纳的话，将被移动到Survivor空间中，并且对象年龄设为1。对象在Survivor区中<br>每“熬过”一次Minor GC，年龄就增加1岁，当它的年龄增加到一定程度（默认为15岁），就将会被晋升到老年代中。对象晋升老年代的年龄阈值，可以通过参数-XX：MaxTenuringThreshold设置</p>
<p>代码实例:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> -verbose:gc</span><br><span class="line"> -Xms20M</span><br><span class="line"> -Xmx20M</span><br><span class="line"> -Xmn10M</span><br><span class="line"> -XX:PrintGCDetails</span><br><span class="line"> -XX:SurvivorRatio&#x3D;8</span><br><span class="line"> -XX:MaxTenuringThreadshold&#x3D;1</span><br><span class="line"> -XX:+PrintTenuringDistribution</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class LongExistsObjectDemo &#123;</span><br><span class="line">    private static final int _1MB &#x3D; 1024 * 1024;</span><br><span class="line">    public static void testTenuringThreshold() &#123;</span><br><span class="line">        byte[] allocation1, allocation2, allocation3;</span><br><span class="line">        allocation1 &#x3D; new byte[_1MB &#x2F; 4];</span><br><span class="line">        &#x2F;&#x2F;什么时候进入老年代取决于XX：MaxTenuringThreshold设置</span><br><span class="line">        allocation2 &#x3D; new byte[4 * _1MB];</span><br><span class="line">        allocation3 &#x3D; new byte[4 * _1MB];</span><br><span class="line">        allocation3 &#x3D; null;</span><br><span class="line">        allocation3 &#x3D; new byte[4 * _1MB];</span><br><span class="line">    &#125;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        testTenuringThreshold();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>输入日志：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Heap</span><br><span class="line"> PSYoungGen      total 9216K, used 5683K [0x00000000ff600000, 0x0000000100000000, 0x0000000100000000)</span><br><span class="line">  eden space 8192K, 69% used [0x00000000ff600000,0x00000000ffb8ccc0,0x00000000ffe00000)</span><br><span class="line">  from space 1024K, 0% used [0x00000000fff00000,0x00000000fff00000,0x0000000100000000)</span><br><span class="line">  to   space 1024K, 0% used [0x00000000ffe00000,0x00000000ffe00000,0x00000000fff00000)</span><br><span class="line"> ParOldGen       total 10240K, used 8192K [0x00000000fec00000, 0x00000000ff600000, 0x00000000ff600000)</span><br><span class="line">  object space 10240K, 80% used [0x00000000fec00000,0x00000000ff400020,0x00000000ff600000)</span><br><span class="line"> PSPermGen       total 21504K, used 2759K [0x00000000f9a00000, 0x00000000faf00000, 0x00000000fec00000)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="动态对象年龄判定"><a href="#动态对象年龄判定" class="headerlink" title="动态对象年龄判定"></a>动态对象年龄判定</h2><p>为了能更好地适应不同程序的内存状况，虚拟机并不是永远地要求对象的年龄必须达到了MaxTenuringThreshold才能晋升老年代，如果在Survivor空间中相同年龄所有对象大小的总<br>和大于Survivor空间的一半，年龄大于或等于该年龄的对象就可以直接进入老年代，无须等到MaxTenuringThreshold中要求的年龄。</p>
<h2 id="空间分配担保"><a href="#空间分配担保" class="headerlink" title="空间分配担保"></a>空间分配担保</h2><p>在发生Minor GC之前，虚拟机会先检查老年代最大可用的连续空间是否大于新生代所有对象总空间，如果这个条件成立，那么Minor GC可以确保是安全的。如果不成立，则虚拟机会查看HandlePromotionFailure设置值是否允许担保失败。如果允许，那么会继续检查老年代最大可用的连续空间是否大于历次晋升到老年代对象的平均大小，如果大于，将尝试着进行<br>一次Minor GC，尽管这次Minor GC是有风险的；如果小于，或者HandlePromotionFailure设置不允许冒险，那这时也要改为进行一次Full GC。</p>
<p>新生代使用复制收集算法，但为了内存利用率，只使用其中一个Survivor空间来作为轮换备份，因此当出现大量对象在MinorGC后仍然存活的情况（最极端的情况就是内存回收后新生代中所有对象都存活），就需要老年代进行分配担保，把Survivor无法容纳的对象直接进入老年代。与生活中的贷款担保类<br>似，老年代要进行这样的担保，前提是老年代本身还有容纳这些对象的剩余空间，一共有多少对象会活下来在实际完成内存回收之前是无法明确知道的，所以只好取之前每一次回收晋升到老年代对象容量的平均大小值作为经验值，与老年代的剩余空间进行比较，决定是否进行Full GC来让老年代腾出更多空间。</p>
<p>如果某次Minor GC存活后的对象突增，远远高于平均值的话，依然会导致担保失败（Handle Promotion Failure）。如果出现了HandlePromotionFailure失败，那就只好在失败后重新发起一次Full GC。虽然担保失败时绕的圈子是最大的，但大部分情况下都还是会将HandlePromotionFailure开关打开，避免Full GC过于频繁。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.chenwj.cn/2018-10-18/JVM%E8%B0%83%E4%BC%98%E6%80%BB%E7%BB%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/favicon.ico">
      <meta itemprop="name" content="陈伟杰">
      <meta itemprop="description" content="学习，坚持。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="茄子的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018-10-18/JVM%E8%B0%83%E4%BC%98%E6%80%BB%E7%BB%93/" class="post-title-link" itemprop="url">JVM调优总结</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-10-18 23:35:04" itemprop="dateCreated datePublished" datetime="2018-10-18T23:35:04+08:00">2018-10-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-08-21 01:03:09" itemprop="dateModified" datetime="2020-08-21T01:03:09+08:00">2020-08-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JVM/" itemprop="url" rel="index"><span itemprop="name">JVM</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>9.7k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>9 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="堆大小设置"><a href="#堆大小设置" class="headerlink" title="堆大小设置"></a>堆大小设置</h1><p>对于32位的系统，一般限制在1.5-2G；64位操作系统对内存无限制。</p>
<h2 id="典型设置"><a href="#典型设置" class="headerlink" title="典型设置"></a>典型设置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">java -Xmx3550m -Xms3550m -Xmn2g -Xss128k</span><br><span class="line"></span><br><span class="line">java -Xmx3550m -Xms3550m -Xss128k -XX:NewRatio&#x3D;4 -XX:SurvivorRatio&#x3D;4 -XX:MaxPermSize&#x3D;16m -XX:MaxTenuringThreshold&#x3D;0</span><br><span class="line"></span><br><span class="line">-Xmx3550M 最大堆内存</span><br><span class="line">-Xms3550M 初始内存</span><br><span class="line">-Xmn2G    年轻代内存 这个JVM的大小&#x3D;年轻代大小+年老代的大小+持久代的大小，持久代一般固定为64M，年轻代越大就会减小年老代的大小，此值对系统的性能影响较大，sun官方推荐配置为整个对的3&#x2F;8</span><br><span class="line">-Xss128K  线程栈的大小 设置每个线程栈的大小。jdk5以后每个线程堆栈的大小为1M，以前每个线程栈的大小为256k</span><br><span class="line">-XX:NewRatio&#x3D;4 设置年轻代（包括Eden和Survivor）与老年代的比值（除去持久代）。设置为4 则年轻代与老年代所占比值为1:4，年轻代占整个堆栈的1&#x2F;5</span><br><span class="line">-XX:SurvivorRatio&#x3D;4 设置年轻代中的Eden与Survivor区的大小比值。设置为4，则两个Survivor与一个Eden区的比值为2:4，一个Survivor区占整个年轻代的1&#x2F;6</span><br><span class="line">-XX:MaxPermSize&#x3D;16M 设置持久代的大小为16M</span><br><span class="line">-XX:MaxtenuringThreshold&#x3D;0 设置垃圾最大年龄。如果设置为0的话，则年轻代对象不经过Survivor区直接进入年老代。对于年老代比较多的应用，则可以提高效率。如果设置一个较大值，则年轻对象则会在Survivor区进行多次复制，则可以增加对象在年轻代的存活时间。</span><br></pre></td></tr></table></figure>
<h1 id="回收器选择"><a href="#回收器选择" class="headerlink" title="回收器选择"></a>回收器选择</h1><p>JVM给了三种选择：串行收集器/并行收集器/并发收集器。但是串行收集器只适用于小数据量的情况，所以这里的选择主要针对并行收集器和并发收集器。默认情况下，JDK5.0以前都是使用串行收集器，如果想使用其他收集器需要在启动时加入相应参数。JDK5.0以后，JVM会根据当前系统配置进行判断。</p>
<h2 id="吞吐量优先的并行收集器"><a href="#吞吐量优先的并行收集器" class="headerlink" title="吞吐量优先的并行收集器"></a>吞吐量优先的并行收集器</h2><p>并行收集器主要以到达一定的吞吐量为目标，适用于科学技术和后台处理等</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">java -Xmx3800m -Xms3800m -Xmn2g -Xss128k -XX:+UseParallelGC -XX:ParallelGCThreads&#x3D;20</span><br><span class="line">-XX:+UseParallelGC:选择垃圾收集器为并行收集器。此配置仅对年轻代有效。即上述配置下，年轻代使用并行收集器，老年代使用串行收集器</span><br><span class="line">-XX：ParallelGCThreads&#x3D;20：配置并行收集器的线程数，即同时多少个线程一起并行垃圾回收。此值最好与处理器数目相等。</span><br><span class="line"></span><br><span class="line">java -Xmx3550m -Xms3550m -Xmn2g -Xss128k -XX:+UseParallelGC -XX:ParallelGCThreads&#x3D;20 -XX:+UseParallelOldGC</span><br><span class="line">-XX:+UseParallelOldGC 配置年老代垃圾收集方式为并行收集。JDK6支持对年老代并行收集</span><br><span class="line"></span><br><span class="line">java -Xmx3550m -Xms3550m -Xmn2g -Xss128k -XX:+UseParallelGC  -XX:MaxGCPauseMillis&#x3D;100</span><br><span class="line">-XX:+MaxGCPauseMillis&#x3D;100:设置年轻代垃圾回收的最长时间，如果无法满足此时间，JVM会自动调整年轻代的大小，以蛮子此值。</span><br><span class="line"></span><br><span class="line">java -Xmx3550m -Xms3550m -Xmn2g -Xss128k -XX:+UseParallelGC  -XX:MaxGCPauseMillis&#x3D;100 -XX:+UseAdaptiveSizePolicy</span><br><span class="line">-XX:+UseAdaptiveSizePolicy:设置此值后，并行收集器会自动选择年轻代区大小和相应的Survivor区比例，以达到目标系统规定的最低相应时间和收集频率，此值建议使用并行收集器时，一直打开。</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="响应时间有限的并发收集器"><a href="#响应时间有限的并发收集器" class="headerlink" title="响应时间有限的并发收集器"></a>响应时间有限的并发收集器</h2><p>并发收集器主要是保证系统的响应时间，减少垃圾收集时的停顿时间。适用于应用服务器、电信领域等。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">java -Xmx3550m -Xms3550m -Xmn2g -Xss128k -XX:ParallelGCThreads&#x3D;20 -XX:+UseConcMarkSweepGC -XX:+UseParNewGC</span><br><span class="line">-XX:+UseConcMarkSweepGC 设置老年代为并发收集，配置这个以后 -XX:NewRatio&#x3D;4的配置失效了，原因不明。所以此时年轻代大小最好使用-Xmn设置</span><br><span class="line">-XX:+UseParNewGC 设置年轻代为并行收集。可与CMS收集同时使用。JDK5以上，JVM会根据系统设置自行配置，无需设置此值。</span><br><span class="line"></span><br><span class="line">java -Xmx3550m -Xms3550m -Xmn2g -Xss128k -XX:+UseConcMarkSweepGC -XX:CMSFullGCsBeforeCompaction&#x3D;5 -XX:+UseCMSCompactAtFullCollection</span><br><span class="line">-XX：CMSFullGCsBeforeCompaction:由于并发收集器不对内存空间压缩整理，所以一段时间以后会产生碎片，使得运行效率低下，此值设置运行多少次GC有多少次以后对内存空间进行压缩整理</span><br><span class="line">-XX：+UseCMSCompactFullCollection:打开年老代的压缩，可能会影响性能，但是可以消除碎片</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="辅助信息"><a href="#辅助信息" class="headerlink" title="辅助信息"></a>辅助信息</h1><p>JVM提供了许多命令行参数，打印信息，供调试使用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">-XX:+PrintGC</span><br><span class="line">输出形式：[GC 118250K-&gt;113543K(130112K), 0.0094143 secs]</span><br><span class="line">        [Full GC 121376K-&gt;10414K(130112K), 0.0650971 secs]</span><br><span class="line"></span><br><span class="line">-XX：+PrintGCDetails</span><br><span class="line">输出形式：[GC [DefNew: 8614K-&gt;781K(9088K), 0.0123035 secs] 118250K-&gt;113543K(130112K), 0.0124633 secs]</span><br><span class="line">        [GC [DefNew: 8614K-&gt;8614K(9088K), 0.0000665 secs][Tenured: 112761K-&gt;10414K(121024K), 0.0433488 secs] 121376K-&gt;10414K(130112K), 0.0436268 secs]</span><br><span class="line"></span><br><span class="line">-XX:+PrintGCTimeStamps -XX:+PrintGC：PrintGCTimeStamps可与上面两个混合使用</span><br><span class="line">输出形式：11.851: [GC 98328K-&gt;93620K(130112K), 0.0082960 secs]</span><br><span class="line"></span><br><span class="line">-XX:+PrintGCApplicationConcurrentTime:打印垃圾回收前，程序未中断的执行时间</span><br><span class="line">输出形式：Application time: 0.5291524 seconds</span><br><span class="line"></span><br><span class="line">-XX:+PrintGCApplicationStoppedTime：打印垃圾回收期间程序暂停的时间。可与上面混合使用</span><br><span class="line">输出形式：Total time for which application threads were stopped: 0.0468229 seconds</span><br><span class="line"></span><br><span class="line">-XX:PrintHeapAtGC:打印GC前后的详细堆栈信息</span><br><span class="line">输出形式：</span><br><span class="line">34.702: [GC &#123;Heap before gc invocations&#x3D;7:</span><br><span class="line"> def new generation   total 55296K, used 52568K [0x1ebd0000, 0x227d0000, 0x227d0000)</span><br><span class="line">eden space 49152K,  99% used [0x1ebd0000, 0x21bce430, 0x21bd0000)</span><br><span class="line">from space 6144K,  55% used [0x221d0000, 0x22527e10, 0x227d0000)</span><br><span class="line">  to   space 6144K,   0% used [0x21bd0000, 0x21bd0000, 0x221d0000)</span><br><span class="line"> tenured generation   total 69632K, used 2696K [0x227d0000, 0x26bd0000, 0x26bd0000)</span><br><span class="line">the space 69632K,   3% used [0x227d0000, 0x22a720f8, 0x22a72200, 0x26bd0000)</span><br><span class="line"> compacting perm gen  total 8192K, used 2898K [0x26bd0000, 0x273d0000, 0x2abd0000)</span><br><span class="line">   the space 8192K,  35% used [0x26bd0000, 0x26ea4ba8, 0x26ea4c00, 0x273d0000)</span><br><span class="line">    ro space 8192K,  66% used [0x2abd0000, 0x2b12bcc0, 0x2b12be00, 0x2b3d0000)</span><br><span class="line">    rw space 12288K,  46% used [0x2b3d0000, 0x2b972060, 0x2b972200, 0x2bfd0000)</span><br><span class="line">34.735: [DefNew: 52568K-&gt;3433K(55296K), 0.0072126 secs] 55264K-&gt;6615K(124928K)Heap after gc invocations&#x3D;8:</span><br><span class="line"> def new generation   total 55296K, used 3433K [0x1ebd0000, 0x227d0000, 0x227d0000)</span><br><span class="line">eden space 49152K,   0% used [0x1ebd0000, 0x1ebd0000, 0x21bd0000)</span><br><span class="line">  from space 6144K,  55% used [0x21bd0000, 0x21f2a5e8, 0x221d0000)</span><br><span class="line">  to   space 6144K,   0% used [0x221d0000, 0x221d0000, 0x227d0000)</span><br><span class="line"> tenured generation   total 69632K, used 3182K [0x227d0000, 0x26bd0000, 0x26bd0000)</span><br><span class="line">the space 69632K,   4% used [0x227d0000, 0x22aeb958, 0x22aeba00, 0x26bd0000)</span><br><span class="line"> compacting perm gen  total 8192K, used 2898K [0x26bd0000, 0x273d0000, 0x2abd0000)</span><br><span class="line">   the space 8192K,  35% used [0x26bd0000, 0x26ea4ba8, 0x26ea4c00, 0x273d0000)</span><br><span class="line">    ro space 8192K,  66% used [0x2abd0000, 0x2b12bcc0, 0x2b12be00, 0x2b3d0000)</span><br><span class="line">    rw space 12288K,  46% used [0x2b3d0000, 0x2b972060, 0x2b972200, 0x2bfd0000)</span><br><span class="line">&#125;</span><br><span class="line">, 0.0757599 secs]</span><br><span class="line"></span><br><span class="line">-Xloggc:filename:与上面几个配合使用，把相关日志信息记录到文件以便分析。</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="常见配置汇总"><a href="#常见配置汇总" class="headerlink" title="常见配置汇总"></a>常见配置汇总</h1><h2 id="堆设置"><a href="#堆设置" class="headerlink" title="堆设置"></a>堆设置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-Xms:初始堆大小</span><br><span class="line">-Xmx:最大堆大小</span><br><span class="line">-XX:NewSize&#x3D;n:设置年轻代大小</span><br><span class="line">-XX:NewRatio&#x3D;n:设置年轻代和年老代的比值。如:为3，表示年轻代与年老代比值为1：3，年轻代占整个年轻代年老代和的1&#x2F;4</span><br><span class="line">-XX:SurvivorRatio&#x3D;n:年轻代中Eden区与两个Survivor区的比值。注意Survivor区有两个。如：3，表示Eden：Survivor&#x3D;3：2，一个Survivor区占整个年轻代的1&#x2F;5</span><br><span class="line">-XX:MaxPermSize&#x3D;n:设置持久代大小</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="收集器设置"><a href="#收集器设置" class="headerlink" title="收集器设置"></a>收集器设置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-XX:+UseSerialGC:设置串行收集器</span><br><span class="line">-XX:+UseParallelGC:设置并行收集器</span><br><span class="line">-XX:+UseParalledlOldGC:设置并行年老代收集器</span><br><span class="line">-XX:+UseConcMarkSweepGC:设置并发收集器</span><br></pre></td></tr></table></figure>

<h2 id="垃圾回收统计信息"><a href="#垃圾回收统计信息" class="headerlink" title="垃圾回收统计信息"></a>垃圾回收统计信息</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-XX:+PrintGC</span><br><span class="line">-XX:+PrintGCDetails</span><br><span class="line">-XX:+PrintGCTimeStamps</span><br><span class="line">-Xloggc:filename</span><br></pre></td></tr></table></figure>
<h2 id="并行收集器设置"><a href="#并行收集器设置" class="headerlink" title="并行收集器设置"></a>并行收集器设置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-XX:ParallelGCThreads&#x3D;n:设置并行收集器收集时使用的CPU数。并行收集线程数。</span><br><span class="line">-XX:MaxGCPauseMillis&#x3D;n:设置并行收集最大暂停时间</span><br><span class="line">-XX:GCTimeRatio&#x3D;n:设置垃圾回收时间占程序运行时间的百分比。公式为1&#x2F;(1+n)</span><br></pre></td></tr></table></figure>

<h2 id="并发收集器设置"><a href="#并发收集器设置" class="headerlink" title="并发收集器设置"></a>并发收集器设置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-XX:+CMSIncrementalMode:设置为增量模式。适用于单CPU情况。</span><br><span class="line">-XX:ParallelGCThreads&#x3D;n:设置并发收集器年轻代收集方式为并行收集时，使用的CPU数。并行收集线程数。</span><br></pre></td></tr></table></figure>

<h1 id="调优总结"><a href="#调优总结" class="headerlink" title="调优总结"></a>调优总结</h1><h2 id="年轻代大小选择"><a href="#年轻代大小选择" class="headerlink" title="年轻代大小选择"></a>年轻代大小选择</h2><ul>
<li>响应时间优先的应用：尽可能设大，直到接近系统的最低响应时间限制（根据实际情况选择）。在此种情况下，年轻代收集发生的频率也是最小的。同时，减少到达年老代的对象。</li>
<li>吞吐量优先的应用：尽可能的设置大，可能到达Gbit的程度。因为对响应时间没有要求，垃圾收集可以并行进行，一般适合8CPU以上的应用。</li>
</ul>
<h2 id="年老代大小选择"><a href="#年老代大小选择" class="headerlink" title="年老代大小选择"></a>年老代大小选择</h2><ul>
<li>响应时间优先的应用：年老代使用并发收集器，所以其大小需要小心设置，一般要考虑并发会话率和会话持续时间等一些参数。如果堆设置小了，可以会造成内存碎片、高回收频率以及应用暂停而使用传统的标记清除方式；如果堆大了，则需要较长的收集时间。最优化的方案，一般需要参考以下数据获得：</li>
</ul>
<p>并发垃圾收集信息</p>
<p>持久代并发收集次数</p>
<p>传统GC信息</p>
<p>花在年轻代和年老代回收上的时间比例</p>
<p>减少年轻代和年老代花费的时间，一般会提高应用的效率</p>
<ul>
<li>吞吐量优先的应用：一般吞吐量优先的应用都有一个很大的年轻代和一个较小的年老代。原因是，这样可以尽可能回收掉大部分短期对象，减少中期的对象，而年老代尽存放长期存活对象。</li>
</ul>
<h2 id="较小堆引起的碎片问题"><a href="#较小堆引起的碎片问题" class="headerlink" title="较小堆引起的碎片问题"></a>较小堆引起的碎片问题</h2><ul>
<li>因为年老代的并发收集器使用标记、清除算法，所以不会对堆进行压缩。当收集器回收时，他会把相邻的空间进行合并，这样可以分配给较大的对象。但是，当堆空间较小时，运行一段时间以后，就会出现“碎片”，如果并发收集器找不到足够的空间，那么并发收集器将会停止，然后使用传统的标记、清除方式进行回收。如果出现“碎片”，可能需要进行如下配置：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-XX:+UseCMSCompactAtFullCollection：使用并发收集器时，开启对年老代的压缩。</span><br><span class="line">-XX:CMSFullGCsBeforeCompaction&#x3D;0：上面配置开启的情况下，这里设置多少次Full GC后，对年老代进行压缩</span><br></pre></td></tr></table></figure>


</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/wangzhongqiu/p/8908266.html">深入理解java虚拟机</a></p>
<h1 id="自带的内存管理机制"><a href="#自带的内存管理机制" class="headerlink" title="自带的内存管理机制"></a>自带的内存管理机制</h1><p>jconsole JDK自带的内存监测工具，路径jdk bin目录下jconsole.exe，双击可运行。连接方式有两种，第一种是本地方式如调试时运行的进程可以直接连，第二种是远程方式，可以连接以服务形式启动的进程。远程连接方式是：在目标进程的jvm启动参数中添加-Dcom.sun.management.jmxremote.port=1090 -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.authenticate=false 1090是监听的端口号具体使用时要进行修改，然后使用IP加端口号连接即可。通过该工具可以监测到当时内存的大小，CPU的使用量以及类的加载，<br>还提供了手动gc的功能。优点是效率高，速度快，在不影响进行运行的情况下监测产品的运行。缺点是无法看到类或者对象之类的具体信息</p>
<h1 id="堆内存的分配策略"><a href="#堆内存的分配策略" class="headerlink" title="堆内存的分配策略"></a>堆内存的分配策略</h1><ul>
<li>策略1</li>
</ul>
<p>当在程序中生成对象时，正常对象会在年轻代中分配空间，如果是过大的对象也可能会直接在年老代生成（据观测在运行某程序时候每次会生成一个十兆的空间用收发消息，这部分内存就会直接在年老代分配）。年轻代在空间被分配完的时候就会发起内存回收，大部分内存会被回收，一部分幸存的内存会被拷贝至Survivor的from区，经过多次回收以后如果from区内存也分配完毕，就会也发生内存回收然后将剩余的对象拷贝至to区。等到to区也满的时候，就会再次发生内存回收然后把幸存的对象拷贝至年老区。</p>
<p>JVM初始分配的内存由-Xms指定，默认是物理内存的1/64；JVM最大分配的内存由 -Xmx指定，默认是物理内存的1/4。默认空余堆内存小于40%时，JVM就会增大堆直到-Xmx的最大限制；空余堆内存大于70%时，JVM会减少堆 直到-Xms的最小限制。因此服务器一般设置-Xms、-Xmx相等以避免在每次GC 后调整堆的大小。</p>
<ul>
<li>策略2</li>
</ul>
<p>对象优先在Eden分配，当新生区没有足够的内存是，通过分配担保机制提前转移到老年代中去</p>
<p>大对象直接进入老年代。大对象是指需要大量连续内存空间的对象，虚拟机提供了参数 -XX:PretenureSizeThreshold（只对Serial，PerNew两个回收器起效），令大于这个值得对象直接在老年代分配，避免了Eden和两个Survival之间发生大量的内存复制。</p>
<p>长期存活的对象将进入老年代。虚拟机给每个对象定义了对象年龄计数器（Age），如果对象在Eden出生，经过第一次Minor GC后依然存活，并且能被Survival容纳的话，将被移动到Survival，对象年龄设为1。对象在Survival中每熬过一次Major GC，年龄就增加1，达到一定程度（默认是15），就会被晋升到老年代。对象晋升老年代的阈值，可以通过参数-XX:MaxTenuringThreShold 指定</p>
<p>动态对象年龄判断。如果在Survival空间中相同年龄所有对象的大小综合超过了Survival空间的一半，年龄大于等于这个年龄的对象都会被晋升到老年代。无需等待年龄超过MaxTenuringThreShold指定的年龄</p>
<p>空间分配担保。只要老年代的连续空间大于新生代对象总和或者历次晋升的平均大小，就进行Major GC，否则进行Full  GC。</p>
<h1 id="JVM常用参数设置"><a href="#JVM常用参数设置" class="headerlink" title="JVM常用参数设置"></a>JVM常用参数设置</h1><h2 id="整体考虑堆大小"><a href="#整体考虑堆大小" class="headerlink" title="整体考虑堆大小"></a>整体考虑堆大小</h2><p>-Xms3550m， 初始化堆大小。通常情况和-Xmx大小设置一样，避免虚拟机频繁自动计算后调整堆大小。 </p>
<p>-Xmx3550m，最大堆大小。</p>
<h2 id="考虑分代设置堆大小"><a href="#考虑分代设置堆大小" class="headerlink" title="考虑分代设置堆大小"></a>考虑分代设置堆大小</h2><p>首先通过jstat等工具查看应用程序正常情况下需要堆大小，再根据实际情况设置。</p>
<h3 id="新生代"><a href="#新生代" class="headerlink" title="新生代"></a>新生代</h3><p>-xmn2g，新生代大小。Sun官方推荐配置为整个堆的3/8。<br>-XX:SurvivorRatio=8。Eden和Survivor的比值。</p>
<h3 id="老年代"><a href="#老年代" class="headerlink" title="老年代"></a>老年代</h3><p>老年代=整个堆大小-新生代-永久代</p>
<h3 id="永久带"><a href="#永久带" class="headerlink" title="永久带"></a>永久带</h3><p>-XX:Permsize=512m,设置永久代初始值。<br>-XX:MaxPermsize=512m，设置永久代的最大值。<br>注：Java8没有永久代说法，它们被称为元空间，-XX:MetaspaceSize=N</p>
<h2 id="考虑虚拟机栈"><a href="#考虑虚拟机栈" class="headerlink" title="考虑虚拟机栈"></a>考虑虚拟机栈</h2><p>每个线程池的堆栈大小。在jdk5以上的版本，每个线程堆栈大小为1m，jdk5以前的版本是每个线程池大小为256k。一般设置256k。<br>-Xss256K.</p>
<h2 id="考虑垃圾收集器"><a href="#考虑垃圾收集器" class="headerlink" title="考虑垃圾收集器"></a>考虑垃圾收集器</h2><h3 id="Serial收集器-串行收集器"><a href="#Serial收集器-串行收集器" class="headerlink" title="Serial收集器(串行收集器)"></a>Serial收集器(串行收集器)</h3><p>历史最悠久的串行收集器。参数-XX:UseSerialGC。不太常用。</p>
<h3 id="ParNew和ParOld收集器-并发收集器"><a href="#ParNew和ParOld收集器-并发收集器" class="headerlink" title="ParNew和ParOld收集器(并发收集器)"></a>ParNew和ParOld收集器(并发收集器)</h3><p>Serial的多线程版本收集器。</p>
<h3 id="Parallel-Scavenge-吞吐量优先垃圾收集器"><a href="#Parallel-Scavenge-吞吐量优先垃圾收集器" class="headerlink" title="Parallel Scavenge(吞吐量优先垃圾收集器)"></a>Parallel Scavenge(吞吐量优先垃圾收集器)</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">并行收集器，不同于多线程收集器ParNew，关注吞吐量的收集器。 </span><br><span class="line">-XX:MaxGCPauseMillis&#x3D;10，设置垃圾收集停顿的最大毫秒数。 </span><br><span class="line">-XX:GCTimeRatio&#x3D;49，垃圾收集器占比，默认是99。 </span><br><span class="line">-XX:+UseAdaptiveSeizPolicy，GC自适应调节策略。 </span><br><span class="line">-XX:+UseParallelGC,虚拟机Server模式默认值，使用Parallel Scavenge + Serial Old进行内存回收。 </span><br><span class="line">-XX:+UseParallelOldGC, 使用Parallel Scavenge + Parallel Old 进行内存回收。</span><br></pre></td></tr></table></figure>

<h3 id="CMS"><a href="#CMS" class="headerlink" title="CMS"></a>CMS</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CMS作为老年代收集器，不能与Parallel Scavenge并存。可能会有内存碎片问题。 </span><br><span class="line">-XX:+UserConcMarkSweepGC，新生代默认用ParNew收集。也可以用-XX:+UserParNewGC强制指定新生代用ParNew收集 </span><br><span class="line">-XX:ParallelGCThreads&#x3D;4，设置垃圾收集线程数。默认是(CPU数量+3)&#x2F;4。垃圾收集线程数不少于25%，当CPU数量小于4的时候影响大。 </span><br><span class="line">-XX:CMSInitiatingOccupancyFraction&#x3D;80，老年代垃圾占比达到这个阈值开始CMS收集，1.6默认是92。设置过高容易导致并发收集失败，会出现SerialOld收集的情况。 </span><br><span class="line">-XX:+UseCMSCompactAtFullCollection，在FULL GC的时候， 对年老代的压缩增加这个参数是个好习惯。可能会影响性能,但是可以消除碎片。 </span><br><span class="line">-XX:CMSFullGCsBeforeCompaction&#x3D;1，多少次后进行内存压缩。 </span><br><span class="line">-XX:+CMSParallelRemarkEnabled, 为了减少第二次暂停的时间，开启并行remark,降低标记停顿</span><br></pre></td></tr></table></figure>

<h3 id="G1-Garbage-First"><a href="#G1-Garbage-First" class="headerlink" title="G1(Garbage First)"></a>G1(Garbage First)</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-XX:+UseG1GC，谨慎使用，需要经过线上测试，还没有被设置为默认垃圾收集器。 </span><br><span class="line">之前的垃圾收集器收集的范围是新生代或者老年代，而G1垃圾收集器收集的范围包括新生代和老年代整个堆。G1将Java堆划为多个大小相同的独立区域(Region)，垃圾收集单位是Region。G1垃圾收集适合至少大于4G内存得系统。并且不会产生内存空间碎片。</span><br></pre></td></tr></table></figure>

<h3 id="其他参数"><a href="#其他参数" class="headerlink" title="其他参数"></a>其他参数</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-XX:MaxTenuringThreshold&#x3D;30，晋升老年代的年龄。 </span><br><span class="line">-XX:PretenureSizeThreshold&#x3D;?，晋升老年代的对象大小。没设置过。</span><br></pre></td></tr></table></figure>

<h3 id="考虑日志打印"><a href="#考虑日志打印" class="headerlink" title="考虑日志打印"></a>考虑日志打印</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">-verbose:gc，打印GC日志 </span><br><span class="line">-XX:+PrintGC，打印GC基本日志 </span><br><span class="line">-XX:+PrintGCDetails，打印GC详细日志 </span><br><span class="line">-XX:+PrintGCTimeStamps，打印相对时间戳 </span><br><span class="line">-XX:+PrintGCApplicationStoppedTime,打印垃圾回收期间程序暂停的时间 </span><br><span class="line">-XX:+PrintGCApplicationConcurrentTime,打印每次垃圾回收前,程序未中断的执行时间 </span><br><span class="line">-XX:+PrintTenuringDistribution：查看每次minor GC后新的存活周期的阈值 </span><br><span class="line">-XX:+PrintTLAB,查看TLAB空间的使用情况 </span><br><span class="line">-Xloggc:filename,把相关日志信息记录到文件以便分析</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="考虑OOM-堆溢出-时保留现场日志"><a href="#考虑OOM-堆溢出-时保留现场日志" class="headerlink" title="考虑OOM(堆溢出)时保留现场日志"></a>考虑OOM(堆溢出)时保留现场日志</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">当抛出OOM时进行heapdump</span><br><span class="line">-XX:+HeapDumpOnOutOfMemoryError,JVM异常自动生成堆转储 </span><br><span class="line">-XX:HeapDumpPath&#x3D;，堆转储文件名</span><br></pre></td></tr></table></figure>












      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.chenwj.cn/2018-09-29/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA-java%E5%86%85%E5%AD%98%E5%8C%BA%E5%9F%9F%E5%92%8C%E5%86%85%E5%AD%98%E6%BA%A2%E5%87%BA%E5%BC%82%E5%B8%B8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/favicon.ico">
      <meta itemprop="name" content="陈伟杰">
      <meta itemprop="description" content="学习，坚持。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="茄子的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018-09-29/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3java%E8%99%9A%E6%8B%9F%E6%9C%BA-java%E5%86%85%E5%AD%98%E5%8C%BA%E5%9F%9F%E5%92%8C%E5%86%85%E5%AD%98%E6%BA%A2%E5%87%BA%E5%BC%82%E5%B8%B8/" class="post-title-link" itemprop="url">深入理解java虚拟机-java内存区域和内存溢出异常</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-09-29 00:42:51" itemprop="dateCreated datePublished" datetime="2018-09-29T00:42:51+08:00">2018-09-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-08-21 01:03:09" itemprop="dateModified" datetime="2020-08-21T01:03:09+08:00">2020-08-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/jvm/" itemprop="url" rel="index"><span itemprop="name">jvm</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>24k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>22 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><p>对于C和C++程序员，他们负责这每一个对象开始到结束的维护责任，需要为对象分配和释放内存。而java程序员在虚拟机自动内存管理机制的帮助下，不再需要为每一个对象写配对的delete/free代码，不容易出现内存泄露和内存溢出的问题，但是一旦你出现内存泄露和溢出的问题，不了解java虚拟机时不容易解决此类问题的。</p>
<h2 id="运行时数据区域"><a href="#运行时数据区域" class="headerlink" title="运行时数据区域"></a>运行时数据区域</h2><p><img src="/images/jvm/java%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA.png" alt="java虚拟机运行时数据区"></p>
<p>1.程序计数器</p>
<p>   程序计数器（Program Counter Register） 是一块较小的内存空间，它可以看作是当前线程所执行的字节码的行号指示器。在虚拟机的概念模型里，字节码解释器工作时就是通过改变这个计数器的值来选取下一条执行字节码指令。</p>
<p>   每条线程都有一个独立的程序计数器。多线程是通过线程轮流切换并分配处理器执行的时间方式来实现的，为了线程切换后可以恢复到正确的执行位置，每条线程都需要一个独立的程序计数器。</p>
<p>   如果执行的是java方法，这个计数器记录的是正在执行的虚拟机字节码指令地址。如果是native方法，计数器为空。此内存区域是唯一一个在java虚拟机规范中没有规定任何OutOfMemoryError情况的区域。</p>
<p>2.Java虚拟机栈</p>
<p>   同样是线程私有，描述Java方法执行的内存模型：每个方法在执行的同时都会创建一个栈帧（Stack Frame）用于存储局部变量表、操作数栈、动态链接、方法出口等信息。一个方法对应一个栈帧。</p>
<p>   局部变量表存放了各种基本类型、对象引用和returnAddress类型（指向了一条字节码指令地址）。其中64位长度long 和 double占两个局部变量空间，其他只占一个。</p>
<p>   规定的异常情况有两种：1.线程请求的栈的深度大于虚拟机所允许的深度，将抛出StackOverflowError异常；2.如果虚拟机可以动态扩展，如果扩展时无法申请到足够的内存，就抛出OutOfMemoryError异常。</p>
<p>3.本地方法栈</p>
<p>   和Java虚拟机栈很类似，不同的是本地方法栈为Native方法服务。</p>
<p>4.Java堆</p>
<p>   是Java虚拟机所管理的内存中最大的一块。由所有线程共享，在虚拟机启动时创建。堆区唯一目的就是存放对象实例。虚拟机规范中描述：所有的对象实例以及数组都在java堆中分配内存。</p>
<p>   堆中可细分为新生代和老年代，再细分可分为Eden空间、From Survivor空间、To Survivor空间。</p>
<p>   堆无法扩展时，抛出OutOfMemoryError异常</p>
<p>5.方法区</p>
<p>   所有线程共享，存储已被虚拟机加载的类信息、常量、静态变量、即时编译器编译后的代码等数据。</p>
<p>   当方法区无法满足内存分配需求时，抛出OutOfMemoryError</p>
<p>6.运行时常量池</p>
<p>   它是方法区的一部分，Class文件中除了有类的版本、字段、方法、接口等描述信息外，还有一项是常量池（Const Pool Table），用于存放编译期生成的各种字面量和符号引用。并非预置入Class文件中常量池的内容才进入方法运行时常量池，运行期间也可能将新的常量放入池中，这种特性被开发人员利用得比较多的便是String类的intern()方法。</p>
<p>   当方法区无法满足内存分配需求时，抛出OutOfMemoryError</p>
<p>7.直接内存</p>
<p>   并不是虚拟机运行时数据区的一部分，也不是Java虚拟机规范中定义的内存区域。</p>
<p>   JDK1.4加入了NIO，引入一种基于通道与缓冲区的I/O方式，它可以使用Native函数库直接分配堆外内存，然后通过一个存储在Java堆中的DirectByteBuffer对象作为这块内存的引用进行操作。因为避免了在Java堆和Native堆中来回复制数据，提高了性能。</p>
<p>   当各个内存区域总和大于物理内存限制，抛出OutOfMemoryError异常。</p>
<h2 id="对象的创建"><a href="#对象的创建" class="headerlink" title="对象的创建"></a>对象的创建</h2><p>创建对象（克隆/反序列化）通常仅仅是一个new关键字而已。虚拟机遇到一条new指令的时候，首先去检查这个指令的参数是否在常量池找那个定位到一个类的符号引用，并检查这个符号引用代表的类是否在内存中已经被加载、解析和初始化。</p>
<ul>
<li>分配内存的方式：</li>
</ul>
<ol>
<li><p>指针碰撞：假设java堆中的内存是绝对规整的，所有用过的内存放到一边，所有没有用过的内存放到另一边，中间放着一个指针作为分界点的指示器，那么内存分配仅仅是把那个指针向空闲内存那的那一边移动与对象大小相等的距离。</p>
</li>
<li><p>空闲列表：如果java堆中的内存并不是规整的，已使用的和未使用的是相互交错的，这样虚拟机必须维护一个记录表，记录哪些内存是可以使用的，在分配内存的时候从列表中找到一块足够打的空间划分给实例，并更新列表上的记录。</p>
</li>
</ol>
<p>而选择哪种方式是由java堆是否规整决定的，而java堆是否规整是由java的垃圾回收器决定的。使用serial、parNew等代用compact过程的收集器时，通常采用的是指针碰撞，而使用CMS这种使用MARK——Sweep算法的收集器时通常采用空闲列表的算法。</p>
<ul>
<li>内存分配的线程安全问题</li>
</ul>
<p>如果仅仅修改一个指针的指向分配内存，并发情况下的分配会出现问题，解决问题的方案：</p>
<ol>
<li>对分配内存空间的动作进行同步，实际上是采用CAS配上失败重试的方式保证更新操作的原子性；</li>
<li>另一种是把内存分配的动作按照线程规划在不同的空间中进行，内个线程在java杜仲预先分配一小块内存，称为本地线程分配缓冲(Thread Local Allocation Buffer TLAB),哪个线程需要分配内存就在其对应的TLAB上分配，只用TLAB用完需要分配新的TLAB的时候菜户同步锁定，虚拟机是否使用TLAB可以使用-XX:+UseTLAB参数来决定；</li>
</ol>
<ul>
<li><p>分配完之后，虚拟机需要将分配到内存空间都初始化为零值。</p>
</li>
<li><p>接下来虚拟机要对对象进行必要的设置，例如这个对象是哪个类的实例，如何才能找到对象的元数据信息，对象的hash码，对象的GC分代年龄等信息。</p>
</li>
</ul>
<h2 id="对象的内存布局"><a href="#对象的内存布局" class="headerlink" title="对象的内存布局"></a>对象的内存布局</h2><p>在HotSpot虚拟机中，对象在内存中存储的布局可以分为三块区域：对象头、实例数据、对齐填充。</p>
<h3 id="对象头"><a href="#对象头" class="headerlink" title="对象头"></a>对象头</h3><p>对象头包括2部分信息：</p>
<ol>
<li>第一部分存储对象自身的运行时数据，如hash码，GC分代年龄，锁状态标志、线程持有的锁、偏向线程ID、偏向时间戳等；</li>
<li>对象头的另一部分是类型指针，即对象指向它的类数据的指针，虚拟机通过这个指针能够确定对象属于哪个类的实例；</li>
</ol>
<h3 id="实例数据"><a href="#实例数据" class="headerlink" title="实例数据"></a>实例数据</h3><p>主要存储的是对象真正的有效信息，也就是在程序代码中定义的各种类型的字段内容，无论是从父类继承下来的，还是在子类中定义的都要记录下来。</p>
<h3 id="对齐填充"><a href="#对齐填充" class="headerlink" title="对齐填充"></a>对齐填充</h3><p>这部分不是必须存在的，也没有特别的含义。它仅仅起占位符的作用，对于HotSpot VM的自动内存管理系统要求对象必须是8字节的整数倍，而对象头的大小正好是8字节的整数倍，因此对象头不需要填充来补全。</p>
<h2 id="对象的访问定位"><a href="#对象的访问定位" class="headerlink" title="对象的访问定位"></a>对象的访问定位</h2><p>对象是通过栈上的reference数据来操作堆上的具体对象。目前主流的访问方式有句柄和直接指针两种。</p>
<h3 id="句柄访问方式"><a href="#句柄访问方式" class="headerlink" title="句柄访问方式"></a>句柄访问方式</h3><p>使用句柄访问的话，java堆中将会划分出一块内存来作为句柄池，reference中存储的就是对象的句柄地址，句柄中保函了对象实例数据与类型数据各自的具体地址信息。</p>
<p><img src="/images/jvm/%E9%80%9A%E8%BF%87%E5%8F%A5%E6%9F%84%E8%AE%BF%E9%97%AE%E5%AF%B9%E8%B1%A1.jpeg" alt="通过句柄访问对象"></p>
<h3 id="通过指针访问"><a href="#通过指针访问" class="headerlink" title="通过指针访问"></a>通过指针访问</h3><p>如果通过指针访问，那么java堆对象的布局就必须考虑如何放置访问类型数据的相关信息。而reference中存储的直接就是对象地址。</p>
<p><img src="/images/jvm/%E9%80%9A%E8%BF%87%E6%8C%87%E9%92%88%E8%AE%BF%E9%97%AE%E5%AF%B9%E8%B1%A1.jpeg" alt="通过指针访问对象"></p>
<h3 id="对象访问方式的对比"><a href="#对象访问方式的对比" class="headerlink" title="对象访问方式的对比"></a>对象访问方式的对比</h3><p>使用句柄来访问的最大好处就是reference中存储的是稳定的句柄地址，在对象被移动（垃圾回收时移动对象是非常普遍的数据）时改变句柄中的实例数据指针，而reference并不会被改变，</p>
<p>使用直接指针访问的最大好处就是速度快，它节省了一次指针丁文的时间开销。</p>
<h2 id="实战OutOfMemoryError异常"><a href="#实战OutOfMemoryError异常" class="headerlink" title="实战OutOfMemoryError异常"></a>实战OutOfMemoryError异常</h2><p>虚拟机内存的其他几个运行区域都除了程序计数器都有发生异常OOM的可能。</p>
<p>java 堆用于存储对象实例，只要不断的创建，并且保证GC ROOTs到对象之间有可达路径来避免垃圾回收机制清楚这些对象，那么对象达到最大堆的容量限制后就会产生内存溢出异常。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * -verbose:gc -Xms20M -Xmx20M -Xmn10M -XX:+PrintGCDetails -XX:SurvivorRatio&#x3D;8 -XX:+HeapDumpOnOutOfMemoryError</span><br><span class="line"> * @author :  chen weijie</span><br><span class="line"> * @Date: 2018-10-23 9:20 AM</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class StackOverFlowErrorDemo &#123;</span><br><span class="line"></span><br><span class="line">    static class OOMObject &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        List&lt;OOMObject&gt; list &#x3D; new ArrayList&lt;&gt;();</span><br><span class="line">        while (true) &#123;</span><br><span class="line">            list.add(new OOMObject());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>运行结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;Library&#x2F;Java&#x2F;JavaVirtualMachines&#x2F;jdk1.8.0_161.jdk&#x2F;Contents&#x2F;Home&#x2F;bin&#x2F;java -agentlib:jdwp&#x3D;transport&#x3D;dt_socket,address&#x3D;127.0.0.1:50373,suspend&#x3D;y,server&#x3D;n -verbose:gc -Xms20M -Xmx20M -Xmn10M -XX:+HeapDumpOnOutOfMemoryError -javaagent:&#x2F;Users&#x2F;zhuningning&#x2F;Library&#x2F;Caches&#x2F;IntelliJIdea2017.3&#x2F;captureAgent&#x2F;debugger-agent.jar&#x3D;&#x2F;private&#x2F;var&#x2F;folders&#x2F;52&#x2F;sbvwq6v93ns69v8s34_drz9h0000gn&#x2F;T&#x2F;capture341.props -Dfile.encoding&#x3D;UTF-8 -classpath &quot;&#x2F;Library&#x2F;Java&#x2F;JavaVirtualMachines&#x2F;jdk1.8.0_161.jdk&#x2F;Contents&#x2F;Home&#x2F;jre&#x2F;lib&#x2F;charsets.jar:&#x2F;Library&#x2F;Java&#x2F;JavaVirtualMachines&#x2F;jdk1.8.0_161.jdk&#x2F;Contents&#x2F;Home&#x2F;jre&#x2F;lib&#x2F;deploy.jar:&#x2F;Library&#x2F;Java&#x2F;JavaVirtualMachines&#x2F;jdk1.8.0_161.jdk&#x2F;Contents&#x2F;Home&#x2F;jre&#x2F;lib&#x2F;ext&#x2F;cldrdata.jar:&#x2F;Library&#x2F;Java&#x2F;JavaVirtualMachines&#x2F;jdk1.8.0_161.jdk&#x2F;Contents&#x2F;Home&#x2F;jre&#x2F;lib&#x2F;ext&#x2F;dnsns.jar:&#x2F;Library&#x2F;Java&#x2F;JavaVirtualMachines&#x2F;jdk1.8.0_161.jdk&#x2F;Contents&#x2F;Home&#x2F;jre&#x2F;lib&#x2F;ext&#x2F;jaccess.jar:&#x2F;Library&#x2F;Java&#x2F;JavaVirtualMachines&#x2F;jdk1.8.0_161.jdk&#x2F;Contents&#x2F;Home&#x2F;jre&#x2F;lib&#x2F;ext&#x2F;jfxrt.jar:&#x2F;Library&#x2F;Java&#x2F;JavaVirtualMachines&#x2F;jdk1.8.0_161.jdk&#x2F;Contents&#x2F;Home&#x2F;jre&#x2F;lib&#x2F;ext&#x2F;localedata.jar:&#x2F;Library&#x2F;Java&#x2F;JavaVirtualMachines&#x2F;jdk1.8.0_161.jdk&#x2F;Contents&#x2F;Home&#x2F;jre&#x2F;lib&#x2F;ext&#x2F;nashorn.jar:&#x2F;Library&#x2F;Java&#x2F;JavaVirtualMachines&#x2F;jdk1.8.0_161.jdk&#x2F;Contents&#x2F;Home&#x2F;jre&#x2F;lib&#x2F;ext&#x2F;sunec.jar:&#x2F;Library&#x2F;Java&#x2F;JavaVirtualMachines&#x2F;jdk1.8.0_161.jdk&#x2F;Contents&#x2F;Home&#x2F;jre&#x2F;lib&#x2F;ext&#x2F;sunjce_provider.jar:&#x2F;Library&#x2F;Java&#x2F;JavaVirtualMachines&#x2F;jdk1.8.0_161.jdk&#x2F;Contents&#x2F;Home&#x2F;jre&#x2F;lib&#x2F;ext&#x2F;sunpkcs11.jar:&#x2F;Library&#x2F;Java&#x2F;JavaVirtualMachines&#x2F;jdk1.8.0_161.jdk&#x2F;Contents&#x2F;Home&#x2F;jre&#x2F;lib&#x2F;ext&#x2F;zipfs.jar:&#x2F;Library&#x2F;Java&#x2F;JavaVirtualMachines&#x2F;jdk1.8.0_161.jdk&#x2F;Contents&#x2F;Home&#x2F;jre&#x2F;lib&#x2F;javaws.jar:&#x2F;Library&#x2F;Java&#x2F;JavaVirtualMachines&#x2F;jdk1.8.0_161.jdk&#x2F;Contents&#x2F;Home&#x2F;jre&#x2F;lib&#x2F;jce.jar:&#x2F;Library&#x2F;Java&#x2F;JavaVirtualMachines&#x2F;jdk1.8.0_161.jdk&#x2F;Contents&#x2F;Home&#x2F;jre&#x2F;lib&#x2F;jfr.jar:&#x2F;Library&#x2F;Java&#x2F;JavaVirtualMachines&#x2F;jdk1.8.0_161.jdk&#x2F;Contents&#x2F;Home&#x2F;jre&#x2F;lib&#x2F;jfxswt.jar:&#x2F;Library&#x2F;Java&#x2F;JavaVirtualMachines&#x2F;jdk1.8.0_161.jdk&#x2F;Contents&#x2F;Home&#x2F;jre&#x2F;lib&#x2F;jsse.jar:&#x2F;Library&#x2F;Java&#x2F;JavaVirtualMachines&#x2F;jdk1.8.0_161.jdk&#x2F;Contents&#x2F;Home&#x2F;jre&#x2F;lib&#x2F;management-agent.jar:&#x2F;Library&#x2F;Java&#x2F;JavaVirtualMachines&#x2F;jdk1.8.0_161.jdk&#x2F;Contents&#x2F;Home&#x2F;jre&#x2F;lib&#x2F;plugin.jar:&#x2F;Library&#x2F;Java&#x2F;JavaVirtualMachines&#x2F;jdk1.8.0_161.jdk&#x2F;Contents&#x2F;Home&#x2F;jre&#x2F;lib&#x2F;resources.jar:&#x2F;Library&#x2F;Java&#x2F;JavaVirtualMachines&#x2F;jdk1.8.0_161.jdk&#x2F;Contents&#x2F;Home&#x2F;jre&#x2F;lib&#x2F;rt.jar:&#x2F;Library&#x2F;Java&#x2F;JavaVirtualMachines&#x2F;jdk1.8.0_161.jdk&#x2F;Contents&#x2F;Home&#x2F;lib&#x2F;ant-javafx.jar:&#x2F;Library&#x2F;Java&#x2F;JavaVirtualMachines&#x2F;jdk1.8.0_161.jdk&#x2F;Contents&#x2F;Home&#x2F;lib&#x2F;dt.jar:&#x2F;Library&#x2F;Java&#x2F;JavaVirtualMachines&#x2F;jdk1.8.0_161.jdk&#x2F;Contents&#x2F;Home&#x2F;lib&#x2F;javafx-mx.jar:&#x2F;Library&#x2F;Java&#x2F;JavaVirtualMachines&#x2F;jdk1.8.0_161.jdk&#x2F;Contents&#x2F;Home&#x2F;lib&#x2F;jconsole.jar:&#x2F;Library&#x2F;Java&#x2F;JavaVirtualMachines&#x2F;jdk1.8.0_161.jdk&#x2F;Contents&#x2F;Home&#x2F;lib&#x2F;packager.jar:&#x2F;Library&#x2F;Java&#x2F;JavaVirtualMachines&#x2F;jdk1.8.0_161.jdk&#x2F;Contents&#x2F;Home&#x2F;lib&#x2F;sa-jdi.jar:&#x2F;Library&#x2F;Java&#x2F;JavaVirtualMachines&#x2F;jdk1.8.0_161.jdk&#x2F;Contents&#x2F;Home&#x2F;lib&#x2F;tools.jar:&#x2F;Users&#x2F;zhuningning&#x2F;ideaWorkSpace&#x2F;javaBase&#x2F;target&#x2F;classes:&#x2F;Users&#x2F;zhuningning&#x2F;.m2&#x2F;repository&#x2F;org&#x2F;dom4j&#x2F;dom4j&#x2F;2.0.0&#x2F;dom4j-2.0.0.jar:&#x2F;Users&#x2F;zhuningning&#x2F;.m2&#x2F;repository&#x2F;jaxen&#x2F;jaxen&#x2F;1.1.6&#x2F;jaxen-1.1.6.jar:&#x2F;Users&#x2F;zhuningning&#x2F;.m2&#x2F;repository&#x2F;junit&#x2F;junit&#x2F;4.12&#x2F;junit-4.12.jar:&#x2F;Users&#x2F;zhuningning&#x2F;.m2&#x2F;repository&#x2F;org&#x2F;hamcrest&#x2F;hamcrest-core&#x2F;1.3&#x2F;hamcrest-core-1.3.jar:&#x2F;Users&#x2F;zhuningning&#x2F;.m2&#x2F;repository&#x2F;org&#x2F;mongodb&#x2F;mongodb-driver-async&#x2F;3.2.2&#x2F;mongodb-driver-async-3.2.2.jar:&#x2F;Users&#x2F;zhuningning&#x2F;.m2&#x2F;repository&#x2F;org&#x2F;mongodb&#x2F;mongodb-driver-core&#x2F;3.2.2&#x2F;mongodb-driver-core-3.2.2.jar:&#x2F;Users&#x2F;zhuningning&#x2F;.m2&#x2F;repository&#x2F;org&#x2F;mongodb&#x2F;bson&#x2F;3.2.2&#x2F;bson-3.2.2.jar:&#x2F;Users&#x2F;zhuningning&#x2F;.m2&#x2F;repository&#x2F;org&#x2F;springframework&#x2F;spring-context&#x2F;4.3.5.RELEASE&#x2F;spring-context-4.3.5.RELEASE.jar:&#x2F;Users&#x2F;zhuningning&#x2F;.m2&#x2F;repository&#x2F;org&#x2F;springframework&#x2F;spring-aop&#x2F;4.3.5.RELEASE&#x2F;spring-aop-4.3.5.RELEASE.jar:&#x2F;Users&#x2F;zhuningning&#x2F;.m2&#x2F;repository&#x2F;org&#x2F;springframework&#x2F;spring-beans&#x2F;4.3.5.RELEASE&#x2F;spring-beans-4.3.5.RELEASE.jar:&#x2F;Users&#x2F;zhuningning&#x2F;.m2&#x2F;repository&#x2F;org&#x2F;springframework&#x2F;spring-core&#x2F;4.3.5.RELEASE&#x2F;spring-core-4.3.5.RELEASE.jar:&#x2F;Users&#x2F;zhuningning&#x2F;.m2&#x2F;repository&#x2F;commons-logging&#x2F;commons-logging&#x2F;1.2&#x2F;commons-logging-1.2.jar:&#x2F;Users&#x2F;zhuningning&#x2F;.m2&#x2F;repository&#x2F;org&#x2F;springframework&#x2F;spring-expression&#x2F;4.3.5.RELEASE&#x2F;spring-expression-4.3.5.RELEASE.jar:&#x2F;Users&#x2F;zhuningning&#x2F;.m2&#x2F;repository&#x2F;org&#x2F;apache&#x2F;logging&#x2F;log4j&#x2F;log4j-api&#x2F;2.7&#x2F;log4j-api-2.7.jar:&#x2F;Users&#x2F;zhuningning&#x2F;.m2&#x2F;repository&#x2F;org&#x2F;apache&#x2F;logging&#x2F;log4j&#x2F;log4j-core&#x2F;2.7&#x2F;log4j-core-2.7.jar:&#x2F;Users&#x2F;zhuningning&#x2F;.m2&#x2F;repository&#x2F;mysql&#x2F;mysql-connector-java&#x2F;5.1.40&#x2F;mysql-connector-java-5.1.40.jar:&#x2F;Users&#x2F;zhuningning&#x2F;.m2&#x2F;repository&#x2F;cn&#x2F;afterturn&#x2F;easypoi-base&#x2F;3.0.3&#x2F;easypoi-base-3.0.3.jar:&#x2F;Users&#x2F;zhuningning&#x2F;.m2&#x2F;repository&#x2F;org&#x2F;apache&#x2F;poi&#x2F;poi&#x2F;3.15&#x2F;poi-3.15.jar:&#x2F;Users&#x2F;zhuningning&#x2F;.m2&#x2F;repository&#x2F;commons-codec&#x2F;commons-codec&#x2F;1.10&#x2F;commons-codec-1.10.jar:&#x2F;Users&#x2F;zhuningning&#x2F;.m2&#x2F;repository&#x2F;org&#x2F;apache&#x2F;commons&#x2F;commons-collections4&#x2F;4.1&#x2F;commons-collections4-4.1.jar:&#x2F;Users&#x2F;zhuningning&#x2F;.m2&#x2F;repository&#x2F;org&#x2F;apache&#x2F;poi&#x2F;poi-ooxml&#x2F;3.15&#x2F;poi-ooxml-3.15.jar:&#x2F;Users&#x2F;zhuningning&#x2F;.m2&#x2F;repository&#x2F;com&#x2F;github&#x2F;virtuald&#x2F;curvesapi&#x2F;1.04&#x2F;curvesapi-1.04.jar:&#x2F;Users&#x2F;zhuningning&#x2F;.m2&#x2F;repository&#x2F;org&#x2F;apache&#x2F;poi&#x2F;poi-ooxml-schemas&#x2F;3.15&#x2F;poi-ooxml-schemas-3.15.jar:&#x2F;Users&#x2F;zhuningning&#x2F;.m2&#x2F;repository&#x2F;org&#x2F;apache&#x2F;xmlbeans&#x2F;xmlbeans&#x2F;2.6.0&#x2F;xmlbeans-2.6.0.jar:&#x2F;Users&#x2F;zhuningning&#x2F;.m2&#x2F;repository&#x2F;stax&#x2F;stax-api&#x2F;1.0.1&#x2F;stax-api-1.0.1.jar:&#x2F;Users&#x2F;zhuningning&#x2F;.m2&#x2F;repository&#x2F;com&#x2F;google&#x2F;guava&#x2F;guava&#x2F;16.0.1&#x2F;guava-16.0.1.jar:&#x2F;Users&#x2F;zhuningning&#x2F;.m2&#x2F;repository&#x2F;org&#x2F;apache&#x2F;commons&#x2F;commons-lang3&#x2F;3.2.1&#x2F;commons-lang3-3.2.1.jar:&#x2F;Users&#x2F;zhuningning&#x2F;.m2&#x2F;repository&#x2F;org&#x2F;slf4j&#x2F;slf4j-api&#x2F;1.6.1&#x2F;slf4j-api-1.6.1.jar:&#x2F;Users&#x2F;zhuningning&#x2F;.m2&#x2F;repository&#x2F;javax&#x2F;validation&#x2F;validation-api&#x2F;1.1.0.Final&#x2F;validation-api-1.1.0.Final.jar:&#x2F;Users&#x2F;zhuningning&#x2F;.m2&#x2F;repository&#x2F;cn&#x2F;afterturn&#x2F;easypoi-web&#x2F;3.0.3&#x2F;easypoi-web-3.0.3.jar:&#x2F;Users&#x2F;zhuningning&#x2F;.m2&#x2F;repository&#x2F;org&#x2F;springframework&#x2F;spring-web&#x2F;3.1.1.RELEASE&#x2F;spring-web-3.1.1.RELEASE.jar:&#x2F;Users&#x2F;zhuningning&#x2F;.m2&#x2F;repository&#x2F;aopalliance&#x2F;aopalliance&#x2F;1.0&#x2F;aopalliance-1.0.jar:&#x2F;Users&#x2F;zhuningning&#x2F;.m2&#x2F;repository&#x2F;org&#x2F;springframework&#x2F;spring-webmvc&#x2F;3.1.1.RELEASE&#x2F;spring-webmvc-3.1.1.RELEASE.jar:&#x2F;Users&#x2F;zhuningning&#x2F;.m2&#x2F;repository&#x2F;org&#x2F;springframework&#x2F;spring-asm&#x2F;3.1.1.RELEASE&#x2F;spring-asm-3.1.1.RELEASE.jar:&#x2F;Users&#x2F;zhuningning&#x2F;.m2&#x2F;repository&#x2F;org&#x2F;springframework&#x2F;spring-context-support&#x2F;3.1.1.RELEASE&#x2F;spring-context-support-3.1.1.RELEASE.jar:&#x2F;Users&#x2F;zhuningning&#x2F;.m2&#x2F;repository&#x2F;cn&#x2F;afterturn&#x2F;easypoi-annotation&#x2F;3.0.3&#x2F;easypoi-annotation-3.0.3.jar:&#x2F;Users&#x2F;zhuningning&#x2F;.m2&#x2F;repository&#x2F;javax&#x2F;servlet&#x2F;javax.servlet-api&#x2F;3.1.0&#x2F;javax.servlet-api-3.1.0.jar:&#x2F;Applications&#x2F;IntelliJ IDEA.app&#x2F;Contents&#x2F;lib&#x2F;idea_rt.jar&quot; com.chen.api.util.jvm.chapter2.StackOverFlowErrorDemo</span><br><span class="line">Connected to the target VM, address: &#39;127.0.0.1:50373&#39;, transport: &#39;socket&#39;</span><br><span class="line">[GC (Allocation Failure)  7699K-&gt;3961K(19456K), 0.0045637 secs]</span><br><span class="line">[GC (Allocation Failure)  12153K-&gt;9254K(19456K), 0.0079381 secs]</span><br><span class="line">[Full GC (Ergonomics)  9254K-&gt;9133K(19456K), 0.1111956 secs]</span><br><span class="line">[Full GC (Ergonomics)  17325K-&gt;14883K(19456K), 0.1398179 secs]</span><br><span class="line">[Full GC (Ergonomics)  16577K-&gt;16432K(19456K), 0.1255392 secs]</span><br><span class="line">[Full GC (Allocation Failure)  16432K-&gt;16415K(19456K), 0.1088586 secs]</span><br><span class="line">java.lang.OutOfMemoryError: Java heap space</span><br><span class="line">Dumping heap to java_pid731.hprof ...</span><br><span class="line">Heap dump file created [28119578 bytes in 0.146 secs]</span><br><span class="line">Exception in thread &quot;main&quot; Disconnected from the target VM, address: &#39;127.0.0.1:50373&#39;, transport: &#39;socket&#39;</span><br><span class="line">java.lang.OutOfMemoryError: Java heap space</span><br><span class="line">    at java.util.Arrays.copyOf(Arrays.java:3210)</span><br><span class="line">    at java.util.Arrays.copyOf(Arrays.java:3181)</span><br><span class="line">    at java.util.ArrayList.grow(ArrayList.java:265)</span><br><span class="line">    at java.util.ArrayList.ensureExplicitCapacity(ArrayList.java:239)</span><br><span class="line">    at java.util.ArrayList.ensureCapacityInternal(ArrayList.java:231)</span><br><span class="line">    at java.util.ArrayList.add(ArrayList.java:462)</span><br><span class="line">    at com.chen.api.util.jvm.chapter2.StackOverFlowErrorDemo.main(StackOverFlowErrorDemo.java:21)</span><br><span class="line"></span><br><span class="line">Process finished with exit code 1</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>异常堆栈信息 java.lang.OutOfMemoryError 紧接着回提示 java heap space</p>
<p>一般是用内存分析工具检查是否是内存泄漏，如果是内存泄漏则可以查看泄漏对到GC roots的因用力按，于是就找到了泄漏对象是通过怎样的路径与roots相关联的导致垃圾收集器无法自动回收他们；</p>
<p>如果不是内存泄漏（内存中的对象确实都还必须存活的），那就要检查虚拟机的堆参数，与机器物理内存对比看是否可以调大，从代码上检查是否在某些对象生命周期过长，持有有状态时间过长的情况，尝试减少程序运行的内存消耗。</p>
<h2 id="虚拟机栈和本地方法栈溢出"><a href="#虚拟机栈和本地方法栈溢出" class="headerlink" title="虚拟机栈和本地方法栈溢出"></a>虚拟机栈和本地方法栈溢出</h2><p>使用 -Xss参数设置栈容量</p>
<p>如果线程请求的栈深度大于虚拟机所允许的最大深度，将抛出StackOverflowError异常；如果虚拟机在扩展栈时无法申请到足够的内存空间，则抛出OutOfMemoryError异常；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">package com.chen.api.util.jvm.chapter2;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * 虚拟机栈和本地方法栈内存溢出测试</span><br><span class="line"> *</span><br><span class="line"> * -verbose:gc -Xms20M -Xmx20M -Xmn10M -Xss300k</span><br><span class="line"> * @author :  chen weijie</span><br><span class="line"> * @Date: 2018-10-23 10:00 AM</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class StackOverFlowErrorDemo &#123;</span><br><span class="line"></span><br><span class="line">    private int stackLength &#x3D; 1;</span><br><span class="line"></span><br><span class="line">    public void stackLeak() &#123;</span><br><span class="line">        stackLength++;</span><br><span class="line">        stackLeak();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) throws Throwable &#123;</span><br><span class="line">        StackOverFlowErrorDemo oom &#x3D; new StackOverFlowErrorDemo();</span><br><span class="line">        try &#123;</span><br><span class="line">            oom.stackLeak();</span><br><span class="line">        &#125; catch (Throwable e) &#123;</span><br><span class="line">            System.out.println(&quot;stack length:&quot; + oom.stackLength);</span><br><span class="line">            throw e;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>运行结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">stack length:2788</span><br><span class="line">Exception in thread &quot;main&quot; java.lang.StackOverflowError</span><br><span class="line">    at com.chen.api.util.jvm.chapter2.StackOverFlowErrorDemo.stackLeak(StackOverFlowErrorDemo.java:15)</span><br><span class="line">    at com.chen.api.util.jvm.chapter2.StackOverFlowErrorDemo.stackLeak(StackOverFlowErrorDemo.java:15)</span><br><span class="line">    at com.chen.api.util.jvm.chapter2.StackOverFlowErrorDemo.stackLeak(StackOverFlowErrorDemo.java:15)</span><br><span class="line">    at com.chen.api.util.jvm.chapter2.StackOverFlowErrorDemo.stackLeak(StackOverFlowErrorDemo.java:15)</span><br><span class="line">    at com.chen.api.util.jvm.chapter2.StackOverFlowErrorDemo.stackLeak(StackOverFlowErrorDemo.java:15)</span><br><span class="line">    at com.chen.api.util.jvm.chapter2.StackOverFlowErrorDemo.stackLeak(StackOverFlowErrorDemo.java:15)</span><br><span class="line">    at com.chen.api.util.jvm.chapter2.StackOverFlowErrorDemo.stackLeak(StackOverFlowErrorDemo.java:15)</span><br><span class="line">    at com.chen.api.util.jvm.chapter2.StackOverFlowErrorDemo.stackLeak(StackOverFlowErrorDemo.java:15)</span><br><span class="line">    at com.chen.api.util.jvm.chapter2.StackOverFlowErrorDemo.stackLeak(StackOverFlowErrorDemo.java:15)</span><br></pre></td></tr></table></figure>

<p>可以看出抛出栈内存溢出的异常，在单个线程下，无论是由于栈帧太大还是虚拟机栈容量太小，当内存无法分配的时候，虚拟机抛出的都是StackOverflowError异常。</p>
<p>如果是建立过多线程导致内存溢出，在不能减少线程数或者更换64位虚拟机的情况下，就只能通过减少最大堆和减少栈容量来换取更多的线程。</p>
<h3 id="创建线程导致内存溢出"><a href="#创建线程导致内存溢出" class="headerlink" title="创建线程导致内存溢出"></a>创建线程导致内存溢出</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * 创建线程导致内存溢出异常</span><br><span class="line"> * 需要将线程栈设置的大些  -Xss2M</span><br><span class="line"> * @author :  chen weijie</span><br><span class="line"> * @Date: 2018-10-23 10:22 AM</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class OutOfMemoryErrorForEachDemo &#123;</span><br><span class="line"></span><br><span class="line">    int i &#x3D;0;</span><br><span class="line"></span><br><span class="line">    private void dontStop()&#123;</span><br><span class="line">        while (true)&#123;</span><br><span class="line">            i++;</span><br><span class="line">            System.out.println(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void stackLeakByThread()&#123;</span><br><span class="line">        while (true)&#123;</span><br><span class="line">            Thread thread &#x3D;new Thread(new Runnable() &#123;</span><br><span class="line">                @Override</span><br><span class="line">                public void run() &#123;</span><br><span class="line">                    dontStop();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            thread.start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        OutOfMemoryErrorForEachDemo oom &#x3D; new OutOfMemoryErrorForEachDemo();</span><br><span class="line">        oom.stackLeakByThread();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>运行结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">1745594</span><br><span class="line">1745595</span><br><span class="line">1745596</span><br><span class="line">1745597</span><br><span class="line">Oct 23, 2018 10:30:55 AM sun.rmi.transport.tcp.TCPTransport$AcceptLoop executeAcceptLoop</span><br><span class="line">WARNING: RMI TCP Accept-0: accept loop for ServerSocket[addr&#x3D;0.0.0.0&#x2F;0.0.0.0,localport&#x3D;51751] throws</span><br><span class="line">java.lang.OutOfMemoryError: unable to create new native thread</span><br><span class="line">    at java.lang.Thread.start0(Native Method)</span><br><span class="line">    at java.lang.Thread.start(Thread.java:717)</span><br><span class="line">    at java.util.concurrent.ThreadPoolExecutor.addWorker(ThreadPoolExecutor.java:957)</span><br><span class="line">    at java.util.concurrent.ThreadPoolExecutor.execute(ThreadPoolExecutor.java:1378)</span><br><span class="line">    at sun.rmi.transport.tcp.TCPTransport$AcceptLoop.executeAcceptLoop(TCPTransport.java:415)</span><br><span class="line">    at sun.rmi.transport.tcp.TCPTransport$AcceptLoop.run(TCPTransport.java:372)</span><br><span class="line">    at java.lang.Thread.run(Thread.java:748)</span><br><span class="line"></span><br><span class="line">1745598</span><br></pre></td></tr></table></figure>

<h2 id="方法区和运行时常量池溢出"><a href="#方法区和运行时常量池溢出" class="headerlink" title="方法区和运行时常量池溢出"></a>方法区和运行时常量池溢出</h2><p>由于运行时常量池是方法区的一部分，所以放在一起测试进行。</p>
<h3 id="运行时常量池内存溢出"><a href="#运行时常量池内存溢出" class="headerlink" title="运行时常量池内存溢出"></a>运行时常量池内存溢出</h3><p>String.intern（）方法是一个native方法，它的作用是:如果字符串常量池中已经包含一个等于String对象的字符串，则返回代表池中的字符串的String对象；否则将此String对象包含的字符串添加到常量池中，并且返回此String对象的引用。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * -verbose:gc -Xms20M -Xmx20M -Xmn10M -Xss2M -XX:PermSize&#x3D;10M -XX:MaxPermSize&#x3D;10M</span><br><span class="line"> * @author :  chen weijie</span><br><span class="line"> * @Date: 2018-10-23 11:09 AM</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class DistantsPoolMemoryStackOverflowDemo &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        &#x2F;&#x2F;使用list保持常量池引用，避免full GC回收常量池行为</span><br><span class="line">        List&lt;String&gt; list &#x3D; new ArrayList&lt;&gt;();</span><br><span class="line">        int i &#x3D; 0;</span><br><span class="line">        for (; ; ) &#123;</span><br><span class="line">            list.add(String.valueOf(i++).intern());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>java.lang.OutOfMemoryError: GC overhead limit exceeded 这种情况发生的原因是, 程序基本上耗尽了所有的可用内存, GC也清理不了</p>
<p>运行结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[Full GC (Ergonomics)  18393K-&gt;18393K(19456K), 0.0671862 secs]</span><br><span class="line">Exception in thread &quot;main&quot; java.lang.OutOfMemoryError: GC overhead limit exceeded</span><br><span class="line">[Full GC (Ergonomics)  18410K-&gt;602K(19456K), 0.0118358 secs]</span><br><span class="line">    at java.lang.Integer.toString(Integer.java:401)</span><br><span class="line">    at java.lang.String.valueOf(String.java:3099)</span><br><span class="line">    at com.chen.api.util.jvm.chapter2.DistantsPoolMemoryStackOverflowDemo.main(DistantsPoolMemoryStackOverflowDemo.java:18)</span><br><span class="line">Disconnected from the target VM, address: &#39;127.0.0.1:52849&#39;, transport: &#39;socket&#39;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="方法区内存溢出"><a href="#方法区内存溢出" class="headerlink" title="方法区内存溢出"></a>方法区内存溢出</h3><p>方法区用于存储class的相关信息，如类名、访问修饰符、常量池、字段描述等。</p>
<p>当前很多主流的框架如spring，在对类进行增强时都使用到CGLib这类字节码技术，增强的类越多，就需要越大的方法区来保证动态生成的class加入到内存。</p>
<p>方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">E:\workSoftware\jdk\jdk1.7.0_80\bin\java -agentlib:jdwp&#x3D;transport&#x3D;dt_socket,address&#x3D;127.0.0.1:62719,suspend&#x3D;y,server&#x3D;n -verbose:gc -Xms20M -Xmx20M -Xmn10M -Xss2M -XX:PermSize&#x3D;10M -XX:MaxPermSize&#x3D;10M -Dfile.encoding&#x3D;UTF-8 -classpath E:\workSoftware\jdk\jdk1.7.0_80\jre\lib\charsets.jar;E:\workSoftware\jdk\jdk1.7.0_80\jre\lib\deploy.jar;E:\workSoftware\jdk\jdk1.7.0_80\jre\lib\ext\access-bridge-64.jar;E:\workSoftware\jdk\jdk1.7.0_80\jre\lib\ext\dnsns.jar;E:\workSoftware\jdk\jdk1.7.0_80\jre\lib\ext\jaccess.jar;E:\workSoftware\jdk\jdk1.7.0_80\jre\lib\ext\localedata.jar;E:\workSoftware\jdk\jdk1.7.0_80\jre\lib\ext\sunec.jar;E:\workSoftware\jdk\jdk1.7.0_80\jre\lib\ext\sunjce_provider.jar;E:\workSoftware\jdk\jdk1.7.0_80\jre\lib\ext\sunmscapi.jar;E:\workSoftware\jdk\jdk1.7.0_80\jre\lib\ext\zipfs.jar;E:\workSoftware\jdk\jdk1.7.0_80\jre\lib\javaws.jar;E:\workSoftware\jdk\jdk1.7.0_80\jre\lib\jce.jar;E:\workSoftware\jdk\jdk1.7.0_80\jre\lib\jfr.jar;E:\workSoftware\jdk\jdk1.7.0_80\jre\lib\jfxrt.jar;E:\workSoftware\jdk\jdk1.7.0_80\jre\lib\jsse.jar;E:\workSoftware\jdk\jdk1.7.0_80\jre\lib\management-agent.jar;E:\workSoftware\jdk\jdk1.7.0_80\jre\lib\plugin.jar;E:\workSoftware\jdk\jdk1.7.0_80\jre\lib\resources.jar;E:\workSoftware\jdk\jdk1.7.0_80\jre\lib\rt.jar;F:\ideaWorkSpace\JVMTest\target\classes;E:\workSoftware\maven\maven-repository\org\springframework\spring-context\4.3.5.RELEASE\spring-context-4.3.5.RELEASE.jar;E:\workSoftware\maven\maven-repository\org\springframework\spring-aop\4.3.5.RELEASE\spring-aop-4.3.5.RELEASE.jar;E:\workSoftware\maven\maven-repository\org\springframework\spring-beans\4.3.5.RELEASE\spring-beans-4.3.5.RELEASE.jar;E:\workSoftware\maven\maven-repository\org\springframework\spring-core\4.3.5.RELEASE\spring-core-4.3.5.RELEASE.jar;E:\workSoftware\maven\maven-repository\commons-logging\commons-logging\1.2\commons-logging-1.2.jar;E:\workSoftware\maven\maven-repository\org\springframework\spring-expression\4.3.5.RELEASE\spring-expression-4.3.5.RELEASE.jar;E:\workSoftware\idea\lib\idea_rt.jar com.sunlands.test.CGLibStackOverflowError</span><br><span class="line">Connected to the target VM, address: &#39;127.0.0.1:62719&#39;, transport: &#39;socket&#39;</span><br><span class="line">[GC 8192K-&gt;1427K(19456K), 0.0024569 secs]</span><br><span class="line">[GC 9619K-&gt;1437K(19456K), 0.0010156 secs]</span><br><span class="line">[GC 9629K-&gt;1493K(19456K), 0.0010742 secs]</span><br><span class="line">[GC 9685K-&gt;1669K(19456K), 0.0021826 secs]</span><br><span class="line">[GC 9861K-&gt;1813K(19456K), 0.0011027 secs]</span><br><span class="line">[GC 10005K-&gt;2029K(18432K), 0.0013455 secs]</span><br><span class="line">[GC 9197K-&gt;2245K(18944K), 0.0012436 secs]</span><br><span class="line">[GC 9413K-&gt;2413K(18944K), 0.0012815 secs]</span><br><span class="line">[GC 9581K-&gt;2477K(17920K), 0.0009801 secs]</span><br><span class="line">[GC 9645K-&gt;2621K(18432K), 0.0009705 secs]</span><br><span class="line">[GC 8765K-&gt;2757K(18432K), 0.0007623 secs]</span><br><span class="line">[GC 8901K-&gt;2809K(18432K), 0.0004651 secs]</span><br><span class="line">[GC 8953K-&gt;2945K(18432K), 0.0005616 secs]</span><br><span class="line">[GC 9089K-&gt;3069K(18432K), 0.0004116 secs]</span><br><span class="line">[GC 9213K-&gt;3181K(18432K), 0.0005763 secs]</span><br><span class="line">[GC 9325K-&gt;3245K(18432K), 0.0128357 secs]</span><br><span class="line">[GC 9389K-&gt;3341K(18432K), 0.0029091 secs]</span><br><span class="line">[GC 9485K-&gt;3509K(18432K), 0.0004798 secs]</span><br><span class="line">[GC 9653K-&gt;3549K(18432K), 0.0004426 secs]</span><br><span class="line">[GC 9693K-&gt;3690K(18944K), 0.0005880 secs]</span><br><span class="line">[GC 10858K-&gt;3786K(18944K), 0.0005387 secs]</span><br><span class="line">[GC 10954K-&gt;3898K(18944K), 0.0005562 secs]</span><br><span class="line">[GC 11066K-&gt;4010K(18944K), 0.0006051 secs]</span><br><span class="line">[GC 11178K-&gt;4154K(18944K), 0.0005066 secs]</span><br><span class="line">[GC 11322K-&gt;4234K(18944K), 0.0004826 secs]</span><br><span class="line">[GC 11402K-&gt;4298K(18944K), 0.0008164 secs]</span><br><span class="line">[GC 6751K-&gt;4346K(18944K), 0.0005177 secs]</span><br><span class="line">[Full GC 4346K-&gt;3505K(18944K), 0.0425954 secs]</span><br><span class="line">[GC 3505K-&gt;3505K(18944K), 0.0003107 secs]</span><br><span class="line">[Full GC 3505K-&gt;3505K(18944K), 0.0105272 secs]</span><br><span class="line">[GC 3505K-&gt;3505K(18944K), 0.0003374 secs]</span><br><span class="line">[Full GC 3505K-&gt;1687K(18944K), 0.0204737 secs]</span><br><span class="line">[GC 1687K-&gt;1687K(19456K), 0.0003900 secs]</span><br><span class="line">[Full GC 1687K-&gt;1686K(19456K), 0.0088587 secs]</span><br><span class="line">[GC 1851K-&gt;1750K(19456K), 0.0003633 secs]</span><br><span class="line">[Full GCException in thread &quot;main&quot;  1750K-&gt;1682K(19456K), 0.0109055 secs]</span><br><span class="line">[GC 1682K-&gt;1682K(19456K), 0.0002975 secs]</span><br><span class="line">[Full GC 1682K-&gt;1682K(19456K), 0.0092689 secs]</span><br><span class="line">[GC 1846K-&gt;1778K(19456K), 0.0003080 secs]</span><br><span class="line">[Full GC 1778K-&gt;1650K(19456K), 0.0214303 secs]</span><br><span class="line">[GC 1650K-&gt;1650K(19456K), 0.0002951 secs]</span><br><span class="line">[Full GC 1650K-&gt;1650K(19456K), 0.0097328 secs]</span><br><span class="line">[GC 1650K-&gt;1650K(19456K), 0.0002996 secs]</span><br><span class="line">[Full GC 1650K-&gt;1650K(19456K), 0.0082941 secs]</span><br><span class="line">[GC 1650K-&gt;1650K(19456K), 0.0003107 secs]</span><br><span class="line">[Full GCDisconnected from the target VM, address: &#39;127.0.0.1:62719&#39;, transport: &#39;socket&#39;</span><br><span class="line"></span><br><span class="line">Exception: java.lang.OutOfMemoryError thrown from the UncaughtExceptionHandler in thread &quot;main&quot;</span><br><span class="line"> 1650K-&gt;1650K(19456K), 0.0098416 secs]</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>CGLib字节码增强和动态语言以及JSP文件生产的java类文件都需要注意累的回收情况。</p>
<h3 id="本机直接内存溢出"><a href="#本机直接内存溢出" class="headerlink" title="本机直接内存溢出"></a>本机直接内存溢出</h3><p>DirectMemory容量可以通过-XX:MaxDirectoryMemorySize指定，如果不指定这与java最大对内存一直，代码直接通过反射火族Unsafe实例进行内存分类。因此虽使用DirectBuffer分配内存也会抛出内存溢出异常，但它抛出异常并没有真正向操作系统申请分配内存，而是通过计算得知内存无法分配，于是手动抛出异常。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.chenwj.cn/2018-09-19/maven%E5%AE%9E%E6%88%98-2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/favicon.ico">
      <meta itemprop="name" content="陈伟杰">
      <meta itemprop="description" content="学习，坚持。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="茄子的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018-09-19/maven%E5%AE%9E%E6%88%98-2/" class="post-title-link" itemprop="url">maven实战-2</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-09-19 01:25:57" itemprop="dateCreated datePublished" datetime="2018-09-19T01:25:57+08:00">2018-09-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-08-21 01:03:09" itemprop="dateModified" datetime="2020-08-21T01:03:09+08:00">2020-08-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/maven/" itemprop="url" rel="index"><span itemprop="name">maven</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>19k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>17 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="使用maven进行测试"><a href="#使用maven进行测试" class="headerlink" title="使用maven进行测试"></a>使用maven进行测试</h1><p>maven的重要职责就是自动运行单元测试，它通过maven-surefire-plugin与主流的单元测试框架junit4 以及testNG继承，并且能够自动生成丰富的结果报告。</p>
<h2 id="maven-surefire-plugin-插件简介"><a href="#maven-surefire-plugin-插件简介" class="headerlink" title="maven-surefire-plugin 插件简介"></a>maven-surefire-plugin 插件简介</h2><p>maven-surefire-plugin可以被称作测试运行器。生命周期阶段需要绑定到某个插件的目标才可以完成真正的工作。test阶段正是和maven-surefire-plugin的test目标绑定的。</p>
<p>在默认情况下，maven-surefire-plugin插件的test目标会自动执行测试源码路径（src/test/java）下符合一组命名模式的测试类。</p>
<p>1.<strong>/Test*.java 任何子目录下所有命名以Test开头的java类。<br>2.**/*Test.java 任何子目录下所有命名以Test结尾的Java类<br>3.</strong>/*TestCase.java 任何子目录下所有命名以testCase结尾的java类。</p>
<p>只要按照以上模式命名，maven就可以自动运行他们。当然可以自定义测试类的模式。</p>
<p>当然为了运行测试，maven需要自己引入测试框架的依赖。</p>
<h2 id="跳过测试"><a href="#跳过测试" class="headerlink" title="跳过测试"></a>跳过测试</h2><p>以下配置可以跳过测试类</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">maven package -Dmaven.test.skip &#x3D;true</span><br></pre></td></tr></table></figure>

<p>也可以采用配置的形式。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;!-- 编译插件 --&gt;</span><br><span class="line">&lt;plugin&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.maven.plugins&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;maven-compiler-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;configuration&gt;</span><br><span class="line">        &lt;source&gt;1.7&lt;&#x2F;source&gt;</span><br><span class="line">        &lt;target&gt;1.7&lt;&#x2F;target&gt;</span><br><span class="line">        &lt;!-- 略过测试代码的编译，不推荐 --&gt;</span><br><span class="line">        &lt;skip&gt;true&lt;&#x2F;skip&gt;</span><br><span class="line">    &lt;&#x2F;configuration&gt;</span><br><span class="line">&lt;&#x2F;plugin&gt;</span><br><span class="line">&lt;!-- 单元测试插件 --&gt;</span><br><span class="line">&lt;plugin&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.maven.plugins&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;maven-surefire-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;configuration&gt;</span><br><span class="line">        &lt;!-- 略过整个单元测试的执行，不推荐 --&gt;</span><br><span class="line">        &lt;skip&gt;true&lt;&#x2F;skip&gt;</span><br><span class="line">    &lt;&#x2F;configuration&gt;</span><br><span class="line">&lt;&#x2F;plugin&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="动态指定要运行的测试用例"><a href="#动态指定要运行的测试用例" class="headerlink" title="动态指定要运行的测试用例"></a>动态指定要运行的测试用例</h2><p>1.指定单个测试用例</p>
<p>mvn test -Dtest =Randm*Test</p>
<p>2.指定多个测试用例</p>
<p>mvn test -Dtest = ATest,BTest</p>
<h2 id="包含与排除测试用例"><a href="#包含与排除测试用例" class="headerlink" title="包含与排除测试用例"></a>包含与排除测试用例</h2><p>即使不符合测试类命名模式，即便如此，maven-surefire-plugin插件还是允许用户通过额外的配置自定义包含一些其它测试类，或者排除一些复合默认命名模式的测试类。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt; plugin &gt;   </span><br><span class="line">    &lt; groupId &gt; org.apache.maven.plugins &lt;&#x2F; groupId &gt;   </span><br><span class="line">    &lt; artifactId &gt; maven-surefire-plugin &lt;&#x2F; artifactId &gt;   </span><br><span class="line">    &lt; version &gt; 2.5 &lt;&#x2F; version &gt;   </span><br><span class="line">    &lt; configuration &gt;   </span><br><span class="line">        &lt; includes &gt;   </span><br><span class="line">            &lt; include &gt; **&#x2F;*Tests.java &lt;&#x2F; include &gt;   </span><br><span class="line">        &lt;&#x2F; includes &gt;   </span><br><span class="line">        &lt; excludes &gt;   </span><br><span class="line">            &lt; exclude &gt; **&#x2F;*ServiceTest.java &lt;&#x2F; exclude &gt;   </span><br><span class="line">            &lt; exclude &gt; **&#x2F;TempDaoTest.java &lt;&#x2F; exclude &gt;   </span><br><span class="line">        &lt;&#x2F; excludes &gt;   </span><br><span class="line">    &lt;&#x2F; configuration &gt;   </span><br><span class="line">&lt;&#x2F; plugin &gt;  </span><br></pre></td></tr></table></figure>
<h2 id="生成测试报告"><a href="#生成测试报告" class="headerlink" title="生成测试报告"></a>生成测试报告</h2><h3 id="基本测试报告"><a href="#基本测试报告" class="headerlink" title="基本测试报告"></a>基本测试报告</h3><p>默认情况下，maven-surefire-plugin会在项目的target/surefire-reports目录下生成两种格式的错误报告。</p>
<p>– 简单文本格式——内容十分简单，可以看出哪个测试项出错。<br>– 与JUnit兼容的XML格式——XML格式已经成为了Java单元测试报告的事实标准，这个文件可以用其他的工具如IDE来查看。</p>
<h3 id="测试覆盖率报告"><a href="#测试覆盖率报告" class="headerlink" title="测试覆盖率报告"></a>测试覆盖率报告</h3><p>测试覆盖率是衡量项目代码质量的一个重要的参考指标。Cobertura是一个优秀的开源 <a target="_blank" rel="noopener" href="http://cobertura.sourceforge.net/">测试覆盖率统计工具</a> ，Maven通过cobertura-maven-plugin与之集成，用户可 以使用简单的命令为Maven项目生成测试覆盖率报告。运行下面命令生成报告：</p>
<p>mvn cobertura:cobertura </p>
<p>在target/site/cobertura下的index.xml文件可以看到覆盖率报告。</p>
<h3 id="重用测试代码"><a href="#重用测试代码" class="headerlink" title="重用测试代码"></a>重用测试代码</h3><p>当命令行运行mvn package的时候，Maven只会打包主代码及资源文件，并不会对测试代码打包。如果测试代码中有需要重用的代码，这时候就需要对测试代码打包了。<br>这时候需要配置maven-jar-plugin将测试类打包，如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt; plugin &gt;   </span><br><span class="line">    &lt; groupId &gt; org.apache.maven.plugins &lt;&#x2F; groupId &gt;   </span><br><span class="line">    &lt; artifactId &gt; maven-jar-plugin &lt;&#x2F; artifactId &gt;   </span><br><span class="line">    &lt; version &gt; 2.2 &lt;&#x2F; version &gt;   </span><br><span class="line">    &lt; executions &gt;   </span><br><span class="line">        &lt; execution &gt;   </span><br><span class="line">            &lt; goals &gt;   </span><br><span class="line">                &lt; goal &gt; test-jar &lt;&#x2F; goal &gt;   </span><br><span class="line">            &lt;&#x2F; goals &gt;   </span><br><span class="line">        &lt;&#x2F; execution &gt;   </span><br><span class="line">    &lt;&#x2F; executions &gt;   </span><br><span class="line">&lt;&#x2F; plugin &gt;  </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>maven-jar-plugin有两个目标，分别为jar和test-jar。这两个目标都默认绑定到default生命周期的package阶段运行，只是test-jar并没有在超级POM中配置，因此需要我们另外在pom中配置</p>
<h1 id="使用maven构建web应用"><a href="#使用maven构建web应用" class="headerlink" title="使用maven构建web应用"></a>使用maven构建web应用</h1><p>之前我们讨论的都是JAR或者POM的Maven项目，但在现今的互联网时代，我们创建的大部分应用程序都是Web应用，基于Java的Web应用，其标准的打开方式是war。<br>WAR与JAR相似，只不过他可以包含更多的内容，如JSP文件、Servlet、Java类、web.xml配置文件、依赖JAR包、静态web资源（如HTML、CSS、JavaScript文件）等。一个典型的WAR文件会有如下目录结构：</p>
<p><img src="/images/maven/war%E6%96%87%E4%BB%B6%E7%9A%84%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84.png" alt="war文件的目录结构"></p>
<p><img src="/images/maven/maven%E7%9A%84web%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84.png" alt="maven的web目录结构"></p>
<p>1.需要注意的时war文件的目录下有一个lib文件夹，而maven项目下没有，这是因为maven项目的所有依赖都在pom文件中，只有在打包的时候才会被下载到lib文件夹中。</p>
<p>2.web应用全部都是需要依赖servlet-api和jsp-api这两个几乎所有的web应用都要依赖的包。因为他们胡server和api的编写提供支持，但是他们的依赖范围是provided，表示他们不会被打包到war文件中，因为几乎所有的web容器都会提供这两个类库。</p>
<p>3.在一些web项目中，读者可能胡看到finalName元素的配置，该元素用来标识项目生成主构件的名称，该元素默认值已经在超级pom中配置，值为${project.artifactId}-${project.version}.例如<finalName>course</finalName></p>
<h2 id="使用jetty-maven-plugin-进行测试"><a href="#使用jetty-maven-plugin-进行测试" class="headerlink" title="使用jetty-maven-plugin 进行测试"></a>使用jetty-maven-plugin 进行测试</h2><p>传统的web测试要求我们编译/测试/打包及部署，这会消耗大量的时间，jetty-maven-plugin能够节约我们的时间，它可以周期性的减产项目内容，便跟后更新到内置的jetty web容器中，<br>jetty-maven-plugin默认就很好地支持了Maven的项目目录，通常情况下插件发现编译后的变化后，自动将其更新到Jetty容器，就可以直接测试Web页面了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;build&gt;  </span><br><span class="line">    &lt;finalName&gt;rop-sample&lt;&#x2F;finalName&gt;  </span><br><span class="line">    &lt;plugins&gt;  </span><br><span class="line">        &lt;!-- jetty插件 --&gt;  </span><br><span class="line">        &lt;plugin&gt;  </span><br><span class="line">            &lt;groupId&gt;org.mortbay.jetty&lt;&#x2F;groupId&gt;  </span><br><span class="line">            &lt;artifactId&gt;maven-jetty-plugin&lt;&#x2F;artifactId&gt;  </span><br><span class="line">            &lt;version&gt;6.1.5&lt;&#x2F;version&gt;  </span><br><span class="line">            &lt;configuration&gt;  </span><br><span class="line">                &lt;webAppSourceDirectory&gt;src&#x2F;main&#x2F;webapp&lt;&#x2F;webAppSourceDirectory&gt;  </span><br><span class="line">                &lt;scanIntervalSeconds&gt;3&lt;&#x2F;scanIntervalSeconds&gt;  </span><br><span class="line">                &lt;contextPath&gt;&#x2F;&lt;&#x2F;contextPath&gt;  </span><br><span class="line">                &lt;connectors&gt;  </span><br><span class="line">                    &lt;connector implementation&#x3D;&quot;org.mortbay.jetty.nio.SelectChannelConnector&quot;&gt;  </span><br><span class="line">                        &lt;port&gt;8088&lt;&#x2F;port&gt;  </span><br><span class="line">                    &lt;&#x2F;connector&gt;  </span><br><span class="line">                &lt;&#x2F;connectors&gt;  </span><br><span class="line">            &lt;&#x2F;configuration&gt;  </span><br><span class="line">        &lt;&#x2F;plugin&gt;  </span><br><span class="line">    &lt;&#x2F;plugins&gt;  </span><br><span class="line">&lt;&#x2F;build&gt; </span><br><span class="line"></span><br><span class="line">其中scanIntervalSecond表示扫描项目变更的时间间隔，默认为0，表示不扫描。</span><br><span class="line">ContextPath表示项目的访问路径，比如此：http:&#x2F;&#x2F;localhost:8787&#x2F;test&#x2F;</span><br><span class="line"></span><br><span class="line">port表示绑定的端口号，默认监听的端口是8080。</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/machao0903/article/details/73481095">intellij idea使用配置jetty maven 插件</a></p>
<p><a target="_blank" rel="noopener" href="http://stamen.iteye.com/blog/1933452">解决maven热部署webapp下的文件不生效的问题</a></p>
<p>下一步是启动jetty-maven-plugin，不过在此之前需要对settings.xml做个微小的改动，默认的只有org.apache.maven.plugins和org.codehaus.mojo两个groupId下的插件支持简化的命令行调用。</p>
<p>mvn help:system 可以运行是因为groupId是org.apache.maven.plugins。而jetty-maven-plugin的插件不是，为了可以运行，需要在settings.xml中配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;settings&gt;</span><br><span class="line">  &lt;pluginGroups&gt;</span><br><span class="line">  &lt;pluginGroup&gt;</span><br><span class="line">    org.mortbay.jetty</span><br><span class="line">  &lt;&#x2F;pluginGroup&gt;</span><br><span class="line">   &lt;pluginGroups&gt;</span><br><span class="line">&lt;&#x2F;settings&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>然后可以使用 mvn:jetty:run命令，默认监听的是8080端口。</p>
<h2 id="使用cargo实现自动化部署"><a href="#使用cargo实现自动化部署" class="headerlink" title="使用cargo实现自动化部署"></a>使用cargo实现自动化部署</h2><p>为了能在命令行中使用cargo，需要修改maven的settings.xml文件，修改如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;pluginGroup&gt;org.codehaus.cargo&lt;&#x2F;pluginGroup&gt;</span><br></pre></td></tr></table></figure>

<p>Cargo支持两种本地部署的方式：standalone模式和existing模式。</p>
<h3 id="standalone模式"><a href="#standalone模式" class="headerlink" title="standalone模式"></a>standalone模式</h3><p>Cargo会从web容器的安装目录中复制一份配置到用户指定的目录，然后在此基础上部署应用，每次重新构建的时候，这个目录会被清空，所有配置被重新 生成。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;plugin&gt;</span><br><span class="line">    &lt;groupId&gt;org.codehaus.cargo&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;cargo-maven2-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.4.0&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;configuration&gt;</span><br><span class="line">        &lt;container&gt;</span><br><span class="line">            &lt;containerId&gt;tomcat6x&lt;&#x2F;containerId&gt;</span><br><span class="line">            &lt;home&gt;D:\Program Files\apache-tomcat-6.0.18&lt;&#x2F;home&gt;</span><br><span class="line">        &lt;&#x2F;container&gt;</span><br><span class="line">        &lt;configuration&gt;</span><br><span class="line">            &lt;type&gt;standalone&lt;&#x2F;type&gt;</span><br><span class="line">            &lt;home&gt;$&#123;project.build.directory&#125;&#x2F;tomcat6x&lt;&#x2F;home&gt;</span><br><span class="line">             &lt;properties&gt; &lt;cargo.servlet.port&gt;8181&lt;&#x2F;cargo.servlet.port&gt; &lt;&#x2F;properties&gt;</span><br><span class="line">        &lt;&#x2F;configuration&gt;</span><br><span class="line">    &lt;&#x2F;configuration&gt;</span><br><span class="line">&lt;&#x2F;plugin&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>对参数做如下说明：</p>
<p>containerId表示容器的类型。</p>
<p>home表示容器的安装目录。</p>
<p>configuration子元素type表示部署模式。</p>
<p>configuration子元素home表示复制容器配置到什么位置，其中${project.build.directory}表示target目录。</p>
<p>Cargo.servlet.port表示绑定的端口号，默认为8080。</p>
<p>打开命令提示符，执行如下命令：</p>
<p>mvn clean package 和 mvn cargo:run </p>
<p>或者 mvn clean package cargo:run</p>
<h3 id="existing模式"><a href="#existing模式" class="headerlink" title="existing模式"></a>existing模式</h3><p>在该模式中，指定现有的web容器配置目录，cargo会直接使用这些配置并将应用部署到对应的位置。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;plugin&gt;</span><br><span class="line">    &lt;groupId&gt;org.codehaus.cargo&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;cargo-maven2-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.4.0&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;configuration&gt;</span><br><span class="line">        &lt;container&gt;</span><br><span class="line">                &lt;containerId&gt;tomcat6x&lt;&#x2F;containerId&gt;</span><br><span class="line">                &lt;home&gt;D:\Program Files\apache-tomcat-6.0.18&lt;&#x2F;home&gt;</span><br><span class="line">        &lt;&#x2F;container&gt;</span><br><span class="line">        &lt;configuration&gt;</span><br><span class="line">            &lt;type&gt;existing&lt;&#x2F;type&gt;</span><br><span class="line">            &lt;home&gt;D:\Program Files\apache-tomcat-6.0.18&lt;&#x2F;home&gt;</span><br><span class="line">        &lt;&#x2F;configuration&gt;    </span><br><span class="line">    &lt;&#x2F;configuration&gt;</span><br><span class="line">&lt;&#x2F;plugin&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>执行如下命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mvn clean compile</span><br><span class="line"></span><br><span class="line">mvn clean package</span><br><span class="line"></span><br><span class="line">mvn cargo:run</span><br></pre></td></tr></table></figure>
<p>之后cargo会自动把war包部署到D:\Program Files\apache-tomcat-6.0.18\webapps中。</p>
<h3 id="部署至远程web容器"><a href="#部署至远程web容器" class="headerlink" title="部署至远程web容器"></a>部署至远程web容器</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;plugin&gt;</span><br><span class="line">    &lt;groupId&gt;org.codehaus.cargo&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;cargo-maven2-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.4.0&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;configuration&gt;</span><br><span class="line">        &lt;container&gt;</span><br><span class="line">            &lt;containerId&gt;tomcat6x&lt;&#x2F;containerId&gt;</span><br><span class="line">            &lt;type&gt;remote&lt;&#x2F;type&gt;</span><br><span class="line">        &lt;&#x2F;container&gt;</span><br><span class="line">        &lt;configuration&gt;</span><br><span class="line">            &lt;type&gt;runtime&lt;&#x2F;type&gt;</span><br><span class="line">            &lt;properties&gt;</span><br><span class="line">                &lt;cargo.remote.uri&gt;http:&#x2F;&#x2F;10.64.204.188:8080&#x2F;manager&lt;&#x2F;cargo.remote.uri&gt;</span><br><span class="line">                &lt;cargo.remote.username&gt;admin&lt;&#x2F;cargo.remote.username&gt;</span><br><span class="line">                &lt;cargo.remote.password&gt;admin&lt;&#x2F;cargo.remote.password&gt;</span><br><span class="line">            &lt;&#x2F;properties&gt;</span><br><span class="line">        &lt;&#x2F;configuration&gt;</span><br><span class="line">    &lt;&#x2F;configuration&gt;</span><br><span class="line">&lt;&#x2F;plugin&gt;</span><br><span class="line"></span><br><span class="line"> mvn clean compile</span><br><span class="line"> mvn clean package</span><br><span class="line"> mvn cargo:redeploy</span><br><span class="line"></span><br><span class="line">执行上述命令后可以从远程tomcat的控制台中就可以看到部署的项目信息。</span><br></pre></td></tr></table></figure>

<h1 id="版本管理"><a href="#版本管理" class="headerlink" title="版本管理"></a>版本管理</h1><p>版本管理是指项目整体版本的演变过程管理，版本控制是指借助版本控制工具追踪代码的每一个变更。</p>
<p>快照版本和发布版本。快照版本对应了项目的开发过程，往往对应了很长的时间，而正式版本对应了项目的发布，因此仅仅代表某个时刻项目的状态。</p>
<p><img src="/images/maven/%E5%BF%AB%E7%85%A7%E7%89%88%E6%9C%AC%E5%92%8C%E5%8F%91%E5%B8%83%E7%89%88%E6%9C%AC%E4%B9%8B%E9%97%B4%E7%9A%84%E8%BD%AC%E6%8D%A2.png" alt="快照版本和发布版本之间的转换"></p>
<p>满足发布版本的条件：</p>
<p>1.所有自动化测试应当全部通过；<br>2.项目没有配置任何快照版本的依赖；<br>3.项目没有配置任何快照版本的插件；<br>4.项目所包含的代码已经全部提交到版本控制系统中。</p>
<h2 id="版本号的定义"><a href="#版本号的定义" class="headerlink" title="版本号的定义"></a>版本号的定义</h2><p>&lt;主版本&gt;.&lt;次版本&gt;.&lt;增量版本&gt;-&lt;里程碑版本&gt;</p>
<p>主版本表示项目的重大架构变更；</p>
<p>次版本表示较大范围的功能增加和变化以及bug修复；</p>
<p>增量版本表示重大bug的修复；（非必须）</p>
<p>里程碑版本 与正式版本相比表示不是非常稳定，需要很多测试；（非必须）</p>
<h2 id="主干-标签和分支"><a href="#主干-标签和分支" class="headerlink" title="主干 标签和分支"></a>主干 标签和分支</h2><p>主干表示项目开发代码的主体；分支表示从主干的某个点分离出来的代码拷贝；tag表示主干或者分支的某个点的状态，表示项目的稳定状态，通常时发布状态。</p>
<h2 id="自动化版本发布"><a href="#自动化版本发布" class="headerlink" title="自动化版本发布"></a>自动化版本发布</h2><p>流程自动化。maven release plugin提供了这样的功能。主要有三个目标</p>
<p>1.release：prepare 准备版本发布，一次执行下列操作：</p>
<ul>
<li>检查项目是否有未提交的代码；</li>
<li>检查项目是否有快照版本的依赖；</li>
<li>根据用户的输入将快照版本升级为发布版；</li>
<li>将pom中的scm信息更新为标签地址；</li>
<li>基于修改后的pom执行maven构建；</li>
<li>提交pom变更；</li>
<li>基于用户输入人为代码打标签；</li>
<li>将代码从发布版升级为新的快照版本；</li>
<li>提交pom变更；</li>
</ul>
<p>2.release：rollback 回退release：prepare所执行的操作，将pom回退至该操作之前的状态，并提交。需要注意的是不会删除标签，需要用户手动删除。</p>
<p>3.release: perform 执行版本发布，签出 release:prepare生成的标签中的源代码，并在此基础上执行mvn deploy 命令打包并部署构件至仓库；</p>
<p>要为项目发布版本，首先需要为其添加正确的版本控制信息，这是因为maven release plugin需要知道版本控制系统的主干，标签等地址信息才能执行相关的操作。<br>一般的scm信息如代码所示</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;scm&gt;</span><br><span class="line"> &lt;connection&gt;scm:svn:http:&#x2F;&#x2F;192.168.1.103&#x2F;app&#x2F;trunk&lt;&#x2F;connection&gt; --表示只读的scm地址</span><br><span class="line"> &lt;developerConnection&gt;scm:svn:https:&#x2F;&#x2F;192.168.1.103&#x2F;app&#x2F;trunk&lt;&#x2F;developerConnection&gt;--表示一个可写的scm地址</span><br><span class="line"> &lt;url&gt;http:&#x2F;&#x2F;192.168.1.103&#x2F;account&#x2F;trunk&lt;&#x2F;url&gt;--表示可在浏览器访问的url地址</span><br><span class="line">&lt;&#x2F;scm&gt;</span><br><span class="line"></span><br><span class="line">&lt;plugin&gt;</span><br><span class="line"> &lt;groupId&gt;org.apache.maven.plugins&lt;&#x2F;&gt;</span><br><span class="line"> &lt;artifactId&gt;maven-release-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line"> &lt;version&gt;2.0&lt;&#x2F;version&gt;</span><br><span class="line"> &lt;configuration&gt;</span><br><span class="line">  &lt;tagBase&gt;https:&#x2F;&#x2F;192.168.1.103&#x2F;app&#x2F;tags&#x2F;&lt;&#x2F;tagBase&gt;</span><br><span class="line"> &lt;&#x2F;configuration&gt;</span><br><span class="line">&lt;&#x2F;plugin&gt;</span><br><span class="line">注意：</span><br><span class="line">1、本机必须安装命令行可用的svn </span><br><span class="line">2、pom必须配置了可用的部署仓库</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>一切就绪之后，在项目的根目录下运行如下命令：<br>mvn release:prepare 之后，maven release plugin开始准备发布版本，如果检查到项目有未提交的代码，或者有依赖快照版本的会提示出错；<br>如果没有问题，则会提示用户输入想要发布的版本号/标签的名称以及新的快照版本号。</p>
<p>如果标签等信息配置错误，则可以输入release：rollback命令回退发布，maven release plugin会将pom的配置回退到release：prepare之前的状态，但需要注意的是版本控制系统的标签并不会被删除。</p>
<p>如果是多模块的项目，则会提示分别输入每个模块的发布版本号。</p>
<p>运行如下的命令后，maven-release-plugin就会自动为所有子模块使用与父模块相同的发布版本和新的SNAPSHOT版本：</p>
<p>mvn release：prepare -DautoVersionSubModules=true</p>
<p>如果所有的没有问题执行 mvn release:perform。该命令将标签中的代码签出，执行mvn deploy 命令构建刚才准备的1.0.0版本，并部署到仓库中。至此版本1.0.0发布完成。</p>
<h1 id="灵活的构建"><a href="#灵活的构建" class="headerlink" title="灵活的构建"></a>灵活的构建</h1><p>Maven为了支持构建的灵活性，内置三大属性，即：属性   Profile  资源过滤</p>
<h2 id="六大属性"><a href="#六大属性" class="headerlink" title="六大属性"></a>六大属性</h2><p>1.内置属性 ${basedir} 项目根目录， ${version} 表示项目版本。<br>2.pom属性</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$&#123;project.build.sourceDirectory&#125;：项目的主源码目录，默认为src&#x2F;main&#x2F;java&#x2F;。</span><br><span class="line">$&#123;project.build.testSourceDirectory&#125;：项目的测试源码目录，默认为src&#x2F;test&#x2F;java&#x2F;。</span><br><span class="line">$&#123;project.build.directory&#125;：项目构建输出目录，默认为target&#x2F;。</span><br><span class="line">$&#123;project.outputDirectory&#125;：项目的主代码编译输出目录，默认为target&#x2F;classes&#x2F;。</span><br><span class="line">$&#123;project.testOutputDirectory&#125;：项目测试代码编译输出目录，默认为target&#x2F;test-classes&#x2F;。</span><br><span class="line">$&#123;project.groupId&#125;：项目的groupId。</span><br><span class="line">$&#123;project.artifactId&#125;：项目的artifactId。</span><br><span class="line">$&#123;project.version&#125;：项目的version。</span><br><span class="line">$&#123;project.build.finalName&#125;：项目打包输出文件的名称，默认为$&#123;project.artifactId&#125;-$&#123;project.version&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>3.自定义属性</p>
<properties> 
 <sys.version> test </sys.version>
</properties>


<p>4.settings属性</p>
<p>用户以settings来头的属性引用settings文件中的xml元素的值。如常使用的${settings.localRepository} 执行本地仓库的地址</p>
<p>5.java系统属性</p>
<p>所有java系统属性都可以使用maven属性引用，${user.home} 指向了用户目录。</p>
<p>6.环境变量属性</p>
<p>所有环境变量属性都可以使用env.开头的maven属性引用。例如：${env.JAVA_HOME}指代了JAVA_HOME环境变量。</p>
<h2 id="构建环境的差异"><a href="#构建环境的差异" class="headerlink" title="构建环境的差异"></a>构建环境的差异</h2><p>使用不同的profile</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;profiles&gt;</span><br><span class="line">    &lt;profile&gt;</span><br><span class="line">        &lt;id&gt;dev&lt;&#x2F;id&gt;</span><br><span class="line">        &lt;properties&gt;</span><br><span class="line">            &lt;env&gt;dev&lt;&#x2F;env&gt;</span><br><span class="line">        &lt;&#x2F;properties&gt;</span><br><span class="line">        &lt;activation&gt;</span><br><span class="line">            &lt;activeByDefault&gt;true&lt;&#x2F;activeByDefault&gt;</span><br><span class="line">        &lt;&#x2F;activation&gt;</span><br><span class="line">    &lt;&#x2F;profile&gt;</span><br><span class="line">    &lt;profile&gt;</span><br><span class="line">        &lt;id&gt;prd&lt;&#x2F;id&gt;</span><br><span class="line">        &lt;properties&gt;</span><br><span class="line">            &lt;env&gt;prd&lt;&#x2F;env&gt;</span><br><span class="line">        &lt;&#x2F;properties&gt;</span><br><span class="line">    &lt;&#x2F;profile&gt;</span><br><span class="line">&lt;&#x2F;profiles&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="生成项目站点"><a href="#生成项目站点" class="headerlink" title="生成项目站点"></a>生成项目站点</h1><p>使用 maven-site-plugin</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot;</span><br><span class="line">         xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0 http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;groupId&gt;cn.chenwj&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-config&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;!-- 问题解决信息 --&gt;</span><br><span class="line">    &lt;issueManagement&gt;</span><br><span class="line">        &lt;system&gt;Linux&lt;&#x2F;system&gt;</span><br><span class="line">        &lt;url&gt;http:&#x2F;&#x2F;www.baidu.com&#x2F;&lt;&#x2F;url&gt;</span><br><span class="line">    &lt;&#x2F;issueManagement&gt;</span><br><span class="line">    &lt;!-- 持续集成信息 --&gt;</span><br><span class="line">    &lt;ciManagement&gt;</span><br><span class="line">        &lt;url&gt;http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;hudson&lt;&#x2F;url&gt;</span><br><span class="line">        &lt;system&gt;windows&lt;&#x2F;system&gt;</span><br><span class="line">    &lt;&#x2F;ciManagement&gt;</span><br><span class="line">    &lt;!-- 开发人员信息 --&gt;</span><br><span class="line">    &lt;developers&gt;</span><br><span class="line">        &lt;developer&gt;</span><br><span class="line">            &lt;id&gt;liuyan&lt;&#x2F;id&gt;</span><br><span class="line">            &lt;email&gt;suhuanzheng7784877@163.com&lt;&#x2F;email&gt;</span><br><span class="line">            &lt;name&gt;liuyan&lt;&#x2F;name&gt;</span><br><span class="line">            &lt;organization&gt;uxian99&lt;&#x2F;organization&gt;</span><br><span class="line">            &lt;roles&gt;</span><br><span class="line">                &lt;role&gt;softwareengineer&lt;&#x2F;role&gt;</span><br><span class="line">            &lt;&#x2F;roles&gt;</span><br><span class="line">            &lt;timezone&gt;8&lt;&#x2F;timezone&gt;</span><br><span class="line">        &lt;&#x2F;developer&gt;</span><br><span class="line">    &lt;&#x2F;developers&gt;</span><br><span class="line">    &lt;!--许可证 --&gt;</span><br><span class="line">    &lt;licenses&gt;</span><br><span class="line">        &lt;license&gt;</span><br><span class="line">            &lt;url&gt;http:&#x2F;&#x2F;127.0.0.1:8080&lt;&#x2F;url&gt;</span><br><span class="line">            &lt;comments&gt;评论&lt;&#x2F;comments&gt;</span><br><span class="line">            &lt;name&gt;完全开源&lt;&#x2F;name&gt;</span><br><span class="line">        &lt;&#x2F;license&gt;</span><br><span class="line">    &lt;&#x2F;licenses&gt;</span><br><span class="line">    &lt;scm&gt;</span><br><span class="line">        &lt;connection&gt;</span><br><span class="line">            scm:svn:https:&#x2F;&#x2F;liuyan:111111@127.0.0.1:8443&#x2F;svn&#x2F;mysvn&#x2F;mysrc&#x2F;01-OpenSource&#x2F;maven&#x2F;MavenAccount-aggregator</span><br><span class="line">        &lt;&#x2F;connection&gt;</span><br><span class="line">        &lt;developerConnection&gt;</span><br><span class="line">            scm:svn:https:&#x2F;&#x2F;liuyan:111111@127.0.0.1:8443&#x2F;svn&#x2F;mysvn&#x2F;mysrc&#x2F;01-OpenSource&#x2F;maven&#x2F;MavenAccount-aggregator</span><br><span class="line">        &lt;&#x2F;developerConnection&gt;</span><br><span class="line">        &lt;url&gt;https:&#x2F;&#x2F;127.0.0.1:8443&#x2F;svn&#x2F;mysvn&#x2F;mysrc&#x2F;01-OpenSource&#x2F;maven&#x2F;MavenAccount-aggregator</span><br><span class="line">        &lt;&#x2F;url&gt;</span><br><span class="line">    &lt;&#x2F;scm&gt;</span><br><span class="line">    &lt;reporting&gt;</span><br><span class="line">        &lt;plugins&gt;</span><br><span class="line">            &lt;!-- 构建项目站点报告插件--&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;groupId&gt;org.apache.maven.plugins&lt;&#x2F;groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;maven-site-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">                &lt;version&gt;3.0-beta-3&lt;&#x2F;version&gt;</span><br><span class="line">                &lt;configuration&gt;</span><br><span class="line">                    &lt;!-- 配置站点国际化 --&gt;</span><br><span class="line">                    &lt;locales&gt;zh_CN&lt;&#x2F;locales&gt;</span><br><span class="line">                    &lt;!-- 输出编码 --&gt;</span><br><span class="line">                    &lt;outputEncoding&gt;GBK&lt;&#x2F;outputEncoding&gt;</span><br><span class="line">                &lt;&#x2F;configuration&gt;</span><br><span class="line">            &lt;&#x2F;plugin&gt;</span><br><span class="line">            &lt;!-- 构建项目站点报告插件--&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;groupId&gt;org.apache.maven.plugins&lt;&#x2F;groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;maven-site-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">                &lt;version&gt;3.0-beta-3&lt;&#x2F;version&gt;</span><br><span class="line">                &lt;configuration&gt;</span><br><span class="line">                    &lt;!-- 配置报告信息 --&gt;</span><br><span class="line">                    &lt;reportPlugins&gt;</span><br><span class="line">                        &lt;!-- 检查代码规范报告 --&gt;</span><br><span class="line">                        &lt;plugin&gt;</span><br><span class="line">                            &lt;groupId&gt;org.apache.maven.plugins&lt;&#x2F;groupId&gt;</span><br><span class="line">                            &lt;artifactId&gt;maven-checkstyle-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">                        &lt;&#x2F;plugin&gt;</span><br><span class="line">                        &lt;!-- 测试报告 --&gt;</span><br><span class="line">                        &lt;plugin&gt;</span><br><span class="line">                            &lt;groupId&gt;org.apache.maven.plugins&lt;&#x2F;groupId&gt;</span><br><span class="line">                            &lt;artifactId&gt;maven-surefire-report-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">                        &lt;&#x2F;plugin&gt;</span><br><span class="line">                        &lt;!-- 项目基本信息报告 --&gt;</span><br><span class="line">                        &lt;plugin&gt;</span><br><span class="line">                            &lt;groupId&gt;org.apache.maven.plugins&lt;&#x2F;groupId&gt;</span><br><span class="line">                            &lt;artifactId&gt;maven-project-info-reports-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">                            &lt;version&gt;2.2&lt;&#x2F;version&gt;</span><br><span class="line">                            &lt;configuration&gt;</span><br><span class="line">                                &lt;dependencyDetailsEnabled&gt;true&lt;&#x2F;dependencyDetailsEnabled&gt;</span><br><span class="line">                                &lt;dependencyLocationsEnabled&gt;false&lt;&#x2F;dependencyLocationsEnabled&gt;</span><br><span class="line">                            &lt;&#x2F;configuration&gt;</span><br><span class="line">                        &lt;&#x2F;plugin&gt;</span><br><span class="line">                        &lt;!-- 项目API doc报告 --&gt;</span><br><span class="line">                        &lt;plugin&gt;</span><br><span class="line">                            &lt;groupId&gt;org.apache.maven.plugins&lt;&#x2F;groupId&gt;</span><br><span class="line">                            &lt;artifactId&gt;maven-javadoc-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">                            &lt;version&gt;2.7&lt;&#x2F;version&gt;</span><br><span class="line">                        &lt;&#x2F;plugin&gt;</span><br><span class="line">                        &lt;!-- 项目源代码报告 --&gt;</span><br><span class="line">                        &lt;plugin&gt;</span><br><span class="line">                            &lt;groupId&gt;org.codehaus.mojo&lt;&#x2F;groupId&gt;</span><br><span class="line">                            &lt;artifactId&gt;jxr-maven-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">                        &lt;&#x2F;plugin&gt;</span><br><span class="line">                        &lt;!-- 项目还需要做的TODO报告 --&gt;</span><br><span class="line">                        &lt;plugin&gt;</span><br><span class="line">                            &lt;groupId&gt;org.codehaus.mojo&lt;&#x2F;groupId&gt;</span><br><span class="line">                            &lt;artifactId&gt;taglist-maven-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">                        &lt;&#x2F;plugin&gt;</span><br><span class="line">                        &lt;!-- 项目源代码分析报告 --&gt;</span><br><span class="line">                        &lt;plugin&gt;</span><br><span class="line">                            &lt;groupId&gt;org.apache.maven.plugins&lt;&#x2F;groupId&gt;</span><br><span class="line">                            &lt;artifactId&gt;maven-pmd-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">                            &lt;version&gt;2.5&lt;&#x2F;version&gt;</span><br><span class="line">                            &lt;configuration&gt;</span><br><span class="line">                                &lt;linkXref&gt;true&lt;&#x2F;linkXref&gt;</span><br><span class="line">                                &lt;sourceEncoding&gt;GBK&lt;&#x2F;sourceEncoding&gt;</span><br><span class="line">                                &lt;minimumTokens&gt;100&lt;&#x2F;minimumTokens&gt;</span><br><span class="line">                                &lt;targetJdk&gt;1.5&lt;&#x2F;targetJdk&gt;</span><br><span class="line">                            &lt;&#x2F;configuration&gt;</span><br><span class="line">                        &lt;&#x2F;plugin&gt;</span><br><span class="line"></span><br><span class="line">                        &lt;plugin&gt;</span><br><span class="line">                            &lt;groupId&gt;org.apache.maven.plugins&lt;&#x2F;groupId&gt;</span><br><span class="line">                            &lt;artifactId&gt;maven-dependency-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">                            &lt;version&gt;3.1.1&lt;&#x2F;version&gt;</span><br><span class="line">                            &lt;executions&gt;</span><br><span class="line">                                &lt;execution&gt;</span><br><span class="line">                                    &lt;id&gt;copy&lt;&#x2F;id&gt;</span><br><span class="line">                                    &lt;phase&gt;package&lt;&#x2F;phase&gt;</span><br><span class="line">                                    &lt;goals&gt;</span><br><span class="line">                                        &lt;goal&gt;copy&lt;&#x2F;goal&gt;</span><br><span class="line">                                    &lt;&#x2F;goals&gt;</span><br><span class="line">                                    &lt;configuration&gt;</span><br><span class="line">                                        &lt;artifactItems&gt;</span><br><span class="line">                                            &lt;artifactItem&gt;</span><br><span class="line">                                                &lt;groupId&gt;[ groupId ]&lt;&#x2F;groupId&gt;</span><br><span class="line">                                                &lt;artifactId&gt;[ artifactId ]&lt;&#x2F;artifactId&gt;</span><br><span class="line">                                                &lt;version&gt;[ version ]&lt;&#x2F;version&gt;</span><br><span class="line">                                                &lt;type&gt;[ packaging ]&lt;&#x2F;type&gt;</span><br><span class="line">                                                &lt;classifier&gt;[classifier - optional]&lt;&#x2F;classifier&gt;</span><br><span class="line">                                                &lt;overWrite&gt;[ true or false ]&lt;&#x2F;overWrite&gt;</span><br><span class="line">                                                &lt;outputDirectory&gt;[ output directory ]&lt;&#x2F;outputDirectory&gt;</span><br><span class="line">                                                &lt;destFileName&gt;[ filename ]&lt;&#x2F;destFileName&gt;</span><br><span class="line">                                            &lt;&#x2F;artifactItem&gt;</span><br><span class="line">                                        &lt;&#x2F;artifactItems&gt;</span><br><span class="line">                                        &lt;!-- other configurations here --&gt;</span><br><span class="line">                                    &lt;&#x2F;configuration&gt;</span><br><span class="line">                                &lt;&#x2F;execution&gt;</span><br><span class="line">                            &lt;&#x2F;executions&gt;</span><br><span class="line">                        &lt;&#x2F;plugin&gt;</span><br><span class="line">                        &lt;!-- 生成站点文件具体信息报告 --&gt;</span><br><span class="line">                        &lt;plugin&gt;</span><br><span class="line">                            &lt;groupId&gt;org.apache.maven.plugins&lt;&#x2F;groupId&gt;</span><br><span class="line">                            &lt;artifactId&gt;maven-linkcheck-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">                            &lt;version&gt;1.1&lt;&#x2F;version&gt;</span><br><span class="line">                            &lt;configuration&gt;</span><br><span class="line">                            &lt;&#x2F;configuration&gt;</span><br><span class="line">                        &lt;&#x2F;plugin&gt;</span><br><span class="line">                        &lt;!-- 单元测试覆盖率报告 --&gt;</span><br><span class="line">                        &lt;plugin&gt;</span><br><span class="line">                            &lt;groupId&gt;org.codehaus.mojo&lt;&#x2F;groupId&gt;</span><br><span class="line">                            &lt;artifactId&gt;cobertura-maven-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">                        &lt;&#x2F;plugin&gt;</span><br><span class="line">                    &lt;&#x2F;reportPlugins&gt;</span><br><span class="line">                &lt;&#x2F;configuration&gt;</span><br><span class="line">            &lt;&#x2F;plugin&gt;</span><br><span class="line">        &lt;&#x2F;plugins&gt;</span><br><span class="line">    &lt;&#x2F;reporting&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>运行maven site命令后，可以生成站点文件target/site/</p>
<p><img src="/images/maven/site%E7%AB%99%E7%82%B9%E6%96%87%E4%BB%B6.png" alt="site站点文件"></p>
<p>要在浏览器中预览结果，你可以运行mvn site:run，Maven会构建站点并启动一个内嵌的Jetty容器。一旦Jetty启动并开始监听8080端口（默认情况下），你就可以通过在浏览器中输入<a target="_blank" rel="noopener" href="http://localhost:8080/%E6%9F%A5%E7%9C%8B%E9%A1%B9%E7%9B%AE%E7%AB%99%E7%82%B9%E4%BA%86%E3%80%82">http://localhost:8080/查看项目站点了。</a></p>
<p><img src="/images/maven/%E4%B8%B0%E5%AF%8C%E7%9A%84%E9%A1%B9%E7%9B%AE%E4%BF%A1%E6%81%AF.png" alt="丰富的项目信息"></p>
<p>可以通过丰富的项目报告插件配置，生成内容丰富的报告。报告插件不同于普通的插件（<project><build><plugins>）它是配置在<project><reporting><plugins>节点下</p>
<h1 id="pom元素-settings元素以及常用插件"><a href="#pom元素-settings元素以及常用插件" class="headerlink" title="pom元素 settings元素以及常用插件"></a>pom元素 settings元素以及常用插件</h1><p><img src="/images/maven/pom%E5%85%83%E7%B4%A01.png" alt="pom元素1"><br><img src="/images/maven/pom%E5%85%83%E7%B4%A02.png" alt="pom元素2"><br><img src="/images/maven/setting%E5%85%83%E7%B4%A0.png" alt="setting元素"><br><img src="/images/maven/%E5%B8%B8%E7%94%A8%E6%8F%92%E4%BB%B61.png" alt="常用插件1"><br><img src="/images/maven/%E5%B8%B8%E7%94%A8%E6%8F%92%E4%BB%B62.png" alt="常用插件2"></p>
<h1 id="Archetype的使用"><a href="#Archetype的使用" class="headerlink" title="Archetype的使用"></a>Archetype的使用</h1><p>archetype 可以快速生产项目骨架，可以理解archetype是maven项目的模板，例如maven-archetype-quickstart就是最简单的maven项目模板。</p>
<p>archetype是通过maven-archetype-plugin插件来实现的。</p>
<h2 id="使用archetype的一般步骤"><a href="#使用archetype的一般步骤" class="headerlink" title="使用archetype的一般步骤"></a>使用archetype的一般步骤</h2><p>1.执行命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">maven3 :mvn archetype:generate</span><br><span class="line"></span><br><span class="line">maven2 :mvn org.apache.maven.plugins:maven-archetype-plugin:2.0-alpha-5:generate</span><br></pre></td></tr></table></figure>
<p>2.输入基本的参数</p>
<p>groupId artifactId version package </p>
<h2 id="常用archetype介绍"><a href="#常用archetype介绍" class="headerlink" title="常用archetype介绍"></a>常用archetype介绍</h2><ol>
<li><p>maven-archetype-quickstart 最简单的maven项目</p>
</li>
<li><p>maven-archetype-webapp 最简单的web项目</p>
</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.chenwj.cn/2018-07-11/python2-7%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B%E5%85%A5%E9%97%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/favicon.ico">
      <meta itemprop="name" content="陈伟杰">
      <meta itemprop="description" content="学习，坚持。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="茄子的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018-07-11/python2-7%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B%E5%85%A5%E9%97%A8/" class="post-title-link" itemprop="url">python2.7高级教程入门</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-07-11 01:57:51" itemprop="dateCreated datePublished" datetime="2018-07-11T01:57:51+08:00">2018-07-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-08-21 01:03:09" itemprop="dateModified" datetime="2020-08-21T01:03:09+08:00">2020-08-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>9.3k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>8 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="面向对象"><a href="#面向对象" class="headerlink" title="面向对象"></a>面向对象</h1><h2 id="类"><a href="#类" class="headerlink" title="类"></a>类</h2><p>实例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python</span><br><span class="line"># -*- coding: UTF-8 -*-</span><br><span class="line"></span><br><span class="line">class Employee:</span><br><span class="line">    &#39; 所有员工的基类 &#39;</span><br><span class="line">    empCount &#x3D; 0</span><br><span class="line"></span><br><span class="line">    def __init__(self, name, salary):</span><br><span class="line">        self.name &#x3D; name</span><br><span class="line">        self.salary &#x3D; salary</span><br><span class="line">        Employee.empCount +&#x3D; 1</span><br><span class="line"></span><br><span class="line">    def displayCount(self):</span><br><span class="line">        print &quot;total employee %d&quot; % Employee.empCount</span><br><span class="line"></span><br><span class="line">    def displayEmployee(self):</span><br><span class="line">        print &quot;name:&quot;, self.name, &quot;,salary:&quot;, self.salary</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># empCount 变量是一个类变量，它的值将在这个类的所有实例之间共享。你可以在内部类或外部类使用 Employee.empCount 访问。</span><br><span class="line"># 第一种方法__init__()方法是一种特殊的方法，被称为类的构造函数或初始化方法，当创建了这个类的实例时就会调用该方法</span><br><span class="line"># self 代表类的实例，self 在定义类的方法时是必须有的，虽然在调用时不必传入相应的参数。</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="创建实例对象和访问属性与调用方法"><a href="#创建实例对象和访问属性与调用方法" class="headerlink" title="创建实例对象和访问属性与调用方法"></a>创建实例对象和访问属性与调用方法</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">emp1 &#x3D; Employee(&quot;lee&quot;, 2000)</span><br><span class="line">emp2 &#x3D; Employee(&quot;zhang&quot;, 4000)</span><br><span class="line"></span><br><span class="line">emp1.displayCount()</span><br><span class="line">emp2.displayEmployee()</span><br><span class="line"></span><br><span class="line">print &quot;total employee %d&quot; % Employee.empCount</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="对属性的操作"><a href="#对属性的操作" class="headerlink" title="对属性的操作"></a>对属性的操作</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">emp1.age &#x3D; 7  # 添加一个 &#39;age&#39; 属性</span><br><span class="line">emp1.age &#x3D; 8  # 修改 &#39;age&#39; 属性</span><br><span class="line">del emp1.age  # 删除 &#39;age&#39; 属性</span><br><span class="line"></span><br><span class="line">hasattr(emp1, &#39;age&#39;)    # 如果存在 &#39;age&#39; 属性返回 True。</span><br><span class="line">getattr(emp1, &#39;age&#39;)    # 返回 &#39;age&#39; 属性的值</span><br><span class="line">setattr(emp1, &#39;age&#39;, 8) # 添加属性 &#39;age&#39; 值为 8</span><br><span class="line">delattr(emp1, &#39;age&#39;)    # 删除属性 &#39;age&#39;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="python内置类属性"><a href="#python内置类属性" class="headerlink" title="python内置类属性"></a>python内置类属性</h2><ul>
<li><strong>dict</strong> : 类的属性（包含一个字典，由类的数据属性组成）</li>
<li><strong>doc</strong> :类的文档字符串</li>
<li><strong>name</strong>: 类名</li>
<li><strong>module</strong>: 类定义所在的模块（类的全名是’<strong>main</strong>.className’，如果类位于一个导入模块mymod中，那么className.<strong>module</strong> 等于 mymod）</li>
<li><strong>bases</strong> : 类的所有父类构成元素（包含了一个由所有父类组成的元组）</li>
</ul>
<h2 id="python对象销毁-垃圾回收"><a href="#python对象销毁-垃圾回收" class="headerlink" title="python对象销毁(垃圾回收)"></a>python对象销毁(垃圾回收)</h2><p>Python 使用了引用计数这一简单技术来跟踪和回收垃圾。在 Python 内部记录着所有使用中的对象各有多少引用。<br>一个内部跟踪变量，称为一个引用计数器。<br>当对象被创建时， 就创建了一个引用计数， 当这个对象不再需要时， 也就是说， 这个对象的引用计数变为0 时， 它被垃圾回收。但是回收不是”立即”的， 由解释器在适当的时机，将垃圾对象占用的内存空间回收。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python</span><br><span class="line"># -*- coding: UTF-8 -*-</span><br><span class="line"> </span><br><span class="line">class Point:</span><br><span class="line">   def __init__( self, x&#x3D;0, y&#x3D;0):</span><br><span class="line">      self.x &#x3D; x</span><br><span class="line">      self.y &#x3D; y</span><br><span class="line">   def __del__(self):</span><br><span class="line">      class_name &#x3D; self.__class__.__name__</span><br><span class="line">      print class_name, &quot;销毁&quot;</span><br><span class="line"> </span><br><span class="line">pt1 &#x3D; Point()</span><br><span class="line">pt2 &#x3D; pt1</span><br><span class="line">pt3 &#x3D; pt1</span><br><span class="line">print id(pt1), id(pt2), id(pt3) # 打印对象的id</span><br><span class="line">del pt1</span><br><span class="line">del pt2</span><br><span class="line">del pt3</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="类的继承"><a href="#类的继承" class="headerlink" title="类的继承"></a>类的继承</h2><p>通过继承创建的新类称为子类或派生类，被继承的类称为基类、父类或超类。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">class SubClassName (ParentClass1[, ParentClass2, ...]):</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="方法重写"><a href="#方法重写" class="headerlink" title="方法重写"></a>方法重写</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python</span><br><span class="line"># -*- coding: UTF-8 -*-</span><br><span class="line"> </span><br><span class="line">class Parent:        # 定义父类</span><br><span class="line">   def myMethod(self):</span><br><span class="line">      print &#39;调用父类方法&#39;</span><br><span class="line"> </span><br><span class="line">class Child(Parent): # 定义子类</span><br><span class="line">   def myMethod(self):</span><br><span class="line">      print &#39;调用子类方法&#39;</span><br><span class="line"> </span><br><span class="line">c &#x3D; Child()          # 子类实例</span><br><span class="line">c.myMethod()         # 子类调用重写方法</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="类属性与方法"><a href="#类属性与方法" class="headerlink" title="类属性与方法"></a>类属性与方法</h2><h3 id="类的私有属性"><a href="#类的私有属性" class="headerlink" title="类的私有属性"></a>类的私有属性</h3><p>__private_attrs：两个下划线开头，声明该属性为私有，不能在类的外部被使用或直接访问。在类内部的方法中使用时 self.__private_attrs。</p>
<h3 id="类的方法"><a href="#类的方法" class="headerlink" title="类的方法"></a>类的方法</h3><p>在类的内部，使用 def 关键字可以为类定义一个方法，与一般函数定义不同，类方法必须包含参数 self,且为第一个参数</p>
<h3 id="类的私有方法"><a href="#类的私有方法" class="headerlink" title="类的私有方法"></a>类的私有方法</h3><p>__private_method：两个下划线开头，声明该方法为私有方法，不能在类的外部调用。在类的内部调用 self.__private_methods</p>
<p>Python不允许实例化的类访问私有数据，但你可以使用 object._className__attrName（ 对象名._类名__私有属性名 ）访问属性</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python</span><br><span class="line"># -*- coding: UTF-8 -*-</span><br><span class="line"></span><br><span class="line">class Runoob:</span><br><span class="line">    __site &#x3D; &quot;www.runoob.com&quot;</span><br><span class="line"></span><br><span class="line">runoob &#x3D; Runoob()</span><br><span class="line">print runoob._Runoob__site</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="单下划线、双下划线、头尾双下划线说明："><a href="#单下划线、双下划线、头尾双下划线说明：" class="headerlink" title="单下划线、双下划线、头尾双下划线说明："></a>单下划线、双下划线、头尾双下划线说明：</h2><ul>
<li><strong>foo</strong>: 定义的是特殊方法，一般是系统定义名字 ，类似 <strong>init</strong>() 之类的。</li>
<li>_foo: 以单下划线开头的表示的是 protected 类型的变量，即保护类型只能允许其本身与子类进行访问，不能用于 from module import *</li>
<li>__foo: 双下划线的表示的是私有类型(private)的变量, 只能是允许这个类本身进行访问了。</li>
</ul>
<h1 id="python正则表达式"><a href="#python正则表达式" class="headerlink" title="python正则表达式"></a>python正则表达式</h1><p>Python 自1.5版本起增加了re 模块，它提供 Perl 风格的正则表达式模式。</p>
<h2 id="re-match函数"><a href="#re-match函数" class="headerlink" title="re.match函数"></a>re.match函数</h2><p>re.match 尝试从字符串的起始位置匹配一个模式，如果不是起始位置匹配成功的话，match()就返回none。</p>
<p>re.match(pattern, string, flags=0)</p>
<ul>
<li><p>pattern    匹配的正则表达式</p>
</li>
<li><p>string    要匹配的字符串。</p>
</li>
<li><p>flags    标志位，用于控制正则表达式的匹配方式，如：是否区分大小写，多行匹配等等。</p>
</li>
</ul>
<h2 id="group"><a href="#group" class="headerlink" title="group"></a>group</h2><p>我们可以使用group(num) 或 groups() 匹配对象函数来获取匹配表达式。</p>
<ul>
<li>group(num=0)    匹配的整个表达式的字符串，group() 可以一次输入多个组号，在这种情况下它将返回一个包含那些组所对应值的元组。</li>
<li>groups()    返回一个包含所有小组字符串的元组，从 1 到 所含的小组号。</li>
</ul>
<h2 id="re-search方法"><a href="#re-search方法" class="headerlink" title="re.search方法"></a>re.search方法</h2><p>re.search  扫描整个字符串并返回第一个成功的匹配。</p>
<h2 id="re-match与re-search的区别"><a href="#re-match与re-search的区别" class="headerlink" title="re.match与re.search的区别"></a>re.match与re.search的区别</h2><p>re.match只匹配字符串的开始，如果字符串开始不符合正则表达式，则匹配失败，函数返回None；而re.search匹配整个字符串，直到找到一个匹配。</p>
<h2 id="检索和替换-re-sub"><a href="#检索和替换-re-sub" class="headerlink" title="检索和替换 re.sub"></a>检索和替换 re.sub</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">re.sub(pattern, repl, string, count&#x3D;0, flags&#x3D;0)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>pattern : 正则中的模式字符串。</li>
<li>repl : 替换的字符串，也可为一个函数。</li>
<li>string : 要被查找替换的原始字符串。</li>
<li>count : 模式匹配后替换的最大次数，默认 0 表示替换所有的匹配。</li>
</ul>
<h2 id="re-compile-函数"><a href="#re-compile-函数" class="headerlink" title="re.compile 函数"></a>re.compile 函数</h2><p>compile 函数用于编译正则表达式，生成一个正则表达式（ Pattern ）对象，供 match() 和 search() 这两个函数使用。<br>语法格式为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">re.compile(pattern[, flags])</span><br><span class="line"></span><br><span class="line">pattern : 一个字符串形式的正则表达式</span><br><span class="line">flags : 可选，表示匹配模式，比如忽略大小写，多行模式等，具体参数为：</span><br><span class="line">re.I 忽略大小写</span><br><span class="line">re.L 表示特殊字符集 \w, \W, \b, \B, \s, \S 依赖于当前环境</span><br><span class="line">re.M 多行模式</span><br><span class="line">re.S 即为 . 并且包括换行符在内的任意字符（. 不包括换行符）</span><br><span class="line">re.U 表示特殊字符集 \w, \W, \b, \B, \d, \D, \s, \S 依赖于 Unicode 字符属性数据库</span><br><span class="line">re.X 为了增加可读性，忽略空格和 # 后面的注释</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">pattern &#x3D; re.compile(r&#39;\d+&#39;)                    # 用于匹配至少一个数字</span><br><span class="line">m &#x3D; pattern.match(&#39;one12twothree34four&#39;)        # 查找头部，没有匹配</span><br><span class="line">print m</span><br><span class="line">m &#x3D; pattern.match(&#39;one12twothree34four&#39;, 2, 10) # 从&#39;e&#39;的位置开始匹配，没有匹配</span><br><span class="line">print m</span><br><span class="line">m &#x3D; pattern.match(&#39;one12twothree34four&#39;, 3, 10) # 从&#39;1&#39;的位置开始匹配，正好匹配</span><br><span class="line">print m                                         # 返回一个 Match 对象</span><br><span class="line">print m.group(0)   # 可省略 0</span><br><span class="line">print m.start(0)   # 可省略 0</span><br><span class="line">print m.end(0)     # 可省略 0</span><br><span class="line">print m.span(0)    # 可省略 0</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>在上面，当匹配成功时返回一个 Match 对象，其中：</p>
<ul>
<li>group([group1, …]) 方法用于获得一个或多个分组匹配的字符串，当要获得整个匹配的子串时，可直接使用 group() 或 group(0)；</li>
<li>start([group]) 方法用于获取分组匹配的子串在整个字符串中的起始位置（子串第一个字符的索引），参数默认值为 0；</li>
<li>end([group]) 方法用于获取分组匹配的子串在整个字符串中的结束位置（子串最后一个字符的索引+1），参数默认值为 0；</li>
<li>span([group]) 方法返回 (start(group), end(group))。</li>
</ul>
<h2 id="findall"><a href="#findall" class="headerlink" title="findall"></a>findall</h2><p>在字符串中找到正则表达式所匹配的所有子串，并返回一个列表，如果没有找到匹配的，则返回空列表。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">findall(string[, pos[, endpos]])</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>string : 待匹配的字符串。</li>
<li>pos : 可选参数，指定字符串的起始位置，默认为 0。</li>
<li>endpos : 可选参数，指定字符串的结束位置，默认为字符串的长度。</li>
</ul>
<h2 id="re-finditer"><a href="#re-finditer" class="headerlink" title="re.finditer"></a>re.finditer</h2><p>和 findall 类似，在字符串中找到正则表达式所匹配的所有子串，并把它们作为一个迭代器返回。</p>
<p>re.finditer(pattern, string, flags=0)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">it &#x3D; re.finditer(r&quot;\d+&quot;,&quot;12a32bc43jf3&quot;)</span><br><span class="line">for match in it:</span><br><span class="line">    print (match.group() )</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="re-split"><a href="#re-split" class="headerlink" title="re.split"></a>re.split</h2><p>split 方法按照能够匹配的子串将字符串分割后返回列表</p>
<h2 id="正则表达式对象"><a href="#正则表达式对象" class="headerlink" title="正则表达式对象"></a>正则表达式对象</h2><h3 id="re-RegexObject"><a href="#re-RegexObject" class="headerlink" title="re.RegexObject"></a>re.RegexObject</h3><p>re.compile() 返回 RegexObject 对象。</p>
<h3 id="re-MatchObject"><a href="#re-MatchObject" class="headerlink" title="re.MatchObject"></a>re.MatchObject</h3><ul>
<li>group() 返回被 RE 匹配的字符串。</li>
<li>start() 返回匹配开始的位置</li>
<li>end() 返回匹配结束的位置</li>
<li>span() 返回一个元组包含匹配 (开始,结束) 的位置</li>
</ul>
<h2 id="正则表达式模式"><a href="#正则表达式模式" class="headerlink" title="正则表达式模式"></a>正则表达式模式</h2><ul>
<li>字母和数字表示他们自身。一个正则表达式模式中的字母和数字匹配同样的字符串。</li>
<li>多数字母和数字前加一个反斜杠时会拥有不同的含义。</li>
<li>标点符号只有被转义时才匹配自身，否则它们表示特殊的含义。</li>
<li>反斜杠本身需要使用反斜杠转义。</li>
<li>由于正则表达式通常都包含反斜杠，所以你最好使用原始字符串来表示它们。模式元素(如 r’\t’，等价于 ‘\t’)匹配相应的特殊字符。</li>
</ul>
<h1 id="CGI编程"><a href="#CGI编程" class="headerlink" title="CGI编程"></a>CGI编程</h1><p>Python 提供了两个级别访问的网络服务。：</p>
<ol>
<li>低级别的网络服务支持基本的 Socket，它提供了标准的 BSD Sockets API，可以访问底层操作系统Socket接口的全部方法。</li>
<li>高级别的网络服务模块 SocketServer， 它提供了服务器中心类，可以简化网络服务器的开发。</li>
</ol>
<h2 id="socket-函数"><a href="#socket-函数" class="headerlink" title="socket()函数"></a>socket()函数</h2><p>socket.socket([family[, type[, proto]]])</p>
<p>family: 套接字家族可以使AF_UNIX或者AF_INET</p>
<p>type: 套接字类型可以根据是面向连接的还是非连接分为SOCK_STREAM或SOCK_DGRAM</p>
<p>protocol: 一般不填默认为0.</p>
<h2 id="Socket-对象-内建-方法"><a href="#Socket-对象-内建-方法" class="headerlink" title="Socket 对象(内建)方法"></a>Socket 对象(内建)方法</h2><h3 id="服务器端套接字"><a href="#服务器端套接字" class="headerlink" title="服务器端套接字"></a>服务器端套接字</h3><p>s.bind() 绑定地址（host,port）到套接字， 在AF_INET下,以元组（host,port）的形式表示地址。</p>
<p>s.listen() 开始TCP监听</p>
<p>s.accept() 被动接受TCP客户端连接,(阻塞式)等待连接的到来</p>
<h3 id="客户端套接字"><a href="#客户端套接字" class="headerlink" title="客户端套接字"></a>客户端套接字</h3><p>s.connect()    主动初始化TCP服务器连接，。一般address的格式为元组（hostname,port），如果连接出错，返回socket.error错误。</p>
<h3 id="公共用途的套接字函数"><a href="#公共用途的套接字函数" class="headerlink" title="公共用途的套接字函数"></a>公共用途的套接字函数</h3><p>s.recv() 接收TCP数据，数据以字符串形式返回，bufsize指定要接收的最大数据量。flag提供有关消息的其他信息，通常可以忽略。</p>
<p>s.send() 发送TCP数据，将string中的数据发送到连接的套接字。返回值是要发送的字节数量，该数量可能小于string的字节大小。</p>
<p>s.close() 关闭套接字</p>
<p>客户端示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python</span><br><span class="line"># -*- coding: UTF-8 -*-</span><br><span class="line"># 文件名：client.py</span><br><span class="line"></span><br><span class="line">import socket               # 导入 socket 模块</span><br><span class="line"></span><br><span class="line">s &#x3D; socket.socket()         # 创建 socket 对象</span><br><span class="line">host &#x3D; socket.gethostname() # 获取本地主机名</span><br><span class="line">port &#x3D; 12345                # 设置端口号</span><br><span class="line"></span><br><span class="line">s.connect((host, port))</span><br><span class="line">print s.recv(1024)</span><br><span class="line">s.close() </span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="Python-Internet-模块"><a href="#Python-Internet-模块" class="headerlink" title="Python Internet 模块"></a>Python Internet 模块</h3><p><img src="/images/python/2.7/PythonInternet%E6%A8%A1%E5%9D%97.png" alt="Python Internet 模块"></p>
<h1 id="python多线程"><a href="#python多线程" class="headerlink" title="python多线程"></a>python多线程</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">thread.start_new_thread ( function, args[, kwargs] </span><br><span class="line"></span><br><span class="line">function - 线程函数。</span><br><span class="line"></span><br><span class="line">args - 传递给线程函数的参数,他必须是个tuple类型。</span><br><span class="line"></span><br><span class="line">kwargs - 可选参数。</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="python多线程的例子"><a href="#python多线程的例子" class="headerlink" title="python多线程的例子"></a>python多线程的例子</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"></span><br><span class="line">import thread</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 为线程定义一个函数</span><br><span class="line">def print_time(threadName, delay):</span><br><span class="line">    count &#x3D; 0</span><br><span class="line">    while (count &lt; 5):</span><br><span class="line">        time.sleep(delay)</span><br><span class="line">        count &#x3D; +1</span><br><span class="line">        print &quot;%s: %s&quot; % (threadName, time.ctime(time.time()))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 创建两个线程</span><br><span class="line">try:</span><br><span class="line">    thread.start_new_thread(print_time, (&quot;Thread-1&quot;, 2), )</span><br><span class="line">    thread.start_new_thread(print_time, (&quot;Thread-2&quot;, 4), )</span><br><span class="line">except:</span><br><span class="line">    print &quot;Error: unable to start thread&quot;</span><br><span class="line"></span><br><span class="line">while 1:</span><br><span class="line">    pass</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="线程模块"><a href="#线程模块" class="headerlink" title="线程模块"></a>线程模块</h2><p>Python通过两个标准库thread和threading提供对线程的支持。thread提供了低级别的、原始的线程以及一个简单的锁</p>
<p>threading.currentThread(): 返回当前的线程变量。</p>
<p>threading.enumerate(): 返回一个包含正在运行的线程的list。正在运行指线程启动后、结束前，不包括启动前和终止后的线程。</p>
<p>threading.activeCount(): 返回正在运行的线程数量，与len(threading.enumerate())有相同的结果。</p>
<p>线程模块同样提供了Thread类来处理线程，Thread类提供了以下方法:</p>
<p>run(): 用以表示线程活动的方法。</p>
<p>start():启动线程活动。</p>
<p>join([time]): 等待至线程中止。这阻塞调用线程直至线程的join() 方法被调用中止-正常退出或者抛出未处理的异常-或者是可选的超时发生。</p>
<p>isAlive(): 返回线程是否活动的。</p>
<p>getName(): 返回线程名。</p>
<p>setName(): 设置线程名。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python</span><br><span class="line"># -*- coding: UTF-8 -*-</span><br><span class="line"> </span><br><span class="line">import threading</span><br><span class="line">import time</span><br><span class="line"> </span><br><span class="line">exitFlag &#x3D; 0</span><br><span class="line"> </span><br><span class="line">class myThread (threading.Thread):   #继承父类threading.Thread</span><br><span class="line">    def __init__(self, threadID, name, counter):</span><br><span class="line">        threading.Thread.__init__(self)</span><br><span class="line">        self.threadID &#x3D; threadID</span><br><span class="line">        self.name &#x3D; name</span><br><span class="line">        self.counter &#x3D; counter</span><br><span class="line">    def run(self):                   #把要执行的代码写到run函数里面 线程在创建后会直接运行run函数 </span><br><span class="line">        print &quot;Starting &quot; + self.name</span><br><span class="line">        print_time(self.name, self.counter, 5)</span><br><span class="line">        print &quot;Exiting &quot; + self.name</span><br><span class="line"> </span><br><span class="line">def print_time(threadName, delay, counter):</span><br><span class="line">    while counter:</span><br><span class="line">        if exitFlag:</span><br><span class="line">            (threading.Thread).exit()</span><br><span class="line">        time.sleep(delay)</span><br><span class="line">        print &quot;%s: %s&quot; % (threadName, time.ctime(time.time()))</span><br><span class="line">        counter -&#x3D; 1</span><br><span class="line"> </span><br><span class="line"># 创建新线程</span><br><span class="line">thread1 &#x3D; myThread(1, &quot;Thread-1&quot;, 1)</span><br><span class="line">thread2 &#x3D; myThread(2, &quot;Thread-2&quot;, 2)</span><br><span class="line"> </span><br><span class="line"># 开启线程</span><br><span class="line">thread1.start()</span><br><span class="line">thread2.start()</span><br><span class="line"> </span><br><span class="line">print &quot;Exiting Main Thread&quot;</span><br></pre></td></tr></table></figure>

<h2 id="线程同步"><a href="#线程同步" class="headerlink" title="线程同步"></a>线程同步</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python</span><br><span class="line"># -*- coding: UTF-8 -*-</span><br><span class="line"> </span><br><span class="line">import threading</span><br><span class="line">import time</span><br><span class="line"> </span><br><span class="line">class myThread (threading.Thread):</span><br><span class="line">    def __init__(self, threadID, name, counter):</span><br><span class="line">        threading.Thread.__init__(self)</span><br><span class="line">        self.threadID &#x3D; threadID</span><br><span class="line">        self.name &#x3D; name</span><br><span class="line">        self.counter &#x3D; counter</span><br><span class="line">    def run(self):</span><br><span class="line">        print &quot;Starting &quot; + self.name</span><br><span class="line">       # 获得锁，成功获得锁定后返回True</span><br><span class="line">       # 可选的timeout参数不填时将一直阻塞直到获得锁定</span><br><span class="line">       # 否则超时后将返回False</span><br><span class="line">        threadLock.acquire()</span><br><span class="line">        print_time(self.name, self.counter, 3)</span><br><span class="line">        # 释放锁</span><br><span class="line">        threadLock.release()</span><br><span class="line"> </span><br><span class="line">def print_time(threadName, delay, counter):</span><br><span class="line">    while counter:</span><br><span class="line">        time.sleep(delay)</span><br><span class="line">        print &quot;%s: %s&quot; % (threadName, time.ctime(time.time()))</span><br><span class="line">        counter -&#x3D; 1</span><br><span class="line"> </span><br><span class="line">threadLock &#x3D; threading.Lock()</span><br><span class="line">threads &#x3D; []</span><br><span class="line"> </span><br><span class="line"># 创建新线程</span><br><span class="line">thread1 &#x3D; myThread(1, &quot;Thread-1&quot;, 1)</span><br><span class="line">thread2 &#x3D; myThread(2, &quot;Thread-2&quot;, 2)</span><br><span class="line"> </span><br><span class="line"># 开启新线程</span><br><span class="line">thread1.start()</span><br><span class="line">thread2.start()</span><br><span class="line"> </span><br><span class="line"># 添加线程到线程列表</span><br><span class="line">threads.append(thread1)</span><br><span class="line">threads.append(thread2)</span><br><span class="line"> </span><br><span class="line"># 等待所有线程完成</span><br><span class="line">for t in threads:</span><br><span class="line">    t.join()</span><br><span class="line">print &quot;Exiting Main Thread&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="python-JSON"><a href="#python-JSON" class="headerlink" title="python JSON"></a>python JSON</h1><p>使用 Python 语言来编码和解码 JSON 对象。</p>
<ol>
<li><p>json.dumps    将 Python 对象编码成 JSON 字符串</p>
</li>
<li><p>json.loads    将已编码的 JSON 字符串解码为 Python 对象</p>
</li>
</ol>
<p><strong>json类型转换到python的类型对照表</strong></p>
<p><img src="/images/python/2.7/json%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2%E5%88%B0python%E7%9A%84%E7%B1%BB%E5%9E%8B%E5%AF%B9%E7%85%A7%E8%A1%A8.png" alt="json类型转换到python的类型对照表"></p>
<p><a target="_blank" rel="noopener" href="https://github.com/dmeranda/demjson">Demjson</a> 是python的第三方JSON类库。</p>
<p>1.encode    将 Python 对象编码成 JSON 字符串</p>
<p>2.decode    将已编码的 JSON 字符串解码为 Python 对象</p>
<h1 id="python2-0和python3的区别"><a href="#python2-0和python3的区别" class="headerlink" title="python2.0和python3的区别"></a>python2.0和python3的区别</h1><ol>
<li><p>print语句没有了，取而代之的是print()函数</p>
</li>
<li><p>Python3.X 源码文件默认使用utf-8编码</p>
</li>
<li><p>除法运算：</p>
<p>在python 2.x中/除法就跟我们熟悉的大多数语言，比如Java啊C啊差不多，整数相除的结果是一个整数，把小数部分完全忽略掉，浮点数除法会保留小数点的部分得到一个浮点数的结果。</p>
<p>在python 3.x中/除法不再这么做了，对于整数之间的相除，结果也会是浮点数</p>
</li>
</ol>
<p>等等。。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.chenwj.cn/2018-06-29/python2.7%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/favicon.ico">
      <meta itemprop="name" content="陈伟杰">
      <meta itemprop="description" content="学习，坚持。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="茄子的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018-06-29/python2.7%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">python2.7入门笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-06-29 00:22:00" itemprop="dateCreated datePublished" datetime="2018-06-29T00:22:00+08:00">2018-06-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-08-21 01:03:09" itemprop="dateModified" datetime="2020-08-21T01:03:09+08:00">2020-08-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>19k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>17 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="python介绍"><a href="#python介绍" class="headerlink" title="python介绍"></a>python介绍</h1><p>python是一种解释型、面向对象、动态数据类型高级程序设计语言、脚本语言。由荷兰人发明。</p>
<h1 id="基础语法"><a href="#基础语法" class="headerlink" title="基础语法"></a>基础语法</h1><h2 id="Python-标识符"><a href="#Python-标识符" class="headerlink" title="Python 标识符"></a>Python 标识符</h2><ol>
<li>在 Python 里，标识符由字母、数字、下划线组成。</li>
<li>在 Python 中，所有标识符可以包括英文、数字以及下划线(_)，<strong>但不能以数字开头</strong>。</li>
<li>Python 中的标识符是区分大小写的。</li>
<li>以<strong>下划线开头</strong>的标识符是有特殊意义的。以单下划线开头 _foo 的代表<strong>不能直接访问的类属性</strong>，需通过类提供的接口进行访问，不能用 *<em>from xxx import * 而导入*</em></li>
<li>以<strong>双下划线开头</strong>的 <strong>foo 代表类的私有成员；以<strong>双下划线开头和结尾</strong>的 __foo</strong> 代表 Python 里特殊方法专用的标识，如 <strong>init</strong>() 代表类的构造函数</li>
<li>Python 可以同一行显示多条语句，方法是用分号 ; 分开</li>
</ol>
<h2 id="Python保留字"><a href="#Python保留字" class="headerlink" title="Python保留字"></a>Python保留字</h2><p>包括 and <strong>exec</strong> <strong>not</strong> assert finally or break for <strong>pass</strong> class <strong>from</strong> print continue <strong>global</strong> <strong>raise</strong> def if return <strong>del</strong></p>
<p>import try <strong>elif</strong> in while else <strong>is</strong> <strong>with</strong> <strong>except</strong> <strong>lambda</strong> yield</p>
<h2 id="行和缩进"><a href="#行和缩进" class="headerlink" title="行和缩进"></a>行和缩进</h2><p>Python 的代码块不使用大括号 {} 来控制类，函数以及其他逻辑判断。python 最具特色的就是用缩进来写模块。</p>
<p><strong>常见的错误：</strong> IndentationError: unindent does not match any outer indentation level错误表明，你使用的缩进方式不一致，有的是 tab 键缩进，有的是空格缩进，改为一致即可。</p>
<h2 id="多行语句"><a href="#多行语句" class="headerlink" title="多行语句"></a>多行语句</h2><p>Python语句中一般以新行作为语句的结束符。</p>
<p>但是我们可以使用斜杠（ \）将一行的语句分为多行显示。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">total &#x3D;item_one + \</span><br><span class="line">       item_two + \</span><br><span class="line">       item_three</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>语句中包含 [], {} 或 () 括号就不需要使用多行连接符。如下实例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">days &#x3D; [&#39;Monday&#39;, &#39;Tuesday&#39;, &#39;Wednesday&#39;,</span><br><span class="line">        &#39;Thursday&#39;, &#39;Friday&#39;]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Python-引号"><a href="#Python-引号" class="headerlink" title="Python 引号"></a>Python 引号</h2><p>Python 可以使用引号( ‘ )、双引号( “ )、三引号( ‘’’ 或 “”” ) 来表示字符串，引号的开始与结束必须的相同类型的。</p>
<p>其中三引号可以由多行组成，编写多行文本的快捷语法，常用于文档字符串，在文件的特定地点，被当做注释。</p>
<h2 id="Python-注释"><a href="#Python-注释" class="headerlink" title="Python 注释"></a>Python 注释</h2><p>python中单行注释采用 # 开头。可以在语句或者表达式行末；</p>
<p>多行使用三引号表示</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#39;&#39;&#39;</span><br><span class="line">这是多行注释，使用单引号。</span><br><span class="line">这是多行注释，使用单引号。</span><br><span class="line">这是多行注释，使用单引号。</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">这是多行注释，使用双引号。</span><br><span class="line">这是多行注释，使用双引号。</span><br><span class="line">这是多行注释，使用双引号。</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Python空行"><a href="#Python空行" class="headerlink" title="Python空行"></a>Python空行</h2><p>函数之间或类的方法之间用空行分隔，表示一段新的代码的开始。类和函数入口之间也用一行空行分隔，以突出函数入口的开始。</p>
<p>空行与代码缩进不同，空行并不是Python语法的一部分。书写时不插入空行，Python解释器运行也不会出错。但是空行的作用在于分隔两段不同功能或含义的代码，便于日后代码的维护或重构。</p>
<p>记住：空行也是程序代码的一部分。</p>
<h2 id="等待用户输入"><a href="#等待用户输入" class="headerlink" title="等待用户输入"></a>等待用户输入</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python</span><br><span class="line"># -*- coding: UTF-8 -*-</span><br><span class="line"></span><br><span class="line">raw_input(&quot;按下 enter键退出，其他任意键显示。。。\n&quot;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="同一行显示多条语句"><a href="#同一行显示多条语句" class="headerlink" title="同一行显示多条语句"></a>同一行显示多条语句</h2><p>同一行显示多条语句使用;分割</p>
<h2 id="Print输出"><a href="#Print输出" class="headerlink" title="Print输出"></a>Print输出</h2><p>print 默认输出是换行的，如果要实现不换行需要在变量末尾加上逗号 ,</p>
<h1 id="变量类型"><a href="#变量类型" class="headerlink" title="变量类型"></a>变量类型</h1><p>有五个标准的数据类型：Numbers（数字）/  String（字符串） /List（列表）/Tuple（元组）/Dictionary（字典）</p>
<p>python中变量类型不需要声明，每个变量在内存中创建都包括变量的标识，名称和数据这些信息。</p>
<p>每个变量在使用前都会被赋值，变量赋值后才会被创建。</p>
<h2 id="多个变量赋值"><a href="#多个变量赋值" class="headerlink" title="多个变量赋值"></a>多个变量赋值</h2><p>a =b =c =1</p>
<p>或者 a, b ,c =1,2,”hohn”</p>
<h2 id="python数字"><a href="#python数字" class="headerlink" title="python数字"></a>python数字</h2><p>当你指定一个值时，Number对象就会被创建，使用del语句删除单个或多个对象的引用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var1 &#x3D; 1</span><br><span class="line"></span><br><span class="line">var2 &#x3D;10</span><br><span class="line"></span><br><span class="line">del var1,var2</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>python支持4种不同的数据类型 int long float complex（复数）</p>
<h3 id="Python-math-模块、cmath-模块"><a href="#Python-math-模块、cmath-模块" class="headerlink" title="Python math 模块、cmath 模块"></a>Python math 模块、cmath 模块</h3><p>Python 中数学运算常用的函数基本都在 math 模块、cmath 模块中。</p>
<p>Python math 模块提供了许多对浮点数的数学运算函数。</p>
<p>Python cmath 模块包含了一些用于复数运算的函数。</p>
<p>cmath 模块的函数跟 math 模块函数基本一致，区别是 cmath 模块运算的是复数，math 模块运算的是数学运算。</p>
<h3 id="python数学函数"><a href="#python数学函数" class="headerlink" title="python数学函数"></a>python数学函数</h3><p>abs(x)    返回数字的绝对值，如abs(-10) 返回 10</p>
<p>ceil(x)    返回数字的上入整数，如math.ceil(4.1) 返回 5</p>
<p>cmp(x, y)    如果 x &lt; y 返回 -1, 如果 x == y 返回 0, 如果 x &gt; y 返回 1</p>
<p>exp(x)    返回e的x次幂(ex),如math.exp(1) 返回2.718281828459045</p>
<p>fabs(x)    返回数字的绝对值，如math.fabs(-10) 返回10.0</p>
<p>floor(x)    返回数字的下舍整数，如math.floor(4.9)返回 4</p>
<p>log(x)    如math.log(math.e)返回1.0,math.log(100,10)返回2.0</p>
<p>log10(x)    返回以10为基数的x的对数，如math.log10(100)返回 2.0</p>
<p>max(x1, x2,…)    返回给定参数的最大值，参数可以为序列。</p>
<p>min(x1, x2,…)    返回给定参数的最小值，参数可以为序列。</p>
<p>modf(x)    返回x的整数部分与小数部分，两部分的数值符号与x相同，整数部分以浮点型表示。</p>
<p>pow(x, y)    x**y 运算后的值。</p>
<p>round(x [,n])    返回浮点数x的四舍五入值，如给出n值，则代表舍入到小数点后的位数。</p>
<p>sqrt(x)    返回数字x的平方根</p>
<h2 id="python字符串"><a href="#python字符串" class="headerlink" title="python字符串"></a>python字符串</h2><p>字符串的取值顺序： 从左到右索引默认0开始的，最大范围是字符串长度少1。</p>
<p>如果你要实现从字符串中获取一段子字符串的话，可以使用变量 [头下标:尾下标]，就可以截取相应的字符串(包括头下标，不包括尾下标)</p>
<p>加号（+）是字符串连接运算符，星号（*）是重复操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">print str  # 输出完整字符串</span><br><span class="line">print str[0]  # 输出字符串中的第一个字符</span><br><span class="line">print str[2:5]  # 输出字符串中第三个至第五个之间的字符串</span><br><span class="line">print str[2:]  # 输出从第三个字符开始的字符串</span><br><span class="line">print str * 2  # 输出字符串两次</span><br><span class="line">print str + &quot;TEST&quot;  # 输出连接的字符串</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="python字符串操作符"><a href="#python字符串操作符" class="headerlink" title="python字符串操作符"></a>python字符串操作符</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">a值为：hello  b值为：world</span><br><span class="line"></span><br><span class="line">+    字符串连接   </span><br><span class="line">&gt;&gt;&gt;a + b</span><br><span class="line">&#39;HelloPython&#39;</span><br><span class="line"></span><br><span class="line">*    重复输出字符串</span><br><span class="line">&gt;&gt;&gt;a * 2</span><br><span class="line">&#39;HelloHello&#39;</span><br><span class="line"></span><br><span class="line">[]    通过索引获取字符串中字符</span><br><span class="line">&gt;&gt;&gt;a[1]</span><br><span class="line">&#39;e&#39;</span><br><span class="line"></span><br><span class="line">[ : ]    截取字符串中的一部分</span><br><span class="line">&gt;&gt;&gt;a[1:4]</span><br><span class="line">&#39;ell&#39;</span><br><span class="line"></span><br><span class="line">in    成员运算符 - 如果字符串中包含给定的字符返回 True</span><br><span class="line">&gt;&gt;&gt;&quot;H&quot; in a</span><br><span class="line">True</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>实例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python</span><br><span class="line"># -*- coding: UTF-8 -*-</span><br><span class="line"> </span><br><span class="line">a &#x3D; &quot;Hello&quot;</span><br><span class="line">b &#x3D; &quot;Python&quot;</span><br><span class="line"> </span><br><span class="line">print &quot;a + b 输出结果：&quot;, a + b </span><br><span class="line">print &quot;a * 2 输出结果：&quot;, a * 2 </span><br><span class="line">print &quot;a[1] 输出结果：&quot;, a[1] </span><br><span class="line">print &quot;a[1:4] 输出结果：&quot;, a[1:4] </span><br><span class="line"> </span><br><span class="line">if( &quot;H&quot; in a) :</span><br><span class="line">    print &quot;H 在变量 a 中&quot; </span><br><span class="line">else :</span><br><span class="line">    print &quot;H 不在变量 a 中&quot; </span><br><span class="line"> </span><br><span class="line">if( &quot;M&quot; not in a) :</span><br><span class="line">    print &quot;M 不在变量 a 中&quot; </span><br><span class="line">else :</span><br><span class="line">    print &quot;M 在变量 a 中&quot;</span><br><span class="line"> </span><br><span class="line">print r&#39;\n&#39;</span><br><span class="line">print R&#39;\n&#39;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="Python-字符串格式化"><a href="#Python-字符串格式化" class="headerlink" title="Python 字符串格式化"></a>Python 字符串格式化</h3><p>%s是字符串占位符，%d是数字占位符。  注意字符串和值之间的连接符%</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print &quot;My name is %s and weight is %d kg!&quot; % (&#39;Zara&#39;, 21) </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Python三引号"><a href="#Python三引号" class="headerlink" title="Python三引号"></a>Python三引号</h3><p>python三引号允许一个字符串跨多行，字符串中可以包含换行符、制表符以及其他特殊字符。三引号的语法是一对连续的单引号或者双引号。</p>
<h3 id="python的字符串内建函数"><a href="#python的字符串内建函数" class="headerlink" title="python的字符串内建函数"></a>python的字符串内建函数</h3><h2 id="列表"><a href="#列表" class="headerlink" title="列表"></a>列表</h2><p>列表中值的切割也可以用到变量 [头下标:尾下标] ，就可以截取相应的列表，从左到右索引默认 0 开始，从右到左索引默认 -1 开始，下标可以为空表示取到头或尾。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python</span><br><span class="line"># -*- coding: UTF-8 -*-</span><br><span class="line"></span><br><span class="line">list &#x3D; [&#39;runoob&#39;, 786, 2.23, &#39;john&#39;, 70.2]</span><br><span class="line">tinylist &#x3D; [123, &#39;john&#39;]</span><br><span class="line"></span><br><span class="line">print list  # 输出完整列表</span><br><span class="line">print list[0]  # 输出列表的第一个元素</span><br><span class="line">print list[1:3]  # 输出第二个至第三个元素</span><br><span class="line">print list[2:]  # 输出从第三个开始至列表末尾的所有元素</span><br><span class="line">print tinylist * 2  # 输出列表两次</span><br><span class="line">print list + tinylist  # 打印组合的列表</span><br><span class="line"></span><br><span class="line">list.append(5)  # 添加元素</span><br><span class="line">list.append(&#39;test&#39;)</span><br><span class="line"></span><br><span class="line">del list[4]  # 删除元素</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h3 id="list更新列表"><a href="#list更新列表" class="headerlink" title="list更新列表"></a>list更新列表</h3><p>添加元素：</p>
<p>list.append(5)</p>
<p>删除元素:</p>
<p>del list[4] </p>
<h3 id="列表脚本操作符"><a href="#列表脚本操作符" class="headerlink" title="列表脚本操作符"></a>列表脚本操作符</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">print &#39;列表长度：&#39;,len(list)  # 长度</span><br><span class="line">print &#39;列表组合：&#39;,list +tinylist  # 组合</span><br><span class="line">print &#39;列表重复：&#39;, list * 3</span><br><span class="line">print &#39;某个元素是否在列表中：&#39;,5 in list</span><br><span class="line">for x in list :</span><br><span class="line">    print &#39;循环元素：&#39;,x</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="列表的函数"><a href="#列表的函数" class="headerlink" title="列表的函数"></a>列表的函数</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">lenList &#x3D; [4, 6, 7, 8, 9]</span><br><span class="line"># 获取列表的长度</span><br><span class="line">print len(lenList)</span><br><span class="line"># 获取列表元素的最大值</span><br><span class="line">print max(lenList)</span><br><span class="line"># 将元祖转化为列表</span><br><span class="line">tup &#x3D; (5, 7, 9, 0)</span><br><span class="line">print tup</span><br><span class="line">tupList &#x3D; list(tup)</span><br><span class="line">print tupList</span><br><span class="line"># 添加元素</span><br><span class="line">tupList.append(5)</span><br><span class="line"># 统计某个元素在列表中出现的次数</span><br><span class="line">n &#x3D; tupList.count(5)</span><br><span class="line">print &#39;元素在列表中出现的次数：&#39;, n</span><br><span class="line"></span><br><span class="line"># 一次性扩展多个值</span><br><span class="line">aList &#x3D; [123, &#39;xyz&#39;, &#39;zara&#39;, &#39;abc&#39;, 123]</span><br><span class="line">bList &#x3D; [2009, &#39;manni&#39;]</span><br><span class="line">aList.extend(bList)</span><br><span class="line"></span><br><span class="line"># 列出某个元素在列表中的位置</span><br><span class="line">bList.index(123)</span><br><span class="line"></span><br><span class="line"># 在某个位置插入某个元素</span><br><span class="line">list.insert(3, &#39;dddd&#39;)</span><br><span class="line"></span><br><span class="line"># 移除列表中的一个元素（默认最后一个元素），并且返回该元素的值</span><br><span class="line">bList.pop(-1)</span><br><span class="line"></span><br><span class="line"># 移除列表中某个值的第一个匹配项</span><br><span class="line">bList.remove(5)</span><br><span class="line"></span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">cmp -- 可选参数, 如果指定了该参数会使用该参数的方法进行排序。</span><br><span class="line">key -- 主要是用来进行比较的元素，只有一个参数，具体的函数的参数就是取自于可迭代对象中，指定可迭代对象中的一个元素来进行排序。</span><br><span class="line">reverse -- 排序规则，reverse &#x3D; True 降序， reverse &#x3D; False 升序（默认）。</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"># 排序</span><br><span class="line">list.sort(cmp&#x3D;None, key&#x3D;None, reverse&#x3D;False)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="Python元组"><a href="#Python元组" class="headerlink" title="Python元组"></a>Python元组</h2><p>元组是另一个数据类型，类似于List（列表）。<strong>元组用”()”标识</strong>。内部元素用逗号隔开。但是元组不<strong>能二次赋值</strong>，<strong>相当于只读列表</strong>。</p>
<p>其它和list一样</p>
<h2 id="Python-字典"><a href="#Python-字典" class="headerlink" title="Python 字典"></a>Python 字典</h2><p>字典的每个键值 key=&gt;value 对用冒号 : 分割，每个键值对之间用逗号 , 分割，整个字典包括在花括号 {} 中 ,格式如下所示：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"></span><br><span class="line">dict =&#123;&#125;</span><br><span class="line">dict[<span class="string">&#x27;one&#x27;</span>] = <span class="string">&quot;this is one&quot;</span></span><br><span class="line">dict[<span class="number">2</span>] = <span class="string">&quot;this is two&quot;</span></span><br><span class="line"></span><br><span class="line">tinydict =&#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;john&#x27;</span>,<span class="string">&#x27;code&#x27;</span>:<span class="string">&#x27;123&#x27;</span>,<span class="string">&#x27;dept&#x27;</span>:<span class="string">&#x27;sales&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> dict[<span class="string">&#x27;one&#x27;</span>]</span><br><span class="line"><span class="keyword">print</span> dict[<span class="number">2</span>]</span><br><span class="line"><span class="keyword">print</span> tinydict</span><br><span class="line"><span class="keyword">print</span> dict</span><br><span class="line"><span class="keyword">print</span> tinydict.viewkeys()</span><br><span class="line"><span class="keyword">print</span> tinydict.viewvalues()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>字典值可以没有限制地取任何python对象，既可以是标准的对象，也可以是用户定义的，但键不行。键必须不可变，所以可以用数字，字符串或元组充当，所以用列表就不行。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">tinydict &#x3D; &#123;&#39;name&#39;: &#39;john&#39;, &#39;code&#39;: &#39;123&#39;, &#39;dept&#39;: &#39;sales&#39;&#125;</span><br><span class="line">tinySet &#x3D; &#123;&#39;a&#39;, 6, 7&#125;</span><br><span class="line">tinyList &#x3D; [&#39;f&#39;, 7, 9]</span><br><span class="line">tinyTup &#x3D; (6, 8, 9)</span><br><span class="line">print &#39;tinydict type:&#39;, type(tinydict)</span><br><span class="line">print &#39;tinySet type:&#39;, type(tinySet)</span><br><span class="line">print &#39;tinyList type:&#39;, type(tinyList)</span><br><span class="line">print &#39;tinyTup type:&#39;, type(tinyTup) # 类型</span><br><span class="line"></span><br><span class="line">print &quot;after del:&quot;, dict</span><br><span class="line">dict.clear() # 删除字典的所有元素</span><br><span class="line">print &quot;after clear:&quot;, dict</span><br><span class="line"></span><br><span class="line"># 直接引用</span><br><span class="line">tinydict1 &#x3D; tinydict</span><br><span class="line"></span><br><span class="line"># 浅copy 深拷贝父对象（一级目录），子对象（二级目录）不拷贝，还是引用</span><br><span class="line">tinydict2 &#x3D; tinydict.copy()</span><br><span class="line">tinydict[&#39;name&#39;] &#x3D; &#39;张三&#39;</span><br><span class="line">del tinydict[&#39;name&#39;]</span><br><span class="line"></span><br><span class="line">print &#39;tinydict1：&#39;, tinydict1</span><br><span class="line">print &#39;tinydict2：&#39;, tinydict2</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>不存在则返回默认值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"># 如果键在字典dict里返回true，否则返回false</span><br><span class="line">dict.has_key(key)</span><br><span class="line"></span><br><span class="line"># 以列表返回可遍历的(键, 值) 元组数组</span><br><span class="line">dict.items()</span><br><span class="line"></span><br><span class="line"># 以列表返回一个字典所有的键</span><br><span class="line">dict.keys()</span><br><span class="line"></span><br><span class="line"># 和get()类似, 但如果键不存在于字典中，将会添加键并将值设为default</span><br><span class="line">dict.setdefault(key,&quot;&quot;)</span><br><span class="line"></span><br><span class="line"># 把字典dict2的键&#x2F;值对更新到dict里</span><br><span class="line">dict.update(dict2)</span><br><span class="line"># 以列表返回字典中的所有值</span><br><span class="line">dict.values()</span><br><span class="line"># 删除字典给定键 key 所对应的值，返回值为被删除的值。key值必须给出。 否则，返回default值。</span><br><span class="line">pop(key[,default])</span><br><span class="line"></span><br><span class="line"># 随机返回并删除字典中的一对键和值。</span><br><span class="line">popitem()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="日期和时间"><a href="#日期和时间" class="headerlink" title="日期和时间"></a>日期和时间</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python</span><br><span class="line"># -*- coding: UTF-8 -*-</span><br><span class="line"></span><br><span class="line"># 引入time模块</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line"># 时间戳</span><br><span class="line">ticks &#x3D; time.time()</span><br><span class="line">print &#39;ticks:&#39;, ticks</span><br><span class="line"></span><br><span class="line"># 获取当前时间,元组形式</span><br><span class="line">localTime &#x3D; time.localtime(time.time())</span><br><span class="line">print &#39;localTime:&#39;, localTime</span><br><span class="line"></span><br><span class="line"># 获取格式化日期</span><br><span class="line"># 格式化成2016-03-20 11:45:39形式</span><br><span class="line">print time.strftime(&quot;%Y-%m-%d %H:%M:%S&quot;, time.localtime())</span><br><span class="line"></span><br><span class="line"># 格式化成Sat Mar 28 22:24:24 2016形式</span><br><span class="line">print time.strftime(&quot;%a %b %d %H:%M:%S %Y&quot;, time.localtime())</span><br><span class="line"></span><br><span class="line"># 将格式字符串转换为时间戳</span><br><span class="line">a &#x3D; &quot;Sat Mar 28 22:24:24 2016&quot;</span><br><span class="line">print time.mktime(time.strptime(a, &quot;%a %b %d %H:%M:%S %Y&quot;))</span><br><span class="line"></span><br><span class="line"># 输出日历</span><br><span class="line">cal &#x3D; calendar.month(2016, 1)</span><br><span class="line">print &quot;以下输出2016年1月份的日历:&quot;</span><br><span class="line">print cal</span><br><span class="line"></span><br><span class="line"># 用以浮点数计算的秒数返回当前的CPU时间。用来衡量不同程序的耗时，比time.time()更有用。</span><br><span class="line">time.clock( )</span><br><span class="line"></span><br><span class="line">i &#x3D; datetime.datetime.now()</span><br><span class="line">print (&quot;当前的日期和时间是 %s&quot; % i)</span><br><span class="line">print (&quot;ISO格式的日期和时间是 %s&quot; % i.isoformat())</span><br><span class="line">print (&quot;当前的年份是 %s&quot; % i.year)</span><br><span class="line">print (&quot;当前的月份是 %s&quot; % i.month)</span><br><span class="line">print (&quot;当前的日期是  %s&quot; % i.day)</span><br><span class="line">print (&quot;dd&#x2F;mm&#x2F;yyyy 格式是  %s&#x2F;%s&#x2F;%s&quot; % (i.day, i.month, i.year))</span><br><span class="line">print (&quot;当前小时是 %s&quot; % i.hour)</span><br><span class="line">print (&quot;当前分钟是 %s&quot; % i.minute)</span><br><span class="line">print (&quot;当前秒是  %s&quot; % i.second)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h1><h2 id="Python算术运算符"><a href="#Python算术运算符" class="headerlink" title="Python算术运算符"></a>Python算术运算符</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">+ - * &#x2F; % 之外 </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>** 幂-返回x的y次幂  4**2 =16</p>
<p>//    取整除 - 返回商的整数部分   9//2 =4</p>
<p>Python2.x 里，整数除整数，只能得出整数。如果要得到小数部分，把其中一个数改成浮点数即可。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">a &#x3D; 10</span><br><span class="line">b &#x3D; 20</span><br><span class="line">c &#x3D; a + b</span><br><span class="line">print &quot;1---c的值为：&quot;, c</span><br><span class="line"></span><br><span class="line">c &#x3D; b - a</span><br><span class="line">print &quot;2---c的值为：&quot;,c</span><br><span class="line"></span><br><span class="line">c &#x3D; a * b</span><br><span class="line">print &quot;3---c的值为：&quot;,c</span><br><span class="line"></span><br><span class="line">c &#x3D; b &#x2F; a</span><br><span class="line">print &#39;4----c的值为：&#39;,c</span><br><span class="line"></span><br><span class="line">c &#x3D; b ** a</span><br><span class="line">print &#39;5----c的值为：&#39;,c</span><br><span class="line"></span><br><span class="line">c &#x3D; b &#x2F;&#x2F; a</span><br><span class="line">print &#39;6----c的值为：&#39;,c</span><br><span class="line"></span><br><span class="line">c &#x3D; b % a</span><br><span class="line">print &#39;7----c的值为：&#39;,c</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="Python比较运算符"><a href="#Python比较运算符" class="headerlink" title="Python比较运算符"></a>Python比较运算符</h2><p>==  !=  &lt;&gt;  &gt;  &lt;  &gt;=  &lt;=</p>
<h2 id="Python赋值运算符"><a href="#Python赋值运算符" class="headerlink" title="Python赋值运算符"></a>Python赋值运算符</h2><p>= += -= *= 等等</p>
<h2 id="Python位运算符"><a href="#Python位运算符" class="headerlink" title="Python位运算符"></a>Python位运算符</h2><p>按位运算符是把数字看作二进制来进行计算的</p>
<p>&amp; 与运算符：参与运算的两个值,如果两个相应位都为1,则该位的结果为1,否则为0</p>
<p>| 或运算符：只要对应的二个二进位有一个为1时，结果位就为1。</p>
<p>^ 异或运算符：当两对应的二进位相异时，结果为1; </p>
<p>~ 取反运算符：对数据的每个二进制位取反,即把1变为0,把0变为1 。~x 类似于 -x-1</p>
<p>&lt;&lt; 左移动运算符：运算数的各二进位全部左移若干位，由 &lt;&lt; 右边的数字指定了移动的位数，高位丢弃，低位补0。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python</span><br><span class="line"># -*- coding: UTF-8 -*-</span><br><span class="line"></span><br><span class="line">a &#x3D; 60 # 60 &#x3D; 0011 1100</span><br><span class="line">b &#x3D; 13 # 13 &#x3D; 0000 1101</span><br><span class="line">c &#x3D; 0</span><br><span class="line"></span><br><span class="line">c &#x3D; a &amp; b</span><br><span class="line">print &#39;c&#x3D;&#x3D;&#x3D;&#39;,c</span><br><span class="line"></span><br><span class="line">c &#x3D; a | b</span><br><span class="line">print &#39;c&#x3D;&#x3D;&#x3D;&#x3D;&#39;,c</span><br><span class="line"></span><br><span class="line">c &#x3D; a ^ b</span><br><span class="line">print &#39;c&#x3D;&#x3D;&#x3D;&#x3D;&#39;,c</span><br><span class="line"></span><br><span class="line">c &#x3D; - a</span><br><span class="line">print &#39;c&#x3D;&#x3D;&#x3D;&#x3D;&#39;,c</span><br><span class="line"></span><br><span class="line">c &#x3D; ~a</span><br><span class="line">print &quot;4 - c 的值为：&quot;, c # ~x 类似于 -x-1</span><br><span class="line"></span><br><span class="line">c &#x3D; a &lt;&lt; 2</span><br><span class="line">print &quot;5 - c 的值为：&quot;, c</span><br><span class="line"></span><br><span class="line">c &#x3D; a &gt;&gt; 2</span><br><span class="line">print &quot;6 - c 的值为：&quot;, c</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Python逻辑运算符"><a href="#Python逻辑运算符" class="headerlink" title="Python逻辑运算符"></a>Python逻辑运算符</h2><p>and or not</p>
<h1 id="python条件语句"><a href="#python条件语句" class="headerlink" title="python条件语句"></a>python条件语句</h1><p>Python程序语言指定任何非0和非空（null）值为true，0 或者 null为false。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python</span><br><span class="line"># -*- coding: UTF-8 -*-</span><br><span class="line"></span><br><span class="line">flag &#x3D; False</span><br><span class="line">name &#x3D; &#39;luren&#39;</span><br><span class="line">if name &#x3D;&#x3D; &#39;python&#39;:</span><br><span class="line">    flag &#x3D; True</span><br><span class="line">    print &#39;welcome python&#39;</span><br><span class="line">elif name &#x3D;&#x3D; &#39;luren&#39;:</span><br><span class="line">    print &#39;welcome luren&#39;</span><br><span class="line">else:</span><br><span class="line">    print name</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="循环语句"><a href="#循环语句" class="headerlink" title="循环语句"></a>循环语句</h1><p>包括 while for 嵌套循环</p>
<h2 id="while循环-break和continue"><a href="#while循环-break和continue" class="headerlink" title="while循环 break和continue"></a>while循环 break和continue</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python</span><br><span class="line"># -*- coding: UTF-8 -*-</span><br><span class="line"></span><br><span class="line">i &#x3D; 1</span><br><span class="line">while i &lt; 10:</span><br><span class="line">    i +&#x3D; 1</span><br><span class="line">    print i</span><br><span class="line">else:</span><br><span class="line">    print &quot;end！&quot;</span><br><span class="line"></span><br><span class="line">print &quot;----------&quot;</span><br><span class="line"></span><br><span class="line">i &#x3D; 2</span><br><span class="line">while i &lt; 20:</span><br><span class="line">    i +&#x3D; 1</span><br><span class="line">    if i % 2 &#x3D;&#x3D; 0:</span><br><span class="line">        break # continue</span><br><span class="line">    print &quot;i&#x3D;&#x3D;&quot;,i</span><br><span class="line">else:</span><br><span class="line">    print &#39;end&#39;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>break只能跳出一层循环，如果你的循环是嵌套循环，那么你需要按照你嵌套的层次，逐步使用break来跳出。</p>
<p>continue 语句用来告诉Python跳过当前循环的剩余语句，然后继续进行下一轮循环。</p>
<h2 id="for-循环语句"><a href="#for-循环语句" class="headerlink" title="for 循环语句"></a>for 循环语句</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python</span><br><span class="line"># -*- coding: UTF-8 -*-</span><br><span class="line"></span><br><span class="line"># 遍历字符串</span><br><span class="line">for letter in &quot;python&quot;:</span><br><span class="line">    print &#39;当前字母：&#39;,letter</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 遍历list</span><br><span class="line">fruits &#x3D; [&#39;apple&#39;, &#39;banana&#39;, &#39;peer&#39;]</span><br><span class="line">for fruit in fruits:</span><br><span class="line">    print &#39;当前水果为：&#39;, fruit</span><br><span class="line"></span><br><span class="line"># 通过下标遍历list</span><br><span class="line">for index in range(len(fruits)):</span><br><span class="line">    print &#39;通过下标获取的水果的名字为：&#39;, fruits[index]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="循环嵌套"><a href="#循环嵌套" class="headerlink" title="循环嵌套"></a>循环嵌套</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python</span><br><span class="line"># -*- coding: UTF-8 -*-</span><br><span class="line"></span><br><span class="line">i &#x3D; 2</span><br><span class="line">while i &lt; 100:</span><br><span class="line">    j &#x3D; 2</span><br><span class="line">    while j &lt;&#x3D; (i &#x2F; j):</span><br><span class="line">        if not (i % j): break</span><br><span class="line">        j +&#x3D; 1</span><br><span class="line">    if j &gt; (i &#x2F; j): print i, &quot;是素数&quot;</span><br><span class="line">    i +&#x3D; 1</span><br><span class="line">print &#39;good bye&#39;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="pass-语句"><a href="#pass-语句" class="headerlink" title="pass 语句"></a>pass 语句</h2><p>Python pass是空语句，是为了保持程序结构的完整性。</p>
<p>pass 不做任何事情，一般用做占位语句。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python</span><br><span class="line"># -*- coding: UTF-8 -*- </span><br><span class="line"></span><br><span class="line"># 输出 Python 的每个字母</span><br><span class="line">for letter in &#39;Python&#39;:</span><br><span class="line">   if letter &#x3D;&#x3D; &#39;h&#39;:</span><br><span class="line">      pass</span><br><span class="line">      print &#39;这是 pass 块&#39;</span><br><span class="line">   print &#39;当前字母 :&#39;, letter</span><br><span class="line"></span><br><span class="line">print &quot;Good bye!&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>执行结果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">当前字母 : P</span><br><span class="line">当前字母 : y</span><br><span class="line">当前字母 : t</span><br><span class="line">这是 pass 块</span><br><span class="line">当前字母 : h</span><br><span class="line">当前字母 : o</span><br><span class="line">当前字母 : n</span><br><span class="line">Good bye!</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="python函数"><a href="#python函数" class="headerlink" title="python函数"></a>python函数</h2><h3 id="定义一个函数"><a href="#定义一个函数" class="headerlink" title="定义一个函数"></a>定义一个函数</h3><p>你可以定义一个由自己想要功能的函数，以下是简单的规则：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">函数代码块以 def 关键词开头，后接函数标识符名称和圆括号()。</span><br><span class="line"></span><br><span class="line">任何传入参数和自变量必须放在圆括号中间。圆括号之间可以用于定义参数。</span><br><span class="line"></span><br><span class="line">函数的第一行语句可以选择性地使用文档字符串—用于存放函数说明。</span><br><span class="line"></span><br><span class="line">函数内容以冒号起始，并且缩进。</span><br><span class="line"></span><br><span class="line">return [表达式] 结束函数，选择性地返回一个值给调用方。不带表达式的return相当于返回 None。</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="在python中，类型属于对象，变量是没有对象的。"><a href="#在python中，类型属于对象，变量是没有对象的。" class="headerlink" title="在python中，类型属于对象，变量是没有对象的。"></a>在python中，类型属于对象，变量是没有对象的。</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a&#x3D;[1,2,3]</span><br><span class="line"></span><br><span class="line">a&#x3D;&quot;Runoob&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>以上代码中，[1,2,3] 是 List 类型，”Runoob” 是 String 类型，而变量 a 是没有类型，她仅仅是一个对象的引用（一个指针），可以是 List 类型对象，也可以指向 String 类型对象。</p>
<h3 id="可更改-mutable-与不可更改-immutable-对象"><a href="#可更改-mutable-与不可更改-immutable-对象" class="headerlink" title="可更改(mutable)与不可更改(immutable)对象"></a>可更改(mutable)与不可更改(immutable)对象</h3><p><strong>不可变类型</strong>：变量赋值 a=5 后再赋值 a=10，这里实际是新生成一个 int 值对象 10，再让 a 指向它，而 5 被丢弃，不是改变a的值，相当于新生成了a。</p>
<p><strong>可变类型</strong>：变量赋值 la=[1,2,3,4] 后再赋值 la[2]=5 则是将 list la 的第三个元素值更改，本身la没有动，只是其内部的一部分值被修改了。</p>
<h4 id="python-函数的参数传递："><a href="#python-函数的参数传递：" class="headerlink" title="python 函数的参数传递："></a>python 函数的参数传递：</h4><p><strong>不可变类型</strong>：类似 c++ 的值传递，如 整数、字符串、元组。如fun（a），传递的只是a的值，没有影响a对象本身。比如在 fun（a）内部修改 a 的值，只是修改另一个复制的对象，不会影响 a 本身。</p>
<p><strong>可变类型</strong>：类似 c++ 的引用传递，如 列表，字典。如 fun（la），则是将 la 真正的传过去，修改后fun外部的la也会受影响</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># 传递不可变对象</span><br><span class="line">def changeInt(a):</span><br><span class="line">    b &#x3D; a</span><br><span class="line">    a &#x3D; 10</span><br><span class="line">    print a</span><br><span class="line">    print b</span><br><span class="line">    return</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">b &#x3D; 120</span><br><span class="line">changeInt(b)</span><br><span class="line">print b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 传可变对象实例</span><br><span class="line">def changeMe(myList):</span><br><span class="line">    &#39;&#39;&#39;修改传入的列表：&#39;&#39;&#39;</span><br><span class="line">    myList.append([1, 4, 6, 8])</span><br><span class="line">    return</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">myList &#x3D; [10, 40, 60]</span><br><span class="line">changeMe(myList)</span><br><span class="line">print &#39;myList&#39;, myList</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h3><h4 id="必备参数"><a href="#必备参数" class="headerlink" title="必备参数"></a>必备参数</h4><p>必备参数须以正确的顺序传入函数。调用时的数量必须和声明时的一样。无需指定参数的名字</p>
<h4 id="关键字参数"><a href="#关键字参数" class="headerlink" title="关键字参数"></a>关键字参数</h4><p>关键字参数和函数调用关系紧密，函数调用使用关键字参数来确定传入的参数值。</p>
<p>使用关键字参数允许函数调用时参数的顺序与声明时不一致，因为 Python 解释器能够用参数名匹配参数值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">def printinfo( name, age ):</span><br><span class="line">   &quot;打印任何传入的字符串&quot;</span><br><span class="line">   print &quot;Name: &quot;, name;</span><br><span class="line">   print &quot;Age &quot;, age;</span><br><span class="line">   return;</span><br><span class="line"> </span><br><span class="line">#调用printinfo函数</span><br><span class="line">printinfo( age&#x3D;50, name&#x3D;&quot;miki&quot; );</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="缺省参数"><a href="#缺省参数" class="headerlink" title="缺省参数"></a>缺省参数</h4><p>调用函数时，缺省参数的值如果没有传入，则被认为是默认值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#可写函数说明</span><br><span class="line">def printinfo( name, age &#x3D; 35 ):</span><br><span class="line">   &quot;打印任何传入的字符串&quot;</span><br><span class="line">   print &quot;Name: &quot;, name;</span><br><span class="line">   print &quot;Age &quot;, age;</span><br><span class="line">   return;</span><br><span class="line"> </span><br><span class="line">#调用printinfo函数</span><br><span class="line">printinfo( age&#x3D;50, name&#x3D;&quot;miki&quot; );</span><br><span class="line">printinfo( name&#x3D;&quot;miki&quot; );</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="不定长参数"><a href="#不定长参数" class="headerlink" title="不定长参数"></a>不定长参数</h4><p>你可能需要一个函数能处理比当初声明时更多的参数。这些参数叫做不定长参数，和上述2种参数不同，声明时不会命名</p>
<p>加了星号（*）的变量名会存放所有未命名的变量参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">def printinfo(arg1, *vartuple):</span><br><span class="line">    &quot;打印任何传入的参数&quot;</span><br><span class="line">    print &quot;输出: &quot;</span><br><span class="line">    print arg1</span><br><span class="line">    for var in vartuple:</span><br><span class="line">        print &#39;var:&#39;, var</span><br><span class="line">    return</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 调用printinfo 函数</span><br><span class="line">printinfo(10)</span><br><span class="line">printinfo(70, 60, 50)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="匿名函数"><a href="#匿名函数" class="headerlink" title="匿名函数"></a>匿名函数</h3><p>python 使用 lambda 来创建匿名函数。</p>
<p>1.lambda只是一个表达式，函数体比def简单很多。</p>
<p>2.lambda的主体是一个表达式，而不是一个代码块。仅仅能在lambda表达式中封装有限的逻辑进去。</p>
<p>3.lambda函数拥有自己的命名空间，且不能访问自有参数列表之外或全局命名空间里的参数。</p>
<p>4.虽然lambda函数看起来只能写一行，却不等同于C或C++的内联函数，后者的目的是调用小函数时不占用栈内存从而增加运行效率。</p>
<p>语法：</p>
<p>lambda [arg1 [,arg2,…..argn]]:expression</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python</span><br><span class="line"># -*- coding: UTF-8 -*-</span><br><span class="line"> </span><br><span class="line"># 可写函数说明</span><br><span class="line">sum &#x3D; lambda arg1, arg2: arg1 + arg2;</span><br><span class="line"> </span><br><span class="line"># 调用sum函数</span><br><span class="line">print &quot;相加后的值为 : &quot;, sum( 10, 20 )</span><br><span class="line">print &quot;相加后的值为 : &quot;, sum( 20, 20 )</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="全局变量和局部变量"><a href="#全局变量和局部变量" class="headerlink" title="全局变量和局部变量"></a>全局变量和局部变量</h2><p>局部变量只能在其被声明的函数内部访问，而全局变量可以在整个程序范围内访问。调用函数时，所有在函数内声明的变量名称都将被加入到作用域中。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python</span><br><span class="line"># -*-coding: UTF-8-*-</span><br><span class="line"></span><br><span class="line">total &#x3D; 0  # 这是一个全局变量</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 可写函数说明</span><br><span class="line">def sum(arg1, arg2):</span><br><span class="line">    # 返回2个参数的和.&quot;</span><br><span class="line">    total &#x3D; arg1 + arg2  # total在这里是局部变量.</span><br><span class="line">    print &quot;函数内是局部变量 : &quot;, total</span><br><span class="line">    return total;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 调用sum函数</span><br><span class="line">sum(10, 20)</span><br><span class="line"># total &#x3D; sum(30, 50)</span><br><span class="line">print &quot;函数外是全局变量 : &quot;, total</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="python-模块"><a href="#python-模块" class="headerlink" title="python 模块"></a>python 模块</h1><p>Python 模块(Module)，是一个 Python 文件，以 .py 结尾，包含了 Python 对象定义和Python语句</p>
<p>import语句 引入模块</p>
<p>from…import语句 Python 的 from 语句让你从模块中导入一个指定的部分到当前命名空间中</p>
<h2 id="搜索路径"><a href="#搜索路径" class="headerlink" title="搜索路径"></a>搜索路径</h2><p>当你导入一个模块，Python 解析器对模块位置的搜索顺序是：</p>
<ol>
<li>当前目录</li>
<li>如果不在当前目录，Python 则搜索在 shell 变量 PYTHONPATH 下的每个目录。</li>
<li>如果都找不到，Python会察看默认路径。UNIX下，默认路径一般为/usr/local/lib/python/。</li>
</ol>
<p>模块搜索路径存储在 system 模块的 sys.path 变量中。变量里包含当前目录，PYTHONPATH和由安装过程决定的默认目录。</p>
<h2 id="命名空间和作用域"><a href="#命名空间和作用域" class="headerlink" title="命名空间和作用域"></a>命名空间和作用域</h2><p>变量是拥有匹配对象的名字（标识符）。命名空间是一个包含了变量名称们（键）和它们各自相应的对象们（值）的字典。</p>
<p>如果一个局部变量和一个全局变量重名，则局部变量会覆盖全局变量。</p>
<p>Python 会智能地猜测一个变量是局部的还是全局的，它假设任何在函数内赋值的变量都是局部的。因此，如果要给函数内的全局变量赋值，必须使用 global 语句。</p>
<p>global VarName 的表达式会告诉 Python， VarName 是一个全局变量，这样 Python 就不会在局部命名空间里寻找这个变量了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python</span><br><span class="line"># -*-coding: UTF-8 -*-</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">money &#x3D; 3000</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def AddMoney():</span><br><span class="line">    # 全局变量的使用</span><br><span class="line">    global money</span><br><span class="line">    money &#x3D; money + 1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print &#39;money:&#39;, money</span><br><span class="line">AddMoney()</span><br><span class="line">print &#39;money:&#39;, money</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="dir-函数"><a href="#dir-函数" class="headerlink" title="dir()函数"></a>dir()函数</h3><p>dir() 函数一个排好序的字符串列表，内容是一个模块里定义过的名字。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python</span><br><span class="line"># -*-coding: UTF-8 -*-</span><br><span class="line">import math</span><br><span class="line">from math import floor</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># dir函数</span><br><span class="line">content &#x3D; dir(math)</span><br><span class="line">print &#39;content:&#39;, content</span><br><span class="line"></span><br><span class="line">print floor(5.8)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="globals-和-locals-函数"><a href="#globals-和-locals-函数" class="headerlink" title="globals() 和 locals() 函数"></a>globals() 和 locals() 函数</h3><p>根据调用地方的不同，globals() 和 locals() 函数可被用来返回全局和局部命名空间里的名字。</p>
<p>如果在函数内部调用 locals()，返回的是所有能在该函数里访问的命名。</p>
<p>如果在函数内部调用 globals()，返回的是所有在该函数里能访问的全局名字。</p>
<h3 id="Python中的包"><a href="#Python中的包" class="headerlink" title="Python中的包"></a>Python中的包</h3><p>简单来说，包就是文件夹，但该文件夹下必须存在 <strong>init</strong>.py 文件, 该文件的内容可以为空。<strong>init</strong>.py 用于标识当前文件夹是一个包。</p>
<h2 id="Python-文件I-O"><a href="#Python-文件I-O" class="headerlink" title="Python 文件I/O"></a>Python 文件I/O</h2><p>raw_input函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">str &#x3D; raw_input(&quot;按下 enter键退出，其他任意键显示。。。\n&quot;)</span><br><span class="line">print &#39;str:&#39;, str</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>input函数</p>
<p>input([prompt]) 函数和 raw_input([prompt]) 函数基本类似，但是 input 可以接收一个Python表达式作为输入，并将运算结果返回。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">str &#x3D; input(&quot;请输入：&quot;)  # 输入[x*5 for x in range(2,10,2)]</span><br><span class="line">print &quot;你输入的内容是: &quot;, str</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="文件IO"><a href="#文件IO" class="headerlink" title="文件IO"></a>文件IO</h1><h2 id="open-函数"><a href="#open-函数" class="headerlink" title="open 函数"></a>open 函数</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">file object &#x3D; open(file_name [, access_mode][, buffering])</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>各个参数的细节如下：</p>
<p>file_name：file_name变量是一个包含了你要访问的文件名称的字符串值。</p>
<p>access_mode：access_mode决定了打开文件的模式：只读，写入，追加等。所有可取值见如下的完全列表。这个参数是非强制的，默认文件访问模式为只读(r)。</p>
<p>buffering:如果buffering的值被设为0，就不会有寄存。如果buffering的值取1，访问文件时会寄存行。如果将buffering的值设为大于1的整数，表明了这就是的寄存区的缓冲大小。如果取负值，寄存区的缓冲大小则为系统默认。</p>
<p><img src="/images/python/2.7/python%E6%96%87%E4%BB%B6%E8%AE%BF%E9%97%AE%E6%9D%83%E9%99%90.png" alt="python文件访问权限"></p>
<h2 id="文件定位"><a href="#文件定位" class="headerlink" title="文件定位"></a>文件定位</h2><p>tell() 该方法告诉你文件内的当前位置, 换句话说，下一次的读写会发生在文件开头这么多字节之后。</p>
<p>seek（offset [,from]）方法改变当前文件的位置。Offset变量表示要移动的字节数。From变量指定开始移动字节的参考位置。</p>
<h2 id="重命名和删除文件"><a href="#重命名和删除文件" class="headerlink" title="重命名和删除文件"></a>重命名和删除文件</h2><p>Python的os模块提供了帮你执行文件处理操作的方法，比如重命名和删除文件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">os.rename(current_file_name, new_file_name)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="文件和目录操作的例子"><a href="#文件和目录操作的例子" class="headerlink" title="文件和目录操作的例子"></a>文件和目录操作的例子</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python</span><br><span class="line"># -*-coding: UTF-8 -*-</span><br><span class="line"></span><br><span class="line">import os</span><br><span class="line"></span><br><span class="line">fo &#x3D; open(&quot;foo.txt&quot;, &quot;w+&quot;)</span><br><span class="line">print &quot;文件名字：&quot;, fo.name</span><br><span class="line">print &quot;是否已经关闭1：&quot;, fo.closed</span><br><span class="line">print &quot;打开文件的访问模式：&quot;, fo.mode</span><br><span class="line"># 文件写入内容 write()方法不会在字符串的结尾添加换行符(&#39;\n&#39;)：</span><br><span class="line">fo.write(&quot;i&#39;m writing something.....\n 第二行文本  \n \n 第四行文本&quot;)</span><br><span class="line"># 关闭打开的文件</span><br><span class="line">fo.close()</span><br><span class="line">print &quot;是否已经关闭2：&quot;, fo.closed</span><br><span class="line"></span><br><span class="line">fo1 &#x3D; open(&quot;foo.txt&quot;, &quot;r+&quot;)</span><br><span class="line"># read（）方法从一个打开的文件中读取一个字符串。需要重点注意的是，Python字符串可以是二进制数据，而不是仅仅是文字。  fileObject.read([count])</span><br><span class="line">str &#x3D; fo1.read(10)</span><br><span class="line">print &quot;str:&quot;, str</span><br><span class="line"></span><br><span class="line">print &quot;分隔符1：&quot;, &quot;--------------------------------&quot;</span><br><span class="line"></span><br><span class="line"># 打开一个文件</span><br><span class="line">fo2 &#x3D; open(&quot;foo.txt&quot;, &quot;r+&quot;)</span><br><span class="line">str &#x3D; fo2.read(10)</span><br><span class="line">print &quot;读取的字符串是 : &quot;, str</span><br><span class="line"></span><br><span class="line"># 查找当前位置</span><br><span class="line">position &#x3D; fo2.tell()</span><br><span class="line">print &quot;当前文件位置 : &quot;, position</span><br><span class="line"></span><br><span class="line"># 把指针再次重新定位到文件开头</span><br><span class="line">position &#x3D; fo2.seek(0, 0)</span><br><span class="line">str &#x3D; fo2.read(10)</span><br><span class="line">print &quot;重新读取字符串 : &quot;, str</span><br><span class="line"># 关闭打开的文件</span><br><span class="line">fo2.close()</span><br><span class="line"></span><br><span class="line">print &quot;分隔符2：&quot;, &quot;--------------------------------&quot;</span><br><span class="line"></span><br><span class="line"># 重命名和删除文件</span><br><span class="line">os.rename(&quot;foo.txt&quot;, &quot;fool2.txt&quot;)</span><br><span class="line"></span><br><span class="line"># 删除一个已经存在的文件</span><br><span class="line"># os.remove(&quot;fool2.txt&quot;)</span><br><span class="line"></span><br><span class="line"># 创建目录</span><br><span class="line"># os.mkdir(&quot;test&quot;)</span><br><span class="line"></span><br><span class="line"># 改变当前目录</span><br><span class="line"># 将当前目录改为&quot;&#x2F;home&#x2F;newdir&quot;</span><br><span class="line"># os.chdir(&quot;&#x2F;home&#x2F;zhuningning&#x2F;PycharmProjects&#x2F;pythonBase&#x2F;base&#x2F;test&quot;)</span><br><span class="line"></span><br><span class="line"># 显示当前目录</span><br><span class="line">print os.getcwd()</span><br><span class="line"></span><br><span class="line"># 删除目录</span><br><span class="line"># os.rmdir(&quot;&#x2F;home&#x2F;zhuningning&#x2F;PycharmProjects&#x2F;pythonBase&#x2F;base&#x2F;test&quot;)</span><br><span class="line"></span><br><span class="line">print &quot;分隔符3：&quot;, &quot;--------------------------------&quot;</span><br><span class="line"></span><br><span class="line"># 每行读取文件</span><br><span class="line">fo &#x3D; open(&quot;fool2.txt&quot;, &quot;rw+&quot;)</span><br><span class="line">print &quot;文件名为: &quot;, fo.name</span><br><span class="line"></span><br><span class="line">for index in range(4):</span><br><span class="line">    line &#x3D; fo.next()</span><br><span class="line">    print &quot;第 %d 行 - %s&quot; % (index+1, line)</span><br><span class="line"></span><br><span class="line"># 关闭文件</span><br><span class="line">fo.close()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h1><p>python提供了两个非常重要的功能来处理python程序在运行中出现的异常和错误：异常处理 和 断言(Assertions)</p>
<p>捕捉异常可以使用try/except语句。</p>
<p>try/except语句用来检测try语句块中的错误，从而让except语句捕获异常信息并处理。</p>
<p>语法如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">try:</span><br><span class="line">&lt;语句&gt;        #运行别的代码</span><br><span class="line">except &lt;名字&gt;：</span><br><span class="line">&lt;语句&gt;        #如果在try部份引发了&#39;name&#39;异常</span><br><span class="line">except &lt;名字&gt;，&lt;数据&gt;:</span><br><span class="line">&lt;语句&gt;        #如果引发了&#39;name&#39;异常，获得附加的数据</span><br><span class="line">else:</span><br><span class="line">&lt;语句&gt;        #如果没有异常发生</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">try的工作原理是，当开始一个try语句后，python就在当前程序的上下文中作标记，这样当异常出现时就可以回到这里，try子句先执行，接下来会发生什么依赖于执行时是否出现异常。</span><br><span class="line"></span><br><span class="line">如果当try后的语句执行时发生异常，python就跳回到try并执行第一个匹配该异常的except子句，异常处理完毕，控制流就通过整个try语句（除非在处理异常时又引发新的异常）。</span><br><span class="line"></span><br><span class="line">如果在try后的语句里发生了异常，却没有匹配的except子句，异常将被递交到上层的try，或者到程序的最上层（这样将结束程序，并打印缺省的出错信息）。</span><br><span class="line"></span><br><span class="line">如果在try子句执行时没有发生异常，python将执行else语句后的语句（如果有else的话），然后控制流通过整个try语句。</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>异常的demo</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python</span><br><span class="line"># -*- coding: UTF-8 -*-</span><br><span class="line"></span><br><span class="line">try:</span><br><span class="line">    fh &#x3D; open(&quot;testfile.txt&quot;, &quot;w&quot;)</span><br><span class="line">    fh.write(&quot;write someting...&quot;)</span><br><span class="line">except IOError:</span><br><span class="line">    print &quot;error: 没有找到文件或者读取文件失败&quot;</span><br><span class="line">else:</span><br><span class="line">    print &quot;内容写入成功！&quot;</span><br><span class="line">    fh.close()</span><br><span class="line"></span><br><span class="line"># try finally语句</span><br><span class="line"></span><br><span class="line">try:</span><br><span class="line">    fh &#x3D; open(&quot;testfile&quot;, &quot;w&quot;)</span><br><span class="line">    fh.write(&quot;这是一个测试文件1，用于测试异常!&quot;)</span><br><span class="line">finally:</span><br><span class="line">    print &quot;Error: 没有找到文件或读取文件失败&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 用户自定义异常</span><br><span class="line"></span><br><span class="line">class Networkerror(RuntimeError):</span><br><span class="line">    def __init__(self, arg):</span><br><span class="line">        self.args &#x3D; arg</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">try:</span><br><span class="line">    raise Networkerror(&quot;Bad hostname&quot;)</span><br><span class="line">except Networkerror, e:</span><br><span class="line">    print e.args</span><br><span class="line"></span><br><span class="line"># 使用except而带多种异常类型</span><br><span class="line"></span><br><span class="line">try:</span><br><span class="line">    print &quot;正常执行！&quot;</span><br><span class="line">except(IOError, BaseException, IndentationError):</span><br><span class="line">    print &quot;发生异常！&quot;</span><br><span class="line">else:</span><br><span class="line">    print &quot;如果没有异常执行这块代码&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p><strong>print语句默认的会在后面加上 换行  加了逗号之后 换行 就变成了 空格</strong>  </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.chenwj.cn/2018-06-09/maven%E5%AE%9E%E6%88%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/favicon.ico">
      <meta itemprop="name" content="陈伟杰">
      <meta itemprop="description" content="学习，坚持。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="茄子的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018-06-09/maven%E5%AE%9E%E6%88%98/" class="post-title-link" itemprop="url">maven实战</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-06-09 03:03:03" itemprop="dateCreated datePublished" datetime="2018-06-09T03:03:03+08:00">2018-06-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-08-21 01:03:09" itemprop="dateModified" datetime="2020-08-21T01:03:09+08:00">2020-08-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/maven/" itemprop="url" rel="index"><span itemprop="name">maven</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>52k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>47 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>构建: 清理 编译 测试生成报告 打包 部署 就是自动化构建的过程;</p>
<p>maven不仅是构建工具,还是一个依赖管理工具和项目信息管理工具(包括获取项目文档 测试报告 静态分析报告 源码版本日志报告等项目的信息).</p>
<h2 id="安装maven"><a href="#安装maven" class="headerlink" title="安装maven"></a>安装maven</h2><p>安装maven需要首先安装jdk环境,配置java环境变量.然后安装maven,这里不在赘述.</p>
<h2 id="m2"><a href="#m2" class="headerlink" title="/.m2"></a>/.m2</h2><p>mvn help:system 命令执行后会打印出所有的java系统属性和环境变量.</p>
<p>包括System Properties和Environment Variables两大部分</p>
<h2 id="设置http代理"><a href="#设置http代理" class="headerlink" title="设置http代理"></a>设置http代理</h2><p>确认是否可以访问公共的maven仓库, ping repol.maven.org.如果不通,则需要telnet需要设置的代理ip和port,连接正确,则输入ctrl+] 绕后q回车即可.</p>
<p>检查完毕之后,编辑~/.m2/settings.xml文件.添加代理配置 在maven的conf目录下是有proxies节点配置代理的,copy到.m2下的settings文件中.</p>
<h2 id="设置MAVEN-OPTS环境变量"><a href="#设置MAVEN-OPTS环境变量" class="headerlink" title="设置MAVEN_OPTS环境变量"></a>设置MAVEN_OPTS环境变量</h2><p>执行mvn命令实际上执行的时java命令,那么运行的时候需要执行虚拟机参数.默认的MAVEN_OPTS=”-Xms128m -Xmx512m”是不能满足需求的,可以自行修改,和设置maven_home时一样的设置方式.</p>
<p>export MAVEN_OPTS=”-Xms256m -Xmx512m”</p>
<h2 id="不要使用IDE内嵌的maven"><a href="#不要使用IDE内嵌的maven" class="headerlink" title="不要使用IDE内嵌的maven"></a>不要使用IDE内嵌的maven</h2><p>原因:</p>
<p>1.内嵌的maven通常会比较新,通常不稳定;</p>
<p>2.命令行的和内嵌的版本不一致,我们有时候需要使用命令行运行maven,这样会产生一些奇怪的问题.</p>
<h1 id="使用入门"><a href="#使用入门" class="headerlink" title="使用入门"></a>使用入门</h1><p>maven项目的核心是pom.xml文件(project object model,项目对象模型).</p>
<h2 id="编写pom文件"><a href="#编写pom文件" class="headerlink" title="编写pom文件"></a>编写pom文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot;</span><br><span class="line">         xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0 http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;groupId&gt;com.juvenxu.mvnbook&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;hello-world&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;name&gt;Maven Hello World Project&lt;&#x2F;name&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;project&gt;         </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>pom文件的demo.SNAPSHOT意思是快照,说明该项目还在开发中,是不稳定的版本.</p>
<h2 id="编写主代码"><a href="#编写主代码" class="headerlink" title="编写主代码"></a>编写主代码</h2><p>1.主代码和测试代码不同,项目的主代码会被打包到最终的构建如jar包中,而测试代码只在运行测试时用到.</p>
<p>2.默认情况下,maven假设主代码位于src/main/java目录.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">package com.juvenxu.mvnbook.helloworld;</span><br><span class="line"></span><br><span class="line">public class HelloWorld&#123;</span><br><span class="line"></span><br><span class="line">public String sayHello()&#123;</span><br><span class="line"></span><br><span class="line"> return &quot;hello maven&quot;;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line">public static void main(String [] args)&#123;</span><br><span class="line"></span><br><span class="line">System.out.println(new HelloWorld().sayHello());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>java类中的包要基于项目的groupId和artifactId,这样逻辑清晰;</p>
<p>3.在项目的根目录下编译 mvn clean compile</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">zhuningning@ubuntu:~&#x2F;IdeaProjects&#x2F;hello-world$ mvn clean compile</span><br><span class="line">[INFO] Scanning for projects...</span><br><span class="line">[INFO] </span><br><span class="line">[INFO] ------------------&lt; com.juvenxu.mvnbook:hello-world &gt;-------------------</span><br><span class="line">[INFO] Building Maven Hello World Project 1.0-SNAPSHOT</span><br><span class="line">[INFO] --------------------------------[ jar ]---------------------------------</span><br><span class="line">[INFO] </span><br><span class="line">[INFO] --- maven-clean-plugin:2.5:clean (default-clean) @ hello-world ---</span><br><span class="line">[INFO] Deleting &#x2F;home&#x2F;zhuningning&#x2F;IdeaProjects&#x2F;hello-world&#x2F;target</span><br><span class="line">[INFO] </span><br><span class="line">[INFO] --- maven-resources-plugin:2.6:resources (default-resources) @ hello-world ---</span><br><span class="line">[WARNING] Using platform encoding (UTF-8 actually) to copy filtered resources, i.e. build is platform dependent!</span><br><span class="line">[INFO] skip non existing resourceDirectory &#x2F;home&#x2F;zhuningning&#x2F;IdeaProjects&#x2F;hello-world&#x2F;src&#x2F;main&#x2F;resources</span><br><span class="line">[INFO] </span><br><span class="line">[INFO] --- maven-compiler-plugin:3.1:compile (default-compile) @ hello-world ---</span><br><span class="line">[INFO] Changes detected - recompiling the module!</span><br><span class="line">[WARNING] File encoding has not been set, using platform encoding UTF-8, i.e. build is platform dependent!</span><br><span class="line">[INFO] Compiling 1 source file to &#x2F;home&#x2F;zhuningning&#x2F;IdeaProjects&#x2F;hello-world&#x2F;target&#x2F;classes</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] BUILD SUCCESS</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] Total time: 1.869 s</span><br><span class="line">[INFO] Finished at: 2018-06-09T15:13:33+08:00</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">zhuningning@ubuntu:~&#x2F;IdeaProjects&#x2F;hello-world$ </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>clean告诉maven清理输出目录target/,compile告诉maven编译项目主代码.</p>
<p>从输出中看到maven首先执行了clean任务,删除target/目录,默认构建的所有输出都会在target目录下,紧接着执行resources任务,最后执行compile命令,将项目主代码编译到target/classes目录下.</p>
<h2 id="编写测试代码"><a href="#编写测试代码" class="headerlink" title="编写测试代码"></a>编写测试代码</h2><p>1.测试代码的默认目录是src/test/java/,而测试使用的是junit单元测试标准.</p>
<p><scope>test</scope> 的意思是,在import junit代码中引入是没有问题的,但是在主代码中引入就会编译错误.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">package com.juvenxu.mvnbook.helloworld</span><br><span class="line"></span><br><span class="line">import static org.junit.Assert.assertEquals;</span><br><span class="line">import org.junit.Test;</span><br><span class="line"></span><br><span class="line">public class HelloWorldTest&#123;</span><br><span class="line"></span><br><span class="line">@Test</span><br><span class="line">public void testSayHello()&#123;</span><br><span class="line"></span><br><span class="line">  HelloWorld helloWorld &#x3D;new HelloWorld();</span><br><span class="line">  String result &#x3D; helloWorld.sayHello();</span><br><span class="line">  assertEquals(&quot;hello maven&quot;,result);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>2.典型的单元测试分为三个步骤:准备测试类和数据;执行要测试的行为;检查结果;</p>
<p>3.执行mvn clean test命令.实际执行的命令包括:clean:clean / resources:resources /compiler:compile / resources:testResources /compiler:testCompile</p>
<p> 过程中出现surefire:test,它是maven中负责执行测试的插件,并输出测试报告.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">zhuningning@ubuntu:~&#x2F;IdeaProjects&#x2F;hello-world$ mvn clean test</span><br><span class="line">[INFO] Scanning for projects...</span><br><span class="line">[INFO] </span><br><span class="line">[INFO] ------------------&lt; com.juvenxu.mvnbook:hello-world &gt;-------------------</span><br><span class="line">[INFO] Building Maven Hello World Project 1.0-SNAPSHOT</span><br><span class="line">[INFO] --------------------------------[ jar ]---------------------------------</span><br><span class="line">[INFO] </span><br><span class="line">[INFO] --- maven-clean-plugin:2.5:clean (default-clean) @ hello-world ---</span><br><span class="line">[INFO] Deleting &#x2F;home&#x2F;zhuningning&#x2F;IdeaProjects&#x2F;hello-world&#x2F;target</span><br><span class="line">[INFO] </span><br><span class="line">[INFO] --- maven-resources-plugin:2.6:resources (default-resources) @ hello-world ---</span><br><span class="line">[WARNING] Using platform encoding (UTF-8 actually) to copy filtered resources, i.e. build is platform dependent!</span><br><span class="line">[INFO] skip non existing resourceDirectory &#x2F;home&#x2F;zhuningning&#x2F;IdeaProjects&#x2F;hello-world&#x2F;src&#x2F;main&#x2F;resources</span><br><span class="line">[INFO] </span><br><span class="line">[INFO] --- maven-compiler-plugin:3.1:compile (default-compile) @ hello-world ---</span><br><span class="line">[INFO] Changes detected - recompiling the module!</span><br><span class="line">[WARNING] File encoding has not been set, using platform encoding UTF-8, i.e. build is platform dependent!</span><br><span class="line">[INFO] Compiling 1 source file to &#x2F;home&#x2F;zhuningning&#x2F;IdeaProjects&#x2F;hello-world&#x2F;target&#x2F;classes</span><br><span class="line">[INFO] </span><br><span class="line">[INFO] --- maven-resources-plugin:2.6:testResources (default-testResources) @ hello-world ---</span><br><span class="line">[WARNING] Using platform encoding (UTF-8 actually) to copy filtered resources, i.e. build is platform dependent!</span><br><span class="line">[INFO] skip non existing resourceDirectory &#x2F;home&#x2F;zhuningning&#x2F;IdeaProjects&#x2F;hello-world&#x2F;src&#x2F;test&#x2F;resources</span><br><span class="line">[INFO] </span><br><span class="line">[INFO] --- maven-compiler-plugin:3.1:testCompile (default-testCompile) @ hello-world ---</span><br><span class="line">[INFO] Changes detected - recompiling the module!</span><br><span class="line">[WARNING] File encoding has not been set, using platform encoding UTF-8, i.e. build is platform dependent!</span><br><span class="line">[INFO] Compiling 1 source file to &#x2F;home&#x2F;zhuningning&#x2F;IdeaProjects&#x2F;hello-world&#x2F;target&#x2F;test-classes</span><br><span class="line">[INFO] </span><br><span class="line">[INFO] --- maven-surefire-plugin:2.12.4:test (default-test) @ hello-world ---</span><br><span class="line">[INFO] Surefire report directory: &#x2F;home&#x2F;zhuningning&#x2F;IdeaProjects&#x2F;hello-world&#x2F;target&#x2F;surefire-reports</span><br><span class="line"></span><br><span class="line">-------------------------------------------------------</span><br><span class="line"> T E S T S</span><br><span class="line">-------------------------------------------------------</span><br><span class="line">Running com.juvenxu.mvnbook.helloworld.HelloWorldTest</span><br><span class="line">Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.055 sec</span><br><span class="line"></span><br><span class="line">Results :</span><br><span class="line"></span><br><span class="line">Tests run: 1, Failures: 0, Errors: 0, Skipped: 0</span><br><span class="line"></span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] BUILD SUCCESS</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] Total time: 2.951 s</span><br><span class="line">[INFO] Finished at: 2018-06-09T15:37:21+08:00</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">zhuningning@ubuntu:~&#x2F;IdeaProjects&#x2F;hello-world$ </span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="打包和运行"><a href="#打包和运行" class="headerlink" title="打包和运行"></a>打包和运行</h2><p>1.打包是下一个进行的步骤,由于pom中没有指定打包的类型,所以默认的打包类型时jar包.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">zhuningning@ubuntu:~&#x2F;IdeaProjects&#x2F;hello-world$ mvn clean package </span><br><span class="line">[INFO] Scanning for projects...</span><br><span class="line">[INFO] </span><br><span class="line">[INFO] ------------------&lt; com.juvenxu.mvnbook:hello-world &gt;-------------------</span><br><span class="line">[INFO] Building Maven Hello World Project 1.0-SNAPSHOT</span><br><span class="line">[INFO] --------------------------------[ jar ]---------------------------------</span><br><span class="line">[INFO] </span><br><span class="line">[INFO] --- maven-clean-plugin:2.5:clean (default-clean) @ hello-world ---</span><br><span class="line">[INFO] Deleting &#x2F;home&#x2F;zhuningning&#x2F;IdeaProjects&#x2F;hello-world&#x2F;target</span><br><span class="line">[INFO] </span><br><span class="line">[INFO] --- maven-resources-plugin:2.6:resources (default-resources) @ hello-world ---</span><br><span class="line">[WARNING] Using platform encoding (UTF-8 actually) to copy filtered resources, i.e. build is platform dependent!</span><br><span class="line">[INFO] skip non existing resourceDirectory &#x2F;home&#x2F;zhuningning&#x2F;IdeaProjects&#x2F;hello-world&#x2F;src&#x2F;main&#x2F;resources</span><br><span class="line">[INFO] </span><br><span class="line">[INFO] --- maven-compiler-plugin:3.1:compile (default-compile) @ hello-world ---</span><br><span class="line">[INFO] Changes detected - recompiling the module!</span><br><span class="line">[WARNING] File encoding has not been set, using platform encoding UTF-8, i.e. build is platform dependent!</span><br><span class="line">[INFO] Compiling 1 source file to &#x2F;home&#x2F;zhuningning&#x2F;IdeaProjects&#x2F;hello-world&#x2F;target&#x2F;classes</span><br><span class="line">[INFO] </span><br><span class="line">[INFO] --- maven-resources-plugin:2.6:testResources (default-testResources) @ hello-world ---</span><br><span class="line">[WARNING] Using platform encoding (UTF-8 actually) to copy filtered resources, i.e. build is platform dependent!</span><br><span class="line">[INFO] skip non existing resourceDirectory &#x2F;home&#x2F;zhuningning&#x2F;IdeaProjects&#x2F;hello-world&#x2F;src&#x2F;test&#x2F;resources</span><br><span class="line">[INFO] </span><br><span class="line">[INFO] --- maven-compiler-plugin:3.1:testCompile (default-testCompile) @ hello-world ---</span><br><span class="line">[INFO] Changes detected - recompiling the module!</span><br><span class="line">[WARNING] File encoding has not been set, using platform encoding UTF-8, i.e. build is platform dependent!</span><br><span class="line">[INFO] Compiling 1 source file to &#x2F;home&#x2F;zhuningning&#x2F;IdeaProjects&#x2F;hello-world&#x2F;target&#x2F;test-classes</span><br><span class="line">[INFO] </span><br><span class="line">[INFO] --- maven-surefire-plugin:2.12.4:test (default-test) @ hello-world ---</span><br><span class="line">[INFO] Surefire report directory: &#x2F;home&#x2F;zhuningning&#x2F;IdeaProjects&#x2F;hello-world&#x2F;target&#x2F;surefire-reports</span><br><span class="line"></span><br><span class="line">-------------------------------------------------------</span><br><span class="line"> T E S T S</span><br><span class="line">-------------------------------------------------------</span><br><span class="line">Running com.juvenxu.mvnbook.helloworld.HelloWorldTest</span><br><span class="line">Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.05 sec</span><br><span class="line"></span><br><span class="line">Results :</span><br><span class="line"></span><br><span class="line">Tests run: 1, Failures: 0, Errors: 0, Skipped: 0</span><br><span class="line"></span><br><span class="line">[INFO] </span><br><span class="line">[INFO] --- maven-jar-plugin:2.4:jar (default-jar) @ hello-world ---</span><br><span class="line">[INFO] Building jar: &#x2F;home&#x2F;zhuningning&#x2F;IdeaProjects&#x2F;hello-world&#x2F;target&#x2F;hello-world-1.0-SNAPSHOT.jar</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] BUILD SUCCESS</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] Total time: 3.030 s</span><br><span class="line">[INFO] Finished at: 2018-06-09T17:46:57+08:00</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2.jar:jar 操作就是负责打包. 如何让其它的项目直接引用到这个jar包呢?</p>
<p>运行mvn clean install ,安装任务 install:install.将项目输出的jar安装到了maven本地仓库中.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">zhuningning@ubuntu:~&#x2F;IdeaProjects&#x2F;hello-world$ mvn clean install</span><br><span class="line">[INFO] Scanning for projects...</span><br><span class="line">[INFO] </span><br><span class="line">[INFO] ------------------&lt; com.juvenxu.mvnbook:hello-world &gt;-------------------</span><br><span class="line">[INFO] Building Maven Hello World Project 1.0-SNAPSHOT</span><br><span class="line">[INFO] --------------------------------[ jar ]---------------------------------</span><br><span class="line">[INFO] </span><br><span class="line">[INFO] --- maven-clean-plugin:2.5:clean (default-clean) @ hello-world ---</span><br><span class="line">[INFO] Deleting &#x2F;home&#x2F;zhuningning&#x2F;IdeaProjects&#x2F;hello-world&#x2F;target</span><br><span class="line">[INFO] </span><br><span class="line">[INFO] --- maven-resources-plugin:2.6:resources (default-resources) @ hello-world ---</span><br><span class="line">[WARNING] Using platform encoding (UTF-8 actually) to copy filtered resources, i.e. build is platform dependent!</span><br><span class="line">[INFO] skip non existing resourceDirectory &#x2F;home&#x2F;zhuningning&#x2F;IdeaProjects&#x2F;hello-world&#x2F;src&#x2F;main&#x2F;resources</span><br><span class="line">[INFO] </span><br><span class="line">[INFO] --- maven-compiler-plugin:3.1:compile (default-compile) @ hello-world ---</span><br><span class="line">[INFO] Changes detected - recompiling the module!</span><br><span class="line">[WARNING] File encoding has not been set, using platform encoding UTF-8, i.e. build is platform dependent!</span><br><span class="line">[INFO] Compiling 1 source file to &#x2F;home&#x2F;zhuningning&#x2F;IdeaProjects&#x2F;hello-world&#x2F;target&#x2F;classes</span><br><span class="line">[INFO] </span><br><span class="line">[INFO] --- maven-resources-plugin:2.6:testResources (default-testResources) @ hello-world ---</span><br><span class="line">[WARNING] Using platform encoding (UTF-8 actually) to copy filtered resources, i.e. build is platform dependent!</span><br><span class="line">[INFO] skip non existing resourceDirectory &#x2F;home&#x2F;zhuningning&#x2F;IdeaProjects&#x2F;hello-world&#x2F;src&#x2F;test&#x2F;resources</span><br><span class="line">[INFO] </span><br><span class="line">[INFO] --- maven-compiler-plugin:3.1:testCompile (default-testCompile) @ hello-world ---</span><br><span class="line">[INFO] Changes detected - recompiling the module!</span><br><span class="line">[WARNING] File encoding has not been set, using platform encoding UTF-8, i.e. build is platform dependent!</span><br><span class="line">[INFO] Compiling 1 source file to &#x2F;home&#x2F;zhuningning&#x2F;IdeaProjects&#x2F;hello-world&#x2F;target&#x2F;test-classes</span><br><span class="line">[INFO] </span><br><span class="line">[INFO] --- maven-surefire-plugin:2.12.4:test (default-test) @ hello-world ---</span><br><span class="line">[INFO] Surefire report directory: &#x2F;home&#x2F;zhuningning&#x2F;IdeaProjects&#x2F;hello-world&#x2F;target&#x2F;surefire-reports</span><br><span class="line"></span><br><span class="line">-------------------------------------------------------</span><br><span class="line"> T E S T S</span><br><span class="line">-------------------------------------------------------</span><br><span class="line">Running com.juvenxu.mvnbook.helloworld.HelloWorldTest</span><br><span class="line">Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.063 sec</span><br><span class="line"></span><br><span class="line">Results :</span><br><span class="line"></span><br><span class="line">Tests run: 1, Failures: 0, Errors: 0, Skipped: 0</span><br><span class="line"></span><br><span class="line">[INFO] </span><br><span class="line">[INFO] --- maven-jar-plugin:2.4:jar (default-jar) @ hello-world ---</span><br><span class="line">[INFO] Building jar: &#x2F;home&#x2F;zhuningning&#x2F;IdeaProjects&#x2F;hello-world&#x2F;target&#x2F;hello-world-1.0-SNAPSHOT.jar</span><br><span class="line">[INFO] </span><br><span class="line">[INFO] --- maven-install-plugin:2.4:install (default-install) @ hello-world ---</span><br><span class="line">[INFO] Installing &#x2F;home&#x2F;zhuningning&#x2F;IdeaProjects&#x2F;hello-world&#x2F;target&#x2F;hello-world-1.0-SNAPSHOT.jar to &#x2F;home&#x2F;zhuningning&#x2F;.m2&#x2F;repository&#x2F;com&#x2F;juvenxu&#x2F;mvnbook&#x2F;hello-world&#x2F;1.0-SNAPSHOT&#x2F;hello-world-1.0-SNAPSHOT.jar</span><br><span class="line">[INFO] Installing &#x2F;home&#x2F;zhuningning&#x2F;IdeaProjects&#x2F;hello-world&#x2F;pom.xml to &#x2F;home&#x2F;zhuningning&#x2F;.m2&#x2F;repository&#x2F;com&#x2F;juvenxu&#x2F;mvnbook&#x2F;hello-world&#x2F;1.0-SNAPSHOT&#x2F;hello-world-1.0-SNAPSHOT.pom</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] BUILD SUCCESS</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] Total time: 2.913 s</span><br><span class="line">[INFO] Finished at: 2018-06-09T17:52:27+08:00</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>install命令执行完之后,本地仓库/.m2 中有项目的pom和jar</p>
<ol start="3">
<li>main方法的运行</li>
</ol>
<p>到目前为止还是没有运行Hello World项目的,但是helloWorld类是有main方法的.默认打包生成的jar包是不能够直接运行的.那是因为带有main方法的类信息是不会添加到mainfest中(打开jar文件中的META-INF/MANIFEST.MF文件,无法查看到Main-Class-mainifest),为了生成,需要借助maven-shade-plugin</p>
<p>配置插件如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;build&gt;</span><br><span class="line">&lt;plugins&gt;</span><br><span class="line">&lt;plugin&gt;</span><br><span class="line">  &lt;groupId&gt;org.apache.maven.plugins&lt;&#x2F;groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;maven-shade-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">  &lt;version&gt;1.2.1&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;executions&gt;</span><br><span class="line">          &lt;execution&gt;</span><br><span class="line">            &lt;phase&gt;package&lt;&#x2F;phase&gt;</span><br><span class="line">            &lt;goals&gt;</span><br><span class="line">              &lt;goal&gt;shade&lt;&#x2F;goal&gt;</span><br><span class="line">            &lt;&#x2F;goals&gt;</span><br><span class="line">            &lt;configuration&gt;</span><br><span class="line">              &lt;transformers&gt;</span><br><span class="line">                &lt;transformer implementation&#x3D;&quot;org.apache.maven.plugins.shade.resource.ManifestResourceTransformer&quot;&gt;</span><br><span class="line">                  &lt;mainClass&gt;com.juvenxu.mvnbook.helloworld.HelloWorld&lt;&#x2F;mainClass&gt;</span><br><span class="line">                &lt;&#x2F;transformer&gt;</span><br><span class="line">              &lt;&#x2F;transformers&gt;</span><br><span class="line">            &lt;&#x2F;configuration&gt;</span><br><span class="line">          &lt;&#x2F;execution&gt;</span><br><span class="line">        &lt;&#x2F;executions&gt;</span><br><span class="line">      &lt;&#x2F;plugin&gt;</span><br><span class="line">&lt;&#x2F;plugins&gt;</span><br><span class="line">&lt;&#x2F;build&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后再次运行mvn clean install</p>
<p>在target目录下有jar包,然后执行 java -jar</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">zhuningning@ubuntu:~&#x2F;IdeaProjects&#x2F;hello-world&#x2F;target$ java -jar hello-world-1.0-SNAPSHOT.jar </span><br><span class="line">hello maven</span><br><span class="line">zhuningning@ubuntu:~&#x2F;IdeaProjects&#x2F;hello-world&#x2F;target$ </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="使用Archetype生成项目骨架"><a href="#使用Archetype生成项目骨架" class="headerlink" title="使用Archetype生成项目骨架"></a>使用Archetype生成项目骨架</h2><p>项目的默认约定：在项目的根目录中防止pom.xml 在/src/main/java中放置项目的主代码，在/src/test/java中放置项目的测试代码。</p>
<p>执行以下命令后需要输入groupId、artifactId、version、packaging。创建默认结构的maven项目。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">zhuningning@ubuntu:~&#x2F;IdeaProjects&#x2F;test$ mvn archetype:generate</span><br><span class="line">[INFO] Scanning for projects...</span><br><span class="line">[INFO] </span><br><span class="line">[INFO] ------------------&lt; org.apache.maven:standalone-pom &gt;-------------------</span><br><span class="line">[INFO] Building Maven Stub Project (No POM) 1</span><br><span class="line">[INFO] --------------------------------[ pom ]---------------------------------</span><br><span class="line">[INFO] </span><br><span class="line">[INFO] &gt;&gt;&gt; maven-archetype-plugin:3.0.1:generate (default-cli) &gt; generate-sources @ standalone-pom &gt;&gt;&gt;</span><br><span class="line">[INFO] </span><br><span class="line">[INFO] &lt;&lt;&lt; maven-archetype-plugin:3.0.1:generate (default-cli) &lt; generate-sources @ standalone-pom &lt;&lt;&lt;</span><br><span class="line">[INFO] </span><br><span class="line">[INFO] </span><br><span class="line">[INFO] --- maven-archetype-plugin:3.0.1:generate (default-cli) @ standalone-pom ---</span><br><span class="line">[INFO] Generating project in Interactive mode</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h2 id="maven坐标"><a href="#maven坐标" class="headerlink" title="maven坐标"></a>maven坐标</h2><p>如下是引入spring的context包。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-context&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;4.3.5.RELEASE&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>groupId：定义当前maven项目隶属的实际项目，groupId不应该对应项目隶属的公司或者组织，因为一个公司有可能有多个项目。</p>
<p>artifactId： 该元素定义实际项目中的一个maven项目（模块），推荐的是使用实际项目名称作为artifactId的前缀。</p>
<p>version:项目的版本，</p>
<p>packaging：该元素定义的maven项目的打包方式。默认为jar</p>
<h1 id="依赖的配置"><a href="#依赖的配置" class="headerlink" title="依赖的配置"></a>依赖的配置</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-context&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;4.3.5.RELEASE&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;type&gt;jar&lt;&#x2F;type&gt;</span><br><span class="line">    &lt;scope&gt;runtime&lt;&#x2F;scope&gt;</span><br><span class="line">    &lt;optional&gt;false&lt;&#x2F;optional&gt;</span><br><span class="line">    &lt;exclusions&gt;</span><br><span class="line">        &lt;exclusion&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-core&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;exclusion&gt;</span><br><span class="line">    &lt;&#x2F;exclusions&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="依赖范围。"><a href="#依赖范围。" class="headerlink" title="依赖范围。"></a>依赖范围。</h2><p>依赖范围就是用来控制依赖与三种classpath（编译classpath、测试classpath、运行classpath）的关系</p>
<p>scope范围包括：</p>
<ol>
<li><p>compile 编译依赖范围，默认的。对于编译、测试、运行三种classpath都有用。</p>
</li>
<li><p>test 测试有效。在编译和运行主代码时无效。如 junit</p>
</li>
<li><p>provided 编译和测试的时候有效，运行的时候无效。如 servlet-api</p>
</li>
<li><p>runtime 对于测试和运行有效，对编译主代码无效。</p>
</li>
<li><p>system 系统依赖范围，和compile一致，但是必须通过systemPath元素显式的指定依赖文件的路径。</p>
</li>
<li><p>import dependencyManagement中才可以使用import，表示从其它的pom文件中导入依赖设置。</p>
</li>
</ol>
<h2 id="传递性依赖"><a href="#传递性依赖" class="headerlink" title="传递性依赖"></a>传递性依赖</h2><p>如A项目依赖 spring-core包，而spring-core包依赖一个common-logging包，common-logging包就是A项目的传递依赖。</p>
<p>假设A依赖于B，B依赖于C，我们说A对于B是第一直接依赖，B对于C是第二直接依赖，A对于C是传递性依赖。</p>
<h2 id="依赖调解"><a href="#依赖调解" class="headerlink" title="依赖调解"></a>依赖调解</h2><p>maven引入的传递性依赖机制。一方面大大简化和方便了依赖声明；另一方面，大部分情况我们只需要关心项目的直接依赖，而不用考虑直接依赖会引入什么传递性依赖。</p>
<p>例子： 项目A有这样的依赖关系：A-&gt;B-&gt;C-&gt;X(1.0),A-&gt;D-&gt;X(2.0),X是传递性依赖，但是有2个版本，要选择一个去依赖。<strong>调解的第一原则：路径最近者优先，会选择2.0；当路径相同的情况下，第二原则：第一声明者优先。</strong></p>
<h2 id="可选依赖"><a href="#可选依赖" class="headerlink" title="可选依赖"></a>可选依赖</h2><p>项目B实现了2个特性，其中一个特性依赖于X，另一个依赖于Y，而且这两个特性是互斥的。用户不可能同时使用两个特性。比如支持多种数据库，在构建的时候需要两种数据库的驱动程序，但在使用这个工具包的时候指挥依赖一种数据库。</p>
<p><optional> true </optional></p>
<h2 id="项目依赖实践技巧"><a href="#项目依赖实践技巧" class="headerlink" title="项目依赖实践技巧"></a>项目依赖实践技巧</h2><p>1.排除依赖</p>
<p>exclusions 排除依赖。声明exclusion的时候，只需要groupId和artifactId。不需要version</p>
<p>2.依赖归类</p>
<p><properties> 声明一个属性子元素，多个版本相同的项目的依赖使用同一个版本。</p>
<p>3.优化依赖</p>
<p>①查看当前项目的已解析依赖  mvn:dependency:list</p>
<p>②查看当前项目的依赖树  mvn:dependency:tree</p>
<p>③查看使用未声明的依赖和声明未使用的依赖： mvn dependency:analyze 。used undeclared dependencies 和Unused declared undeclared.由于该命令只会分析编译主代码和测试主代码需要的依赖，一些执行测试和运行时需要的依赖发现不了。所以不要随便根据此提示来删除一些声明未使用的依赖。</p>
<h1 id="仓库"><a href="#仓库" class="headerlink" title="仓库"></a>仓库</h1><h2 id="仓库分类"><a href="#仓库分类" class="headerlink" title="仓库分类"></a>仓库分类</h2><p>maven仓库是为共享依赖的jar包而创建的，分为本地仓库和远程仓库。</p>
<p>当maven寻找组件的时候，首先从本地仓库查找，如果本地没有或者需要更新的时候从远程仓库下载到本地仓库。</p>
<p>两个特殊的远程仓库 1.中央仓库：maven核心自带的仓库； 2.私服：特殊的局域网假设的仓库；</p>
<h2 id="本地仓库"><a href="#本地仓库" class="headerlink" title="本地仓库"></a>本地仓库</h2><p>.m2/repository/的仓库目录。可以在maven的settings配置中设置本地仓库的位置。</p>
<p>一个构件只有在本地仓库中之后，才能由其它maven项目使用，那么构件如何进入本地仓库呢？最常见的是从远程下载到本地，还有一种是将本地的项目的构件安装到maven仓库中。</p>
<p>mvn clean install命令就是，执行install插件的install的目标项目的构建输出文件安装到本地仓库。</p>
<h2 id="远程仓库"><a href="#远程仓库" class="headerlink" title="远程仓库"></a>远程仓库</h2><h2 id="中央仓库"><a href="#中央仓库" class="headerlink" title="中央仓库"></a>中央仓库</h2><p>默认的maven仓库是中央仓库，在maven的lib/maven-model-builder-3.0.jar，然后访问路径org/apache/maven/model/pom-4.0.0.xml可以看到</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;repositories&gt;     </span><br><span class="line">  &lt;repository&gt;     </span><br><span class="line">    &lt;id&gt; central&lt;&#x2F;id&gt;     </span><br><span class="line">    &lt;name&gt; Maven Repository Switchboard&lt;&#x2F;name&gt;     </span><br><span class="line">    &lt;layout&gt; default&lt;&#x2F;layout&gt;     </span><br><span class="line">    &lt;url&gt; http:&#x2F;&#x2F;repo1.maven.org&#x2F;maven2&lt;&#x2F;url&gt;     </span><br><span class="line">    &lt;snapshots&gt;     </span><br><span class="line">      &lt;enabled&gt; false&lt;&#x2F;enabled&gt;     </span><br><span class="line">    &lt;&#x2F;snapshots&gt;     </span><br><span class="line">  &lt;&#x2F;repository&gt;     </span><br><span class="line">&lt;&#x2F;repositories&gt;    </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这是所有maven项目都会继承的超级pom。</p>
<h2 id="私服"><a href="#私服" class="headerlink" title="私服"></a>私服</h2><p>私服是一种特殊的远程仓库，它时架设在局域网内的仓库服务。当maven需要下载构件的时候，先从私服请求，如果私服上不存在该构件，则从外部的远程仓库下载，缓存在私服上之后，再为maven的下载请求提供服务。</p>
<p>优点：</p>
<ol>
<li>节省自己的外网带宽；</li>
<li>加速maven构建；</li>
<li>部署第三方构件；</li>
<li>提高稳定性，增强控制；</li>
<li>降低中央仓库的负荷；</li>
</ol>
<h2 id="远程仓库的配置"><a href="#远程仓库的配置" class="headerlink" title="远程仓库的配置"></a>远程仓库的配置</h2><h3 id="在pom中配置远程仓库"><a href="#在pom中配置远程仓库" class="headerlink" title="在pom中配置远程仓库"></a>在pom中配置远程仓库</h3><p>在pom中添加repositories/repository 两个节点，可以配置多个远程仓库。其中id是唯一的，中央仓库的id时central。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;repositories&gt;  </span><br><span class="line">   &lt;repository&gt;  </span><br><span class="line">     &lt;id&gt;jboss&lt;&#x2F;id&gt;  </span><br><span class="line">     &lt;name&gt;JBoss Repository&lt;&#x2F;name&gt;  </span><br><span class="line">     &lt;url&gt;http:&#x2F;&#x2F;repository.jboss.com&#x2F;maven2&#x2F;&lt;&#x2F;url&gt;  </span><br><span class="line">     &lt;releases&gt;  </span><br><span class="line">       &lt;enabled&gt;true&lt;&#x2F;enabled&gt;  </span><br><span class="line">     &lt;&#x2F;releases&gt;  </span><br><span class="line">   &lt;&#x2F;repository&gt;  </span><br><span class="line">   &lt;snapshots&gt;  </span><br><span class="line">     &lt;enabled&gt;false&lt;&#x2F;enabled&gt;  </span><br><span class="line">   &lt;&#x2F;snapshots&gt;  </span><br><span class="line">   &lt;layout&gt;default&lt;&#x2F;layout&gt;  </span><br><span class="line"> &lt;&#x2F;repositories&gt;  </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>其中关键的两个节点releases 表示发布版本的下载为true，snapshots表示快照版本的下载为false。</p>
<p>snapshots比较重要的节点</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;snapshots&gt;  </span><br><span class="line">  &lt;enabled&gt;true&lt;&#x2F;enabled&gt;  </span><br><span class="line">  &lt;updatePolicy&gt;daily&lt;&#x2F;updatePolicy&gt;  </span><br><span class="line">  &lt;checksumPolicy&gt;ignore&lt;&#x2F;checksumPolicy&gt;  </span><br><span class="line">&lt;&#x2F;snapshots&gt;  </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>updatePolicy daily，表示Maven每天检查一次。其他可用的值包括：never—从不检查更新；always—每次构建都检查更新；interval:X—每隔X分钟检查一次更新(X为任意整数)</p>
<p>checksumPolicy节点表示检查更新的频率和下载失败时的处理策略。</p>
<p>值为默认的warn时，Maven会在执行构建时输出警告信息，其他可用的值包括：fail—Maven遇到校验和错误就让构建失败；ignore—使用Maven完全忽略校验和错误。</p>
<h3 id="在setting-xml中配置远程仓库"><a href="#在setting-xml中配置远程仓库" class="headerlink" title="在setting.xml中配置远程仓库"></a>在setting.xml中配置远程仓库</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">1.需要在profiles标签中添加远程仓库配置</span><br><span class="line"></span><br><span class="line">&lt;profile&gt;  </span><br><span class="line">        &lt;id&gt;myProfiel&lt;&#x2F;id&gt;    </span><br><span class="line">    &lt;repositories&gt;    </span><br><span class="line">        &lt;repository&gt;    </span><br><span class="line">            &lt;id&gt;me&lt;&#x2F;id&gt;    </span><br><span class="line">            &lt;name&gt;me Repository&lt;&#x2F;name&gt;    </span><br><span class="line">            &lt;url&gt;http:&#x2F;&#x2F;192.168.106.58:57770&#x2F;nexus&#x2F;&lt;&#x2F;url&gt;    </span><br><span class="line">            &lt;releases&gt;    </span><br><span class="line">                &lt;updatePolicy&gt;daily&lt;&#x2F;updatePolicy&gt;never,always,interval n    </span><br><span class="line">                &lt;enabled&gt;true&lt;&#x2F;enabled&gt;    </span><br><span class="line">                &lt;checksumPolicy&gt;warn&lt;&#x2F;checksumPolicy&gt;fail,ignore    </span><br><span class="line">            &lt;&#x2F;releases&gt;    </span><br><span class="line">            &lt;snapshots&gt;    </span><br><span class="line">                &lt;enabled&gt;false&lt;&#x2F;enabled&gt;    </span><br><span class="line">            &lt;&#x2F;snapshots&gt;    </span><br><span class="line">            &lt;layout&gt;default&lt;&#x2F;layout&gt;    </span><br><span class="line">        &lt;&#x2F;repository&gt;    </span><br><span class="line">    &lt;&#x2F;repositories&gt;    </span><br><span class="line">&lt;&#x2F;profile&gt;  </span><br><span class="line"></span><br><span class="line">2.在settings标签中添加activeProfiles标签，用于激活配置的profile标签</span><br><span class="line"></span><br><span class="line">&lt;activeProfiles&gt;       </span><br><span class="line">    &lt;activeProfile&gt;myProfiel&lt;&#x2F;activeProfile&gt;       </span><br><span class="line">&lt;&#x2F;activeProfiles&gt; </span><br><span class="line"> </span><br></pre></td></tr></table></figure>



<h3 id="远程仓库的认证"><a href="#远程仓库的认证" class="headerlink" title="远程仓库的认证"></a>远程仓库的认证</h3><p>大部分仓库时无需认证的，但是有的时需要的。这个是必须在settings.xml中配置。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;settings&gt;  </span><br><span class="line">  ...  </span><br><span class="line">  &lt;servers&gt;  </span><br><span class="line">    &lt;server&gt;  </span><br><span class="line">      &lt;id&gt;my-proj&lt;&#x2F;id&gt;  </span><br><span class="line">      &lt;username&gt;repo-user&lt;&#x2F;username&gt;  </span><br><span class="line">      &lt;password&gt;repo-pwd&lt;&#x2F;password&gt;  </span><br><span class="line">    &lt;&#x2F;server&gt;  </span><br><span class="line">  &lt;&#x2F;servers&gt;  </span><br><span class="line">  ...  </span><br><span class="line">&lt;&#x2F;settings&gt;  </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="部署至远程仓库"><a href="#部署至远程仓库" class="headerlink" title="部署至远程仓库"></a>部署至远程仓库</h3><p>私服的一大作用是部署第三方构件，包括组织内部生成的构件以及一些无法从外部仓库直接获取的构件。无论是日常开发中生成的构件，还是正式版本发布的构件，都需要部署到仓库中，供其他团队成员使用。</p>
<p>Maven除了能对项目进行编译、测试、打包之外，还能将项目生成的构建部署到仓库中。首先，需要编辑项目的pom.xml文件。配置distributionManagement元素</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;project&gt;  </span><br><span class="line">  ...  </span><br><span class="line">  &lt;destributionManagement&gt;  </span><br><span class="line">    &lt;repository&gt;  </span><br><span class="line">      &lt;id&gt;proj-releases&lt;&#x2F;id&gt;  </span><br><span class="line">      &lt;name&gt;Proj Release Repository&lt;&#x2F;name&gt;  </span><br><span class="line">      &lt;url&gt;http:&#x2F;&#x2F;192.168.1.100&#x2F;content&#x2F;repositories&#x2F;proj-releases&lt;&#x2F;url&gt;  </span><br><span class="line">    &lt;&#x2F;repository&gt;  </span><br><span class="line">    &lt;snapshotRepository&gt;  </span><br><span class="line">      &lt;id&gt;proj-snapshots&lt;&#x2F;id&gt;  </span><br><span class="line">      &lt;name&gt;Proj Snapshot Repository&lt;&#x2F;name&gt;  </span><br><span class="line">      &lt;url&gt;http:&#x2F;&#x2F;192.168.1.100&#x2F;content&#x2F;repositories&#x2F;proj-snapshots&lt;&#x2F;url&gt;  </span><br><span class="line">    &lt;&#x2F;snapshotRepository&gt;  </span><br><span class="line">  &lt;&#x2F;destributionManagement&gt;  </span><br><span class="line">  ...  </span><br><span class="line">&lt;&#x2F;project&gt; </span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>distributionManagement包含repository和snapshotRepository子元素，前者表示发布版本构件的仓库，后者表示快照版本的仓库。这两个元素下都需要配置id、name和url，id为该远程仓库的唯一标识，name是为了方便人阅读，关键的url表示该仓库的地址。</p>
<p>一般都需要认证。配置正确后，在命令行运行mvn clean deploy，Maven就会将项目构建输出的构件部署到配置对应的远程仓库。</p>
<h2 id="快照版本"><a href="#快照版本" class="headerlink" title="快照版本"></a>快照版本</h2><p>快照版本时为了解决A依赖B模块，B模块一直在不停的更新的情况。</p>
<p>在开发过程中只需将B模块改为2.1-SNAPSHOT，然后发布到私服中，在发布的过程中，maven会自动为构件打时间戳，比如2.1-2009-1214.221414-13表示这个时间点的第13次构建。有了时间戳maven就能随时找到仓库中该构件的最新的文件，这个更新策略是在之前的私服配置中已经介绍，或者使用mvn clean install-U。如果已经稳定，则将2.1-SNAPSHOT改为2.1 .</p>
<p>组织内部的模块或者项目的依赖,由于具有完全的理解和控制权可以使用快照版本，外部依赖如果使用快照版本则会存在潜在的危险。</p>
<h2 id="仓库解析依赖的机制"><a href="#仓库解析依赖的机制" class="headerlink" title="仓库解析依赖的机制"></a>仓库解析依赖的机制</h2><p>当本地仓库没有依赖构件的时候，maven会自动从远程仓库下载；当依赖版本为快照版本的时候maven会自动找到最新的快照。这背后的依赖解析机制可以概括如下:</p>
<p>1.当依赖的范围是system的时候maven直接从本地文件系统解析构件。</p>
<p>2.根据依赖坐标计算仓库路径后，尝试直接从本地仓库寻找构件，如果发现相应构件则解析成功。</p>
<p>3.在本地仓库不存在相应构件的情况下，如果依赖的版本显示的发布版本构件，如1.2,2.1-beta-1等，则遍历所有的远程仓库，发现后下载并解析使用。</p>
<p>4.如果依赖的版本是RELEASE或者LATEST，则基于更新策略读取所有远程仓库的元数据groupId/artifactId/maven-metadata.xml,将其与本地仓库对应元数据合并后计算出RELEASE或者LATEST真实的值，然后基于这个真实的值检查本地和远程仓库如步骤2和3。</p>
<p>5.如果依赖的版本是SNAPSHOT，则基于更新策略读取所有远程仓库的元数据groupId/artifactId/version/maven-metadata.xml，将其与本地仓库对应元数据合并后得到最新快照版本的值，然后基于该值检查本地仓库或者从远程仓库下载。</p>
<p>6.如果最后解析得到的构件版本时间是时间戳格式的快照，如1.4.1-20091104.121450-121，则复制其时间戳格式的文件至非时间戳格式，如SNAPSHOT，并使用该非时间戳格式的构件。</p>
<h2 id="镜像"><a href="#镜像" class="headerlink" title="镜像"></a>镜像</h2><p>如果仓库X可以提供仓库Y存储的所有内容，那么就可以认为X是Y的一个镜像</p>
<p>settings.xml 中配置镜像，以下是中央仓库在中国的一个镜像</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;settings&gt;  </span><br><span class="line">  ...  </span><br><span class="line">  &lt;mirrors&gt;  </span><br><span class="line">    &lt;mirror&gt;  </span><br><span class="line">      &lt;id&gt;maven.net.cn&lt;&#x2F;id&gt;  </span><br><span class="line">      &lt;name&gt;one of the central mirrors in china&lt;&#x2F;name&gt;  </span><br><span class="line">      &lt;url&gt;http:&#x2F;&#x2F;maven.net.cn&#x2F;content&#x2F;groups&#x2F;public&#x2F;&lt;&#x2F;url&gt;  </span><br><span class="line">      &lt;mirrorOf&gt;central&lt;&#x2F;mirrorOf&gt;  </span><br><span class="line">    &lt;&#x2F;mirror&gt;  </span><br><span class="line">  &lt;&#x2F;mirrors&gt;  </span><br><span class="line">  ...  </span><br><span class="line">&lt;&#x2F;settings&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>其中一般私服和镜像一起使用。</p>
<h2 id="仓库搜索服务"><a href="#仓库搜索服务" class="headerlink" title="仓库搜索服务"></a>仓库搜索服务</h2><p>一般使用仓库搜索服务来根据关键字得到maven坐标。</p>
<p>主流的仓库搜索服务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1. sonatype</span><br><span class="line">https:&#x2F;&#x2F;repository.sonatype.org</span><br><span class="line"></span><br><span class="line">2. MVN Browser</span><br><span class="line">http:&#x2F;&#x2F;www.mvnbrowser.com</span><br><span class="line"></span><br><span class="line">3. MVNrepository</span><br><span class="line">http:&#x2F;&#x2F;mvnrepository.com&#x2F;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="生命周期和插件"><a href="#生命周期和插件" class="headerlink" title="生命周期和插件"></a>生命周期和插件</h1><p>maven的生命周期是抽象的，其实际行为都是由插件来完成，如package阶段的任务就会由maven-jar-plugin完成。生命周期和插件两者协同工作，密不可分。</p>
<h2 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h2><p>maven的生命周期就是为了对所有的构建进行抽象和统一。总结了一套包含项目<strong>清理、初始化、编译、测试、打包、集成测试、验证、部署和站点生成等</strong>几乎所有的构建步骤。</p>
<p>maven的生命周期时抽象的，生命周期本身不做工作，主要由插件来完成。类似于设计模式中的模板方法。</p>
<p>maven在生命周期的各个阶段绑定了一个或者多个插件，而且maven为生命周期绑定了默认的插件。</p>
<h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><p>maven定义生命周期和插件机制一方面保证了所有maven项目有一致的构建标准，另一方面又通过默认插件简化和稳定了实际项目的构建。</p>
<h2 id="生命周期详解"><a href="#生命周期详解" class="headerlink" title="生命周期详解"></a>生命周期详解</h2><p>maven有三套相互独立的生命周期，他们分别为clean default site。clean生命周期主要是清理项目，default生命周期主要是构建项目，site生命周期主要时建立项目站点。</p>
<h3 id="clean生命周期：清理项目，包含三个phase。"><a href="#clean生命周期：清理项目，包含三个phase。" class="headerlink" title="clean生命周期：清理项目，包含三个phase。"></a>clean生命周期：清理项目，包含三个phase。</h3><p>1）pre-clean：执行清理前需要完成的工作</p>
<p>2）clean：清理上一次构建生成的文件</p>
<p>3）post-clean：执行清理后需要完成的工作</p>
<h3 id="default生命周期：构建项目，重要的phase如下。"><a href="#default生命周期：构建项目，重要的phase如下。" class="headerlink" title="default生命周期：构建项目，重要的phase如下。"></a>default生命周期：构建项目，重要的phase如下。</h3><p>1）validate：验证工程是否正确，所有需要的资源是否可用。</p>
<p>2）initialize 初始化操作</p>
<p>2）compile：编译项目的源代码。  </p>
<p>3）test：使用合适的单元测试框架来测试已编译的源代码。这些测试不需要已打包和布署。</p>
<p>4）Package：把已编译的代码打包成可发布的格式，比如jar。</p>
<p>5）integration-test：如有需要，将包处理和发布到一个能够进行集成测试的环境。</p>
<p>6）verify：运行所有检查，验证包是否有效且达到质量标准。</p>
<p>7）install：把包安装到maven本地仓库，可以被其他工程作为依赖来使用。</p>
<p>8）Deploy：在集成或者发布环境下执行，将最终版本的包拷贝到远程的repository，使得其他的开发者或者工程可以共享。</p>
<h3 id="site生命周期：建立和发布项目站点，phase如下"><a href="#site生命周期：建立和发布项目站点，phase如下" class="headerlink" title="site生命周期：建立和发布项目站点，phase如下"></a>site生命周期：建立和发布项目站点，phase如下</h3><p>1）pre-site：生成项目站点之前需要完成的工作</p>
<p>2）site：生成项目站点文档</p>
<p>3）post-site：生成项目站点之后需要完成的工作</p>
<p>4）site-deploy：将项目站点发布到服务器</p>
<h3 id="命令行与生命周期"><a href="#命令行与生命周期" class="headerlink" title="命令行与生命周期"></a>命令行与生命周期</h3><p>1.mvn clean 执行clean生命周期的clean阶段，包括pre-clean、clean</p>
<p>2.mvn test 执行default生命周期之前的所有阶段，包括validate initialize compile test</p>
<p>3.mvn clean install 执行包括clean和default生命周期从validate到install的所有阶段</p>
<p>4.mvn clean deploy site-deploy ,执行包括clean 和default所有阶段以及site周期的所有阶段</p>
<h2 id="插件目标"><a href="#插件目标" class="headerlink" title="插件目标"></a>插件目标</h2><p>一个maven插件maven-dependency-plugin可以做很多事情，包括分析项目依赖，列出依赖树，列出所有已经解析的依赖等等。这些功能聚集在一个插件里，每个功能就是一个目标。</p>
<p>maven-dependency-plugin有10多个插件目标如：dependency：analyze；dependency：tree；dependency：list等。冒号前是插件前缀，冒号后面是插件的目标。</p>
<h2 id="插件绑定"><a href="#插件绑定" class="headerlink" title="插件绑定"></a>插件绑定</h2><p>生命周期的阶段与插件的目标项目绑定，以完成某个具体的构建任务。如项目编译这一任务，它对应了default生命周期的compile这一阶段，而maven-compile-plugin这一插件的compile目标能够完成。</p>
<h3 id="内置绑定"><a href="#内置绑定" class="headerlink" title="内置绑定"></a>内置绑定</h3><p><img src="/images/maven/default%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E7%9A%84%E5%86%85%E7%BD%AE%E6%8F%92%E4%BB%B6%E7%BB%91%E5%AE%9A%E5%85%B3%E7%B3%BB%E5%92%8C%E5%85%B7%E4%BD%93%E4%BB%BB%E5%8A%A1.png" alt="default生命周期的内置插件绑定关系和具体任务"></p>
<h3 id="自定义绑定"><a href="#自定义绑定" class="headerlink" title="自定义绑定"></a>自定义绑定</h3><p>除了内置绑定以外，用户还能够自己选择将某个插件目标绑定到生命周期的某个阶段。自定义绑定允许我们自己掌控插件目标与生命周期的结合</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;build&gt;</span><br><span class="line">    &lt;plugins&gt;</span><br><span class="line">        &lt;plugin&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.maven.plugins&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;maven-source-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;2.1.1&lt;&#x2F;version&gt;</span><br><span class="line">            &lt;executions&gt;</span><br><span class="line">                &lt;execution&gt;</span><br><span class="line">                    &lt;id&gt;attach-sources&lt;&#x2F;id&gt;</span><br><span class="line">                    &lt;phase&gt;verify&lt;&#x2F;phase&gt;</span><br><span class="line">                    &lt;goals&gt;</span><br><span class="line">                        &lt;goal&gt;jar-no-fork&lt;&#x2F;goal&gt;</span><br><span class="line">                    &lt;&#x2F;goals&gt;</span><br><span class="line">                &lt;&#x2F;execution&gt;</span><br><span class="line">            &lt;&#x2F;executions&gt;</span><br><span class="line">        &lt;&#x2F;plugin&gt;</span><br><span class="line">    &lt;&#x2F;plugins&gt;</span><br><span class="line">&lt;&#x2F;build&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>上述配置有插件的坐标声明、还有excutions下面每个excution子元素配置的执行的一个个任务、通过phase指定与生命周期的那个阶段绑定、在通过goals指定执行绑定插件的哪些目标。</p>
<p>输出对应插件的详细信息：</p>
<h3 id="使用maven-help-plugin获取插件描述"><a href="#使用maven-help-plugin获取插件描述" class="headerlink" title="使用maven-help-plugin获取插件描述"></a>使用maven-help-plugin获取插件描述</h3><p>以下为显示目标插件的描述命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mvn help:describe -Dplugin&#x3D;org.apache.maven.plugins:maven-source-plugin -Dgoal&#x3D;jar-no-fork -Ddetail&#x3D;true</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>可以使用插件目标前缀来替换坐标:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mvn help:describe -Dplugin &#x3D; compiler</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>如果仅仅是需要描述某个插件的目标信息，则需要加上goal目标 更详细的信息添加-Ddeta</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mvn help:describe -Dplugin &#x3D; compiler -Dgoal &#x3D; compile</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h3 id="插件配置"><a href="#插件配置" class="headerlink" title="插件配置"></a>插件配置</h3><h4 id="从命令行调用插件"><a href="#从命令行调用插件" class="headerlink" title="从命令行调用插件"></a>从命令行调用插件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:&#x2F;home&#x2F;zhuningning&#x2F;IdeaProjects&#x2F;hello-world# mvn -h</span><br><span class="line">usage: mvn [options] [&lt;goal(s)&gt;] [&lt;phase(s)&gt;]</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>我们可以从命令行激活生命周期阶段如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn clean</span><br></pre></td></tr></table></figure>

<p>还可以支持从命令行调用插件目标如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mvn dependency:tree(插件前缀：插件目标)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="Maven变量及常见插件配置详解"><a href="#Maven变量及常见插件配置详解" class="headerlink" title="Maven变量及常见插件配置详解"></a>Maven变量及常见插件配置详解</h3><p>1.自定义变量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;properties&gt;  </span><br><span class="line">    &lt;project.build.name&gt;tools&lt;&#x2F;project.build.name&gt;  </span><br><span class="line">    &lt;project.build.sourceEncoding&gt;UTF-8&lt;&#x2F;project.build.sourceEncoding&gt;  </span><br><span class="line">&lt;&#x2F;properties&gt;  </span><br></pre></td></tr></table></figure>
<p>2.内置变量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$&#123;basedir&#125; 项目根目录</span><br><span class="line">$&#123;project.build.directory&#125; 构建目录，缺省为target</span><br><span class="line">$&#123;project.build.outputDirectory&#125; 构建过程输出目录，缺省为target&#x2F;classes</span><br><span class="line">$&#123;project.build.finalName&#125; 产出物名称，缺省为$&#123;project.artifactId&#125;-$&#123;project.version&#125;</span><br><span class="line">$&#123;project.packaging&#125; 打包类型，缺省为jar</span><br><span class="line">$&#123;project.xxx&#125; 当前pom文件的任意节点的内容</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>3.编译插件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;plugin&gt;  </span><br><span class="line">   &lt;groupId&gt;org.apache.maven.plugins&lt;&#x2F;groupId&gt;  </span><br><span class="line">   &lt;artifactId&gt;maven-compiler-plugin&lt;&#x2F;artifactId&gt;  </span><br><span class="line">   &lt;configuration&gt;  </span><br><span class="line">       &lt;source&gt;1.6&lt;&#x2F;source&gt;  </span><br><span class="line">       &lt;target&gt;1.6&lt;&#x2F;target&gt;  </span><br><span class="line">       &lt;encoding&gt;$&#123;project.build.sourceEncoding&#125;&lt;&#x2F;encoding&gt;  </span><br><span class="line">   &lt;&#x2F;configuration&gt;  </span><br><span class="line">&lt;&#x2F;plugin&gt;</span><br><span class="line"></span><br><span class="line">   source： 源代码编译版本；  </span><br><span class="line">   target： 目标平台编译版本；  </span><br><span class="line">   encoding： 字符集编码</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>4.设置资源文件的编码方式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;plugin&gt;  </span><br><span class="line">  &lt;groupId&gt;org.apache.maven.plugins&lt;&#x2F;groupId&gt;  </span><br><span class="line">  &lt;artifactId&gt;maven-resources-plugin&lt;&#x2F;artifactId&gt;  </span><br><span class="line">  &lt;version&gt;2.4.3&lt;&#x2F;version&gt;  </span><br><span class="line">  &lt;executions&gt;  </span><br><span class="line">      &lt;execution&gt;  </span><br><span class="line">          &lt;phase&gt;compile&lt;&#x2F;phase&gt;  </span><br><span class="line">      &lt;&#x2F;execution&gt;  </span><br><span class="line">  &lt;&#x2F;executions&gt;  </span><br><span class="line">  &lt;configuration&gt;  </span><br><span class="line">      &lt;encoding&gt;$&#123;project.build.sourceEncoding&#125;&lt;&#x2F;encoding&gt;  </span><br><span class="line">  &lt;&#x2F;configuration&gt;  </span><br><span class="line">&lt;&#x2F;plugin&gt; </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>5.自动拷贝jar包到target目录 <a target="_blank" rel="noopener" href="http://liugang594.iteye.com/blog/2093082">参考</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;plugin&gt;  </span><br><span class="line">  &lt;groupId&gt;org.apache.maven.plugins&lt;&#x2F;groupId&gt;  </span><br><span class="line">  &lt;artifactId&gt;maven-dependency-plugin&lt;&#x2F;artifactId&gt;  </span><br><span class="line">  &lt;version&gt;2.6&lt;&#x2F;version&gt;  </span><br><span class="line">  &lt;executions&gt;  </span><br><span class="line">      &lt;execution&gt;  </span><br><span class="line">          &lt;id&gt;copy-dependencies&lt;&#x2F;id&gt;  </span><br><span class="line">          &lt;phase&gt;compile&lt;&#x2F;phase&gt;  </span><br><span class="line">          &lt;goals&gt;  </span><br><span class="line">              &lt;goal&gt;copy-dependencies&lt;&#x2F;goal&gt;  </span><br><span class="line">          &lt;&#x2F;goals&gt;  </span><br><span class="line">          &lt;configuration&gt;  </span><br><span class="line">              &lt;!-- $&#123;project.build.directory&#125;为Maven内置变量，缺省为target --&gt;  </span><br><span class="line">              &lt;outputDirectory&gt;$&#123;project.build.directory&#125;&#x2F;lib&lt;&#x2F;outputDirectory&gt;  </span><br><span class="line">              &lt;!-- 表示是否不包含间接依赖的包 --&gt;  </span><br><span class="line">              &lt;excludeTransitive&gt;false&lt;&#x2F;excludeTransitive&gt;  </span><br><span class="line">              &lt;!-- 表示复制的jar文件去掉版本信息 --&gt;  </span><br><span class="line">              &lt;stripVersion&gt;true&lt;&#x2F;stripVersion&gt;  </span><br><span class="line">          &lt;&#x2F;configuration&gt;  </span><br><span class="line">      &lt;&#x2F;execution&gt;  </span><br><span class="line">  &lt;&#x2F;executions&gt;  </span><br><span class="line">&lt;&#x2F;plugin&gt;  </span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>6.生成源代码jar包</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;plugin&gt;  </span><br><span class="line">  &lt;artifactId&gt;maven-source-plugin&lt;&#x2F;artifactId&gt;  </span><br><span class="line">  &lt;version&gt;2.1&lt;&#x2F;version&gt;  </span><br><span class="line">  &lt;configuration&gt;  </span><br><span class="line">      &lt;!-- &lt;finalName&gt;$&#123;project.build.name&#125;&lt;&#x2F;finalName&gt; --&gt;  </span><br><span class="line">      &lt;attach&gt;true&lt;&#x2F;attach&gt;  </span><br><span class="line">      &lt;encoding&gt;$&#123;project.build.sourceEncoding&#125;&lt;&#x2F;encoding&gt;  </span><br><span class="line">  &lt;&#x2F;configuration&gt;  </span><br><span class="line">  &lt;executions&gt;  </span><br><span class="line">      &lt;execution&gt;  </span><br><span class="line">          &lt;phase&gt;compile&lt;&#x2F;phase&gt;  </span><br><span class="line">          &lt;goals&gt;  </span><br><span class="line">              &lt;goal&gt;jar&lt;&#x2F;goal&gt;  </span><br><span class="line">          &lt;&#x2F;goals&gt;  </span><br><span class="line">      &lt;&#x2F;execution&gt;  </span><br><span class="line">  &lt;&#x2F;executions&gt;  </span><br><span class="line">&lt;&#x2F;plugin&gt;</span><br></pre></td></tr></table></figure>

<ol start="7">
<li>将项目打成jar包</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;plugin&gt;  </span><br><span class="line">  &lt;groupId&gt;org.apache.maven.plugins&lt;&#x2F;groupId&gt;  </span><br><span class="line">  &lt;artifactId&gt;maven-jar-plugin&lt;&#x2F;artifactId&gt;  </span><br><span class="line">  &lt;version&gt;2.4&lt;&#x2F;version&gt;  </span><br><span class="line">  &lt;configuration&gt;  </span><br><span class="line">      &lt;archive&gt;  </span><br><span class="line">          &lt;manifest&gt;  </span><br><span class="line">              &lt;!-- 告知 maven-jar-plugin添加一个 Class-Path元素到 MANIFEST.MF文件，以及在Class-Path元素中包括所有依赖项 --&gt;  </span><br><span class="line">              &lt;addClasspath&gt;true&lt;&#x2F;addClasspath&gt;  </span><br><span class="line">              &lt;!-- 所有的依赖项应该位于 lib文件夹 --&gt;  </span><br><span class="line">              &lt;classpathPrefix&gt;lib&#x2F;&lt;&#x2F;classpathPrefix&gt;  </span><br><span class="line">              &lt;!-- 当用户使用 lib命令执行JAR文件时，使用该元素定义将要执行的类名 --&gt;  </span><br><span class="line">              &lt;mainClass&gt;com.zhengtian.tools.service.phone.MobilePhoneTool&lt;&#x2F;mainClass&gt;  </span><br><span class="line">          &lt;&#x2F;manifest&gt;  </span><br><span class="line">      &lt;&#x2F;archive&gt;  </span><br><span class="line">  &lt;&#x2F;configuration&gt;  </span><br><span class="line">&lt;&#x2F;plugin&gt;  </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="maven的模块聚合-多模块"><a href="#maven的模块聚合-多模块" class="headerlink" title="maven的模块聚合(多模块)"></a>maven的模块聚合(多模块)</h3><p>为了将2个模块聚合到一个模块下，必须新建一个聚合模块，它有自己的pom文件，packaging为pom。modules下配置多个模块</p>
<p>聚合项目可以使用父子结构和平行结构，一般建议使用父子结构。</p>
<p>构建各个模块的顺序是采用反应堆构建顺序</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;project</span><br><span class="line">xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">        xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0</span><br><span class="line">        http:&#x2F;&#x2F;maven.apache.org&#x2F;maven-v4_0_0.xsd&gt;</span><br><span class="line">        &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line">        &lt;groupId&gt;com.juvenxu.mvnbook.account&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;artifact&gt;account-aggregator&lt;&#x2F;artifact&gt;</span><br><span class="line">        &lt;version&gt;1.0.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;packaging&gt;pom&lt;&#x2F;packaging&gt;</span><br><span class="line">        &lt;name&gt;Account Aggregator&lt;&#x2F;name&gt;</span><br><span class="line">        &lt;modules&gt;</span><br><span class="line">            &lt;module&gt;account-email&lt;&#x2F;module&gt;</span><br><span class="line">            &lt;module&gt;account-persist&lt;&#x2F;module&gt;</span><br><span class="line">        &lt;&#x2F;modules&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h3 id="maven的模块继承"><a href="#maven的模块继承" class="headerlink" title="maven的模块继承"></a>maven的模块继承</h3><p>父模块的packaging为pom，这一点与聚合模块一样。父模块是为了消除配置的重复。</p>
<p>父模块：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;project</span><br><span class="line">xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">xsi:shemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0</span><br><span class="line">http:&#x2F;&#x2F;maven.apache.org&#x2F;maven-v4_0_0.xsd&quot;&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line">    &lt;groupId&gt;com.juvenxu.mvnbook.account&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;account-parent&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.0.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;packaging&gt;pom&lt;&#x2F;packaging&gt;</span><br><span class="line">    &lt;name&gt;Account Parent&lt;&#x2F;name&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>继承父模块的子模块</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;project</span><br><span class="line">xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">xsi:shemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0</span><br><span class="line">http:&#x2F;&#x2F;maven.apache.org&#x2F;maven-v4_0_0.xsd&quot;&gt;</span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;groupId&gt;com.juvenxu.mvnbook.account&lt;groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;account-parent&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;version&gt;1.0.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;relativePath&gt;..&#x2F;account-parent&#x2F;pom.xml&lt;&#x2F;relativePath&gt;</span><br><span class="line">    &lt;&#x2F;parent</span><br><span class="line">    </span><br><span class="line">    &lt;artifactId&gt;account-email&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;name&gt;Account Email&lt;&#x2F;name&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        ....</span><br><span class="line">    &lt;&#x2F;dependencies&gt;</span><br><span class="line">    &lt;build&gt;</span><br><span class="line">        &lt;plugins&gt;</span><br><span class="line">            ....</span><br><span class="line">        &lt;&#x2F;plugins&gt;</span><br><span class="line">    &lt;&#x2F;build&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>父模块加入到聚合模块</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;project</span><br><span class="line">xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">        xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0</span><br><span class="line">        http:&#x2F;&#x2F;maven.apache.org&#x2F;maven-v4_0_0.xsd&gt;</span><br><span class="line">        &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line">        &lt;groupId&gt;com.juvenxu.mvnbook.account&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;artifact&gt;account-aggregator&lt;&#x2F;artifact&gt;</span><br><span class="line">        &lt;version&gt;1.0.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;packaging&gt;pom&lt;&#x2F;packaging&gt;</span><br><span class="line">        &lt;name&gt;Account Aggregator&lt;&#x2F;name&gt;</span><br><span class="line">        &lt;modules&gt;</span><br><span class="line">            &lt;module&gt;account-email&lt;&#x2F;module&gt;</span><br><span class="line">            &lt;module&gt;account-persist&lt;&#x2F;module&gt;</span><br><span class="line">            &lt;module&gt;account-parent&lt;&#x2F;module&gt;</span><br><span class="line">        &lt;&#x2F;modules&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>可以继承的pom元素</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">groupId:项目组ID,项目坐标的核心元素</span><br><span class="line">version:项目版本,项目坐标的核心元素</span><br><span class="line">description:项目的描述信息</span><br><span class="line">organnization:项目的组织信息</span><br><span class="line">inceptionYear:项目的创始年份</span><br><span class="line">url:项目的URL地址</span><br><span class="line">developers:项目的开发者信息</span><br><span class="line">contributors:项目的贡献者信息</span><br><span class="line">distributionManagement:项目的部署配置</span><br><span class="line">issueManagement:项目的缺陷跟踪系统信息</span><br><span class="line">ciManagement:项目的集成信息</span><br><span class="line">scm:项目的版本控制系统信息</span><br><span class="line">mailingLists:项目的邮件列表信息</span><br><span class="line">properties:自定义的Maven属性</span><br><span class="line">dependencies:项目的依赖配置</span><br><span class="line">dependencyManagement:项目的依赖管理配置</span><br><span class="line">repositories:项目的仓库配置</span><br><span class="line">build:包括项目的源码目录配置、输出目录配置、插件配置、插件管理配置等</span><br><span class="line">reporting:包括项目的报告输出目录配置，报告插件配置等。</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="模块的依赖管理"><a href="#模块的依赖管理" class="headerlink" title="模块的依赖管理"></a>模块的依赖管理</h3><p>Maven提供的dependentcyManagement元素既能让子模块继承到父模块的依赖配置，又能保证子模块依赖使用的灵活度。在dependentcyManagement元素下的依赖声明不会引入实际的依赖，不过他能够约束denpendencies下的依赖使用</p>
<p>整理后的父模块的pom</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">&lt;project</span><br><span class="line">xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">xsi:shemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0</span><br><span class="line">http:&#x2F;&#x2F;maven.apache.org&#x2F;maven-v4_0_0.xsd&quot;&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line">    &lt;groupId&gt;com.juvenxu.mvnbook.account&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;account-parent&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.0.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;packaging&gt;pom&lt;&#x2F;packaging&gt;</span><br><span class="line">    &lt;name&gt;Account Parent&lt;&#x2F;name</span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">        &lt;springframework.version&gt;2.5.6&lt;&#x2F;springframework.version&gt;</span><br><span class="line">        &lt;junit.version&gt;4.7&lt;&#x2F;junit.version&gt;</span><br><span class="line">    &lt;&#x2F;properties&gt;</span><br><span class="line">    &lt;dependencyManagement&gt;</span><br><span class="line">        &lt;dependencies&gt;</span><br><span class="line">            &lt;dependency&gt;</span><br><span class="line">                &lt;groupId&gt;org.springframework&lt;&#x2F;groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;spring-core&lt;&#x2F;artifactId&gt;</span><br><span class="line">                &lt;version&gt;$&#123;springframework.version&#125;&lt;&#x2F;version&gt;</span><br><span class="line">            &lt;&#x2F;dependency&gt;</span><br><span class="line">            &lt;dependency&gt;</span><br><span class="line">                &lt;groupId&gt;org.springframework&lt;&#x2F;groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;spring-beans&lt;&#x2F;artifactId&gt;</span><br><span class="line">                &lt;version&gt;$&#123;springframework.version&#125;&lt;&#x2F;version&gt;</span><br><span class="line">            &lt;&#x2F;dependency&gt;</span><br><span class="line">            &lt;dependency&gt;</span><br><span class="line">                &lt;groupId&gt;org.springframework&lt;&#x2F;groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;spring-context&lt;&#x2F;artifactId&gt;</span><br><span class="line">                &lt;version&gt;$&#123;springframework.version&#125;&lt;&#x2F;version&gt;</span><br><span class="line">            &lt;&#x2F;dependency&gt;</span><br><span class="line">            &lt;dependency&gt;</span><br><span class="line">                &lt;groupId&gt;org.springframework&lt;&#x2F;groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;spring-context-support&lt;&#x2F;artifactId&gt;</span><br><span class="line">                &lt;version&gt;$&#123;springframework.version&#125;&lt;&#x2F;version&gt;</span><br><span class="line">            &lt;&#x2F;dependency&gt;</span><br><span class="line">            &lt;dependency&gt;</span><br><span class="line">                &lt;groupId&gt;junit&lt;&#x2F;groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;junit&lt;&#x2F;artifactId&gt;</span><br><span class="line">                &lt;version&gt;$&#123;springframework.version&#125;&lt;&#x2F;version&gt;</span><br><span class="line">                &lt;scope&gt;test&lt;&#x2F;scope&gt;</span><br><span class="line">            &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;&#x2F;dependencies&gt;</span><br><span class="line">    &lt;&#x2F;dependencyManagement&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>整理后的继承父模块的子模块</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;properties&gt;</span><br><span class="line">    &lt;javax.mail.version&gt;1.4.1&lt;&#x2F;javax.mail.version&gt;</span><br><span class="line">    &lt;greenmail.version&gt;1.3.1b&lt;&#x2F;greenmail.version&gt;</span><br><span class="line">&lt;&#x2F;properties&gt;</span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-core&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-beans&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-context&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-context-support&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;junit&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;junit&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;javax.mail&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mail&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;$&#123;javax.mail.version&#125;&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;javax.icegreen&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;greenmail&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;$&#123;greenmail.version&#125;&lt;&#x2F;version&gt;</span><br><span class="line">            &lt;scope&gt;test&lt;&#x2F;scope&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">    &lt;&#x2F;dependencies&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>子模块只需要配置简单的groupId和artifactId就能获得对应的依赖信息，从而引入正确的依赖。</p>
<p>如果在子模块不声明依赖的使用，即使该依赖已经在父POM的dependencyManagement中声明了，也不会产生任何实际的效果。</p>
<p>依赖范围有个import范围，import依赖范围只有在dependencyManagement下才有效果，使用该范围的依赖通常指向一个POM，作用是将目标中的dependencyManagement配置导入到当前POM的dependencyManagement中配置，除了复制配置或者继承这两种方式之外，还可以使用import范围依赖将这一配置导入。</p>
<h3 id="插件管理"><a href="#插件管理" class="headerlink" title="插件管理"></a>插件管理</h3><p>Maven提供了dependencyManagement元素帮忙管理依赖，类似地，Maven也提供了pluginManagement元素帮忙管理插件。该元素中配置的依赖不会造成实际的插件调用行为，当POM中配置了真正的plugin元素，并且其groupId和artifactId与pluginManagement中配置的插件匹配时，pluginManagement的配置才会影响实际的插件行为。</p>
<h3 id="聚合和继承的关系"><a href="#聚合和继承的关系" class="headerlink" title="聚合和继承的关系"></a>聚合和继承的关系</h3><p>多模块中的聚合与继承其实是两个概念，其目的是完全不同的，前者主要是为了方便快速构建项目，后者主要是为了消除重复配置。</p>
<p>在现有的实际项目中，往往会发现一个POM即是聚合POM，又是父POM，这么做主要是为了方便。</p>
<h3 id="约定优于配置"><a href="#约定优于配置" class="headerlink" title="约定优于配置"></a>约定优于配置</h3><p>Maven默认的源码目录是：src/main/java但是用户也可以自己指定源码目录，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;project&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line">    &lt;groupId&gt;com.juvenxu.mvnbook&lt;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;my-project&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.0&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;build&gt;</span><br><span class="line">        &lt;sourceDirectory&gt;src&#x2F;java&lt;&#x2F;sourceDirectory&gt;</span><br><span class="line">    &lt;&#x2F;build&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>

<p>maven会默认隐身的继承于超级pom，超级pom内容如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;repositories&gt;</span><br><span class="line">    &lt;repository&gt;</span><br><span class="line">        &lt;id&gt;central&lt;&#x2F;id&gt;</span><br><span class="line">        &lt;name&gt;Maven Repository Switchboard&lt;&#x2F;name&gt;</span><br><span class="line">        &lt;url&gt;http:&#x2F;&#x2F;repo1.maven.org&#x2F;maven2&lt;&#x2F;url&gt;</span><br><span class="line">        &lt;layout&gt;default&lt;&#x2F;layout&gt;</span><br><span class="line">        &lt;snapshots&gt;</span><br><span class="line">            &lt;enabled&gt;false&lt;&#x2F;enabled&gt;</span><br><span class="line">        &lt;&#x2F;snapshots&gt;</span><br><span class="line">    &lt;&#x2F;repository&gt;</span><br><span class="line">&lt;&#x2F;repositories&gt;</span><br><span class="line">&lt;pluginRepositories&gt;</span><br><span class="line">    &lt;pluginRepository&gt;</span><br><span class="line">        &lt;id&gt;central&lt;&#x2F;id&gt;</span><br><span class="line">        &lt;name&gt;Maven Plugin Repository&lt;&#x2F;name&gt;</span><br><span class="line">        &lt;url&gt;http:&#x2F;&#x2F;repo1.maven.org&#x2F;maven2&lt;&#x2F;url&gt;</span><br><span class="line">        &lt;layout&gt;default&lt;&#x2F;layout&gt;</span><br><span class="line">        &lt;snapshots&gt;</span><br><span class="line">            &lt;enabled&gt;false&lt;&#x2F;enabled&gt;</span><br><span class="line">        &lt;&#x2F;snapshots&gt;</span><br><span class="line">        &lt;releases&gt;</span><br><span class="line">            &lt;updatePolicy&gt;never&lt;&#x2F;updatePolicy&gt;</span><br><span class="line">        &lt;&#x2F;releases&gt;</span><br><span class="line">    &lt;&#x2F;pluginRepository&gt;</span><br><span class="line">&lt;&#x2F;pluginRepositories&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>超级POM中关于项目结构的定义：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;build&gt;</span><br><span class="line">    &lt;directory&gt;$&#123;project.basedir&#125;&#x2F;target&lt;directory&gt;</span><br><span class="line">    &lt;outputDirectory&gt;$&#123;project.build.directory&#125;&#x2F;classes&lt;&#x2F;outputDirectory&gt;</span><br><span class="line">    &lt;finalName&gt;$&#123;project.artifactId&#125;-$&#123;project.version&#125;&lt;&#x2F;finalName&gt;</span><br><span class="line">    &lt;testOutputDirectory&gt;$&#123;project.build.directory&#125;&#x2F;test-classes&lt;&#x2F;testOutputDirectory&gt;</span><br><span class="line">    &lt;sourceDirectory&gt;$&#123;project.basedir&#125;&#x2F;src&#x2F;main&#x2F;java&lt;&#x2F;sourceDirectory&gt;</span><br><span class="line">    &lt;scriptSourceDirectory&gt;src&#x2F;main&#x2F;script&lt;&#x2F;scriptSourceDirectory&gt;</span><br><span class="line">    &lt;testSourceDirectory&gt;$&#123;project.basedir&#125;&#x2F;src&#x2F;test&#x2F;java&lt;&#x2F;testSourceDirectory&gt;</span><br><span class="line">    &lt;resources&gt;</span><br><span class="line">        &lt;resource&gt;</span><br><span class="line">            &lt;directory&gt;$&#123;project.basedir&#125;&#x2F;src&#x2F;main&#x2F;resources&lt;&#x2F;directory&gt;</span><br><span class="line">        &lt;&#x2F;resource&gt;</span><br><span class="line">    &lt;&#x2F;resources&gt;</span><br><span class="line">    &lt;testResources&gt;</span><br><span class="line">        &lt;testResource&gt;</span><br><span class="line">            &lt;directory&gt;$&#123;project.basedir&#125;&#x2F;src&#x2F;test&#x2F;resources&lt;&#x2F;directory&gt;</span><br><span class="line">        &lt;&#x2F;testResource&gt;</span><br><span class="line">    &lt;&#x2F;testResources&gt;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>以下是超级pom关于插件版本的设定</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;pluginManagement&gt;</span><br><span class="line">    &lt;plugins&gt;</span><br><span class="line">        &lt;plugin&gt;</span><br><span class="line">            &lt;artifactId&gt;maven-antrun-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.3&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;plugin&gt;</span><br><span class="line"></span><br><span class="line">        &lt;plugin&gt;</span><br><span class="line">            &lt;artifactId&gt;maven-assembly-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;2.2-bete-4&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;plugin&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;plugin&gt;</span><br><span class="line">            &lt;artifactId&gt;maven-clean-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;2.3&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;plugin&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;plugin&gt;</span><br><span class="line">            &lt;artifactId&gt;maven-compiler-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;2.0.2&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;plugin&gt;</span><br><span class="line">        ........</span><br><span class="line">    &lt;&#x2F;plugins&gt;</span><br><span class="line">&lt;&#x2F;pluginManagement&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;build&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>超级pom的位置</p>
<p>对于Maven3,超级POM在文件$MAVEN_HOME/lib/maven-model-builder-x.x.x.jar中的org/apache/maven/model/pom-4.0.0.xml路径下。</p>
<p>对于Maven2,超级POM在文件$MAVEN_HOME/lib/maven-x.x.x-uber.jar中的org/apache/maven/project/pom-4.0.0.xml目录下。</p>
<h3 id="反应堆"><a href="#反应堆" class="headerlink" title="反应堆"></a>反应堆</h3><p>对于一个多模块的项目，反应堆就是所有模块构成的一个构建结构。反应堆就包含了各模块之间继承与依赖的关系，从而能够自动计算出合理的模块构建顺序。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;modules&gt;</span><br><span class="line">    &lt;module&gt;account-email&lt;&#x2F;module&gt;</span><br><span class="line">    &lt;module&gt;account-persist&lt;&#x2F;module&gt;</span><br><span class="line">    &lt;module&gt;account-parent&lt;&#x2F;module&gt;</span><br><span class="line">&lt;&#x2F;modules&gt;</span><br></pre></td></tr></table></figure>

<p>实际项目时这样的，maven按照顺序读取pom，如果pom没有依赖模块，那么就构建该模块。否则就构建其它依赖模块。如果其它依赖模块还依赖别的其它模块，则先构建别的模块。</p>
<p>以上，构建顺序不一定是顺序去读取POM的顺序，当一个模块依赖于另外一个模块，Maven会先去构建被依赖模块，<br>并且Maven中不允许出现循环依赖的情况，就是，当出现模块A依赖于B,而B又依赖于A的情况时，Maven就会报错。</p>
<h3 id="裁剪反应堆"><a href="#裁剪反应堆" class="headerlink" title="裁剪反应堆"></a>裁剪反应堆</h3><p>一般来说，用户会选择构建整个项目或者选择构建单个的模块，但有些时候，用户会想要仅仅构建完整反应堆中的某些个模块。换句话说，用户需要实时地剪裁反应堆。</p>
<p>Maven提供很多命令行选项支持裁剪反应堆，输入mvn -h可以看到这些选项：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-am, --also-make：同时构建所列模块的依赖模块</span><br><span class="line">-amd -also-make-dependents:同时构建依赖于所列模块的模块</span><br><span class="line">-p,--project 构建指定的模块，模块之间使用逗号分割</span><br><span class="line">-rf -resume-from 从指定的模块回复反应堆</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>例子：</p>
<p>默认情况从account-aggregator执行mvn clean install会得到如下完整的反应堆：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[INFO]-----------------------------------------------------</span><br><span class="line">[INFO]Reactor Build Order:</span><br><span class="line">[INFO]</span><br><span class="line">[INFO]Account Aggregator</span><br><span class="line">[INFO]Account Parent</span><br><span class="line">[INFO]Account Email</span><br><span class="line">[INFO]Account Persist</span><br><span class="line">[INFO]</span><br><span class="line">[INFO]-----------------------------------------------------</span><br></pre></td></tr></table></figure>

<p>可以使用-pl选项指定构建某几个模块，如运行如下命令：</p>
<p>$ mvn clean install -p account-email,account-persist<br>得到的反应堆为:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[INFO]-----------------------------------------------------</span><br><span class="line">[INFO]Reactor Build Order:</span><br><span class="line">[INFO]</span><br><span class="line">[INFO]Account Email</span><br><span class="line">[INFO]Account Persist</span><br><span class="line">[INFO]</span><br><span class="line">[INFO]-----------------------------------------------------</span><br></pre></td></tr></table></figure>

<p>使用-am选项可以同时构建所列模块的依赖模块，例如：</p>
<p>$ mvn clean install -pl account-parent -am<br>由于account-email和account-persist都依赖于account-parent，因此会得到如下反应堆：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[INFO]-----------------------------------------------------</span><br><span class="line">[INFO]Reactor Build Order:</span><br><span class="line">[INFO]</span><br><span class="line">[INFO]Account Parent</span><br><span class="line">[INFO]Account Email</span><br><span class="line">[INFO]Account Persist</span><br><span class="line">[INFO]</span><br><span class="line">[INFO]-----------------------------------------------------</span><br></pre></td></tr></table></figure>

<p>使用-rf选项可以在完整的反应堆构建顺序基础上指定从哪个模块开始构建。例如：</p>
<p>$mvn clean install -rf account-email<br>完整的反应堆构建顺序中，account-email位于第三，它之后只有account-persist因此会得到如下的剪裁反应堆：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[INFO]-----------------------------------------------------</span><br><span class="line">[INFO]Reactor Build Order:</span><br><span class="line">[INFO]</span><br><span class="line">[INFO]Account Email</span><br><span class="line">[INFO]Account Persist</span><br><span class="line">[INFO]</span><br><span class="line">[INFO]-----------------------------------------------------</span><br></pre></td></tr></table></figure>
<p>最后在-pl -am或者-pl -amd的基础上，还能应用-rf参数，以对裁剪后的反应堆再次剪裁,例如：</p>
<p>$ mvn clean install -pl account-parent -amd -rf account-email<br>该命令中的-pl和-amd参数会裁剪出一个account-parent、account-email和account-persist的反应堆，在此基础上，-rf参数指定从account-email参数构建。因此会得到如下的反应堆：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[INFO]-----------------------------------------------------</span><br><span class="line">[INFO]Reactor Build Order:</span><br><span class="line">[INFO]</span><br><span class="line">[INFO]Account Email</span><br><span class="line">[INFO]Account Persist</span><br><span class="line">[INFO]</span><br><span class="line">[INFO]-----------------------------------------------------</span><br></pre></td></tr></table></figure>

<p>在开发过程中，灵活应用上述四个参数，可以帮助我们跳过无须构建的模块，从而加速构建。在项目庞大、规模特别多的时候，这种效果就会异常明显。</p>
<h2 id="私服-1"><a href="#私服-1" class="headerlink" title="私服"></a>私服</h2><h3 id="私服的优点"><a href="#私服的优点" class="headerlink" title="私服的优点"></a>私服的优点</h3><p>1.节省外网宽带<br>2.加速Maven构建<br>3.部署第三方构件<br>4.提高稳定性、增强控制：原因是外网不稳定<br>5.降低中央仓库的负荷：原因是中央仓库访问量太大</p>
<h3 id="镜像库"><a href="#镜像库" class="headerlink" title="镜像库"></a>镜像库</h3><p>mirror相当于一个拦截器，它会拦截maven对remote repository的相关请求，把请求里的remote repository地址，重定向到mirror里配置的地址。</p>
<h3 id="nexus私服的安装方式"><a href="#nexus私服的安装方式" class="headerlink" title="nexus私服的安装方式"></a>nexus私服的安装方式</h3><p>Nexus提供了两种安装方式，一种是内嵌Jetty的bundle，只要你有JRE就能直接运行。第二种方式是WAR，你只须简单的将其发布到web容器中即可使用。</p>
<p>我们采用第一种：</p>
<p>1.下载解压后的文件 <a target="_blank" rel="noopener" href="http://download.sonatype.com/nexus/oss/nexus-2.10.0-02-bundle.tar.gz">bundle文件下载</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">zhuningning@ubuntu:&#x2F;usr&#x2F;local&#x2F;nexus-2.10.0-02$ ls</span><br><span class="line">bin  conf  lib  LICENSE.txt  logs  nexus  NOTICE.txt  tmp</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>2.在bin目录下启动文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">zhuningning@ubuntu:&#x2F;usr&#x2F;local&#x2F;nexus-2.10.0-02&#x2F;bin$ sudo .&#x2F;nexus start</span><br><span class="line">****************************************</span><br><span class="line">WARNING - NOT RECOMMENDED TO RUN AS ROOT</span><br><span class="line">****************************************</span><br><span class="line">If you insist running as root, then set the environment variable RUN_AS_USER&#x3D;root before running this script.</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>/nexus-2.12.0-01/bin/nexus 在该文件中增加一行配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">RUN_AS_USER&#x3D;root</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>3.修改nexus.properties配置文件(可选) 在config目录下</p>
<p>4.启动</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">zhuningning@ubuntu:&#x2F;usr&#x2F;local&#x2F;nexus-2.10.0-02&#x2F;bin$ sudo .&#x2F;nexus start</span><br><span class="line">****************************************</span><br><span class="line">WARNING - NOT RECOMMENDED TO RUN AS ROOT</span><br><span class="line">****************************************</span><br><span class="line">Starting Nexus OSS...</span><br><span class="line">Started Nexus OSS.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>5.报错 nexus启动报错(Unable to start JVM: No such file or directory (2))</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">通过 service nexus start 启动报错，查看 &#x2F;usr&#x2F;local&#x2F;nexus&#x2F;nexus-2.10.0-02&#x2F;logs 下的日志得出是找不到jdk路径</span><br><span class="line"></span><br><span class="line">解决:</span><br><span class="line">修改[NEXUS_HOME]&#x2F;bin&#x2F;jsw&#x2F;conf&#x2F;wrapper.conf（&#x2F;usr&#x2F;local&#x2F;nexus&#x2F;nexus-2.10.0-02&#x2F;bin&#x2F;jsw&#x2F;conf） 文件中的 wrapper.java.command&#x3D;java目录  就可以了，将它改成java的安装位置。</span><br><span class="line">    wrapper.java.command&#x3D;&#x2F;usr&#x2F;java&#x2F;jdk1.8.0_151&#x2F;bin&#x2F;java</span><br></pre></td></tr></table></figure>

<p>6.重新启动 成功</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">jvm 1    | 2018-09-17 00:25:10,375+0800 INFO  [jetty-main-1] *SYSTEM org.eclipse.jetty.server.AbstractConnector - Started InstrumentedSelectChannelConnector@0.0.0.0:8081</span><br><span class="line"></span><br><span class="line">表示启动成功</span><br></pre></td></tr></table></figure>

<p>7.访问 <a target="_blank" rel="noopener" href="http://localhost:8081/nexus/#welcome">http://localhost:8081/nexus/#welcome</a> 使用默认密码登录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">默认管理员</span><br><span class="line"></span><br><span class="line">账号：admin</span><br><span class="line"></span><br><span class="line">密码：admin123</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">默认发布者</span><br><span class="line"></span><br><span class="line">账号：deployment</span><br><span class="line"></span><br><span class="line">密码：deployment123</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>8.登录后如图所示：</p>
<p><img src="/images/maven/nexus%E7%99%BB%E5%BD%95%E7%95%8C%E9%9D%A2.png" alt="nexus登录界面"></p>
<h3 id="nexus仓库与仓库组"><a href="#nexus仓库与仓库组" class="headerlink" title="nexus仓库与仓库组"></a>nexus仓库与仓库组</h3><p>有四种类型:group(仓库组),hosted(宿主),proxy(代理),virtual(虚拟)。仓库还有一个属性为Pilicy(策略),表示该仓库为发布(Release)版本还是快照(Snapshot)版本库。最后两列为仓库的状态和路径</p>
<p>下面解释一下各个仓库的用途，maven1格式的仓库不会介绍。此外由于虚拟类型仓库的作用实际上是动态地将仓库内容格式转换，换言之也是为了服务maven1格式，因此也被省略。</p>
<ul>
<li><p>Central:该仓库代理maven中央仓库，其策略为Release，因此只会下载和缓存中央仓库中的发布版本构件。</p>
</li>
<li><p>Releases:这是一个策略为Release的宿主类型仓库，用来部署组织内部的发布版本构件。</p>
</li>
<li><p>Snapshots:这是一个策略为Snapshots的宿主类型仓库，用来部署组织内部的快照版本构件。</p>
</li>
<li><p>3rd party:这是一个策略为Release的宿主类型仓库，用来部署无法从公共仓库获得的第三方发布版本构件。</p>
</li>
<li><p>Apache Snapshots:这是一个策略为Snapshot的代理仓库，用来代理Apache Maven仓库的快照版本构件。</p>
</li>
<li><p>Codehaus Snapshots:这是一个策略为Snapshot的代理仓库，用来代理Codehaus Maven仓库的快照版本构件。</p>
</li>
<li><p>Public Repositories:该仓库组将上述所有策略为Release的仓库聚合并通过一致的地址提供服务。</p>
</li>
</ul>
<h3 id="nexus仓库分类的概念"><a href="#nexus仓库分类的概念" class="headerlink" title="nexus仓库分类的概念"></a>nexus仓库分类的概念</h3><p><img src="/images/maven/%E5%90%84%E7%A7%8D%E7%B1%BB%E5%9E%8B%E7%9A%84nexus%E4%BB%93%E5%BA%93.png" alt="各种类型的nexus仓库"></p>
<p>maven可以直接从宿主仓库下载构建，也可以直接从代理仓库下载构建，而代理仓库会直接从远程仓库下载并缓存构建。最后为了方便可以从仓库组下载构建。</p>
<h3 id="从nexus私服下载jar包"><a href="#从nexus私服下载jar包" class="headerlink" title="从nexus私服下载jar包"></a>从nexus私服下载jar包</h3><p>在maven的settings的文件中配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;profile&gt;    </span><br><span class="line">    &lt;!--profile 的 id--&gt; </span><br><span class="line">   &lt;id&gt;dev&lt;&#x2F;id&gt;    </span><br><span class="line">    &lt;repositories&gt;    </span><br><span class="line">      &lt;repository&gt;   </span><br><span class="line">        &lt;!--仓库 id，repositories 可以配置多个仓库，保证 id 不重复--&gt; </span><br><span class="line">        &lt;id&gt;nexus&lt;&#x2F;id&gt;    </span><br><span class="line">        &lt;!--仓库地址，即 nexus 仓库组的地址--&gt; </span><br><span class="line">        &lt;url&gt;http:&#x2F;&#x2F;localhost:8081&#x2F;nexus&#x2F;content&#x2F;groups&#x2F;public&#x2F;&lt;&#x2F;url&gt;    </span><br><span class="line">        &lt;!--是否下载 releases 构件--&gt; </span><br><span class="line">        &lt;releases&gt;    </span><br><span class="line">          &lt;enabled&gt;true&lt;&#x2F;enabled&gt;    </span><br><span class="line">        &lt;&#x2F;releases&gt;    </span><br><span class="line">        &lt;!--是否下载 snapshots 构件--&gt; </span><br><span class="line">        &lt;snapshots&gt;    </span><br><span class="line">          &lt;enabled&gt;true&lt;&#x2F;enabled&gt;    </span><br><span class="line">        &lt;&#x2F;snapshots&gt;    </span><br><span class="line">      &lt;&#x2F;repository&gt;    </span><br><span class="line">    &lt;&#x2F;repositories&gt;   </span><br><span class="line">     &lt;pluginRepositories&gt;   </span><br><span class="line">     &lt;!-- 插件仓库，maven 的运行依赖插件，也需要从私服下载插件 --&gt; </span><br><span class="line">        &lt;pluginRepository&gt;   </span><br><span class="line">         &lt;!-- 插件仓库的 id 不允许重复，如果重复后边配置会覆盖前边 --&gt; </span><br><span class="line">            &lt;id&gt;public&lt;&#x2F;id&gt;   </span><br><span class="line">            &lt;name&gt;Public Repositories&lt;&#x2F;name&gt;   </span><br><span class="line">            &lt;url&gt;http:&#x2F;&#x2F;localhost:8081&#x2F;nexus&#x2F;content&#x2F;groups&#x2F;public&#x2F;&lt;&#x2F;url&gt;   </span><br><span class="line">        &lt;&#x2F;pluginRepository&gt;   </span><br><span class="line">    &lt;&#x2F;pluginRepositories&gt;   </span><br><span class="line">  &lt;&#x2F;profile&gt;   </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>使用 profile 定义仓库需要激活才可生效。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;activeProfiles&gt; </span><br><span class="line">  &lt;activeProfile&gt;dev&lt;&#x2F;activeProfile&gt; </span><br><span class="line">&lt;&#x2F;activeProfiles&gt; </span><br></pre></td></tr></table></figure>


<h4 id="比较常用的maven镜像"><a href="#比较常用的maven镜像" class="headerlink" title="比较常用的maven镜像"></a>比较常用的maven镜像</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;mirror&gt;</span><br><span class="line">    &lt;id&gt;alimaven&lt;&#x2F;id&gt;</span><br><span class="line">    &lt;name&gt;aliyun maven&lt;&#x2F;name&gt;</span><br><span class="line">    &lt;url&gt;http:&#x2F;&#x2F;maven.aliyun.com&#x2F;nexus&#x2F;content&#x2F;groups&#x2F;public&#x2F;&lt;&#x2F;url&gt;</span><br><span class="line">    &lt;mirrorOf&gt;central&lt;&#x2F;mirrorOf&gt;</span><br><span class="line">&lt;&#x2F;mirror&gt;</span><br><span class="line">&lt;mirror&gt;</span><br><span class="line">    &lt;id&gt;ui&lt;&#x2F;id&gt;</span><br><span class="line">    &lt;mirrorOf&gt;central&lt;&#x2F;mirrorOf&gt;</span><br><span class="line">    &lt;name&gt;Human Readable Name for this Mirror.&lt;&#x2F;name&gt;</span><br><span class="line">    &lt;url&gt;http:&#x2F;&#x2F;uk.maven.org&#x2F;maven2&#x2F;&lt;&#x2F;url&gt;</span><br><span class="line">&lt;&#x2F;mirror&gt;</span><br><span class="line">&lt;mirror&gt;</span><br><span class="line">    &lt;id&gt;jboss-public-repository-group&lt;&#x2F;id&gt;</span><br><span class="line">    &lt;mirrorOf&gt;central&lt;&#x2F;mirrorOf&gt;</span><br><span class="line">    &lt;name&gt;JBoss Public Repository Group&lt;&#x2F;name&gt;</span><br><span class="line">    &lt;url&gt;http:&#x2F;&#x2F;repository.jboss.org&#x2F;nexus&#x2F;content&#x2F;groups&#x2F;public&lt;&#x2F;url&gt;</span><br><span class="line">&lt;&#x2F;mirror&gt;</span><br><span class="line">&lt;mirror&gt;</span><br><span class="line">    &lt;id&gt;repo2&lt;&#x2F;id&gt;</span><br><span class="line">    &lt;mirrorOf&gt;central&lt;&#x2F;mirrorOf&gt;</span><br><span class="line">    &lt;name&gt;Human Readable Name for this Mirror.&lt;&#x2F;name&gt;</span><br><span class="line">    &lt;url&gt;http:&#x2F;&#x2F;repo2.maven.org&#x2F;maven2&#x2F;&lt;&#x2F;url&gt;</span><br><span class="line">&lt;&#x2F;mirror&gt;</span><br><span class="line">&lt;mirror&gt;</span><br><span class="line">    &lt;id&gt;OSChina&lt;&#x2F;id&gt;</span><br><span class="line">    &lt;name&gt;OSChina Central&lt;&#x2F;name&gt;</span><br><span class="line">    &lt;url&gt;http:&#x2F;&#x2F;maven.oschina.net&#x2F;content&#x2F;groups&#x2F;public&#x2F;&lt;&#x2F;url&gt;</span><br><span class="line">    &lt;mirrorOf&gt;central&lt;&#x2F;mirrorOf&gt;</span><br><span class="line">&lt;&#x2F;mirror&gt;</span><br><span class="line">&lt;mirror&gt;</span><br><span class="line">    &lt;id&gt;nexus-osc-thirdparty&lt;&#x2F;id&gt;</span><br><span class="line">    &lt;mirrorOf&gt;thirdparty&lt;&#x2F;mirrorOf&gt;</span><br><span class="line">    &lt;name&gt;Nexus osc thirdparty&lt;&#x2F;name&gt;</span><br><span class="line">    &lt;url&gt;http:&#x2F;&#x2F;maven.oschina.net&#x2F;content&#x2F;repositories&#x2F;thirdparty&#x2F;&lt;&#x2F;url&gt;</span><br><span class="line">&lt;&#x2F;mirror&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="maven镜像的使用"><a href="#maven镜像的使用" class="headerlink" title="maven镜像的使用"></a>maven镜像的使用</h3><p>编辑settings.xml配置中央仓库镜像：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;settings&gt;</span><br><span class="line">  ...</span><br><span class="line">  &lt;mirrors&gt;</span><br><span class="line">    &lt;mirror&gt;</span><br><span class="line">      &lt;id&gt;maven.net.cn&lt;&#x2F;id&gt;</span><br><span class="line">      &lt;name&gt;one of the central mirrors in china&lt;&#x2F;name&gt;</span><br><span class="line">      &lt;url&gt;http:&#x2F;&#x2F;maven.net.cn&#x2F;content&#x2F;groups&#x2F;public&#x2F;&lt;&#x2F;url&gt;</span><br><span class="line">      &lt;mirrorOf&gt;central&lt;&#x2F;mirrorOf&gt;</span><br><span class="line">    &lt;&#x2F;mirror&gt;</span><br><span class="line">  &lt;&#x2F;mirrors&gt;</span><br><span class="line">  ...</span><br><span class="line">&lt;&#x2F;settings&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>该例中，<mirrorOf>的值为central，表示该配置为中央仓库的镜像，任何对于中央仓库的请求都会转至该镜像，用户也可以使用同样的方法配置其他仓库的镜像。另外三个元素id,name,url与一般仓库配置无异，表示该镜像仓库的唯一标识符、名称以及地址。类似地，如果该镜像需认证，也可以基于该id配置仓库认证。<br>任何需要的构件都可以从私服获得，私服就是所有仓库的镜像。这时，可以配置这样的一个镜像，如例： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;settings&gt;</span><br><span class="line">  ...</span><br><span class="line">  &lt;mirrors&gt;</span><br><span class="line">    &lt;mirror&gt;</span><br><span class="line">      &lt;id&gt;internal-repository&lt;&#x2F;id&gt;</span><br><span class="line">      &lt;name&gt;Internal Repository Manager&lt;&#x2F;name&gt;</span><br><span class="line">      &lt;url&gt;http:&#x2F;&#x2F;192.168.1.100&#x2F;maven2&lt;&#x2F;url&gt;</span><br><span class="line">      &lt;mirrorOf&gt;*&lt;&#x2F;mirrorOf&gt;</span><br><span class="line">    &lt;&#x2F;mirror&gt;</span><br><span class="line">  &lt;&#x2F;mirrors&gt;</span><br><span class="line">  ...</span><br><span class="line">&lt;&#x2F;settings&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>该例中<mirrorOf>的值为星号，表示该配置是所有Maven仓库的镜像，任何对于远程仓库的请求都会被转至<a target="_blank" rel="noopener" href="http://192.168.1.100/maven2/%E3%80%82%E5%A6%82%E6%9E%9C%E8%AF%A5%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93%E9%9C%80%E8%A6%81%E8%AE%A4%E8%AF%81%EF%BC%8C%E5%88%99%E9%85%8D%E7%BD%AE%E4%B8%80%E4%B8%AAId%E4%B8%BAinternal-repository%E7%9A%84">http://192.168.1.100/maven2/。如果该镜像仓库需要认证，则配置一个Id为internal-repository的</a><server>即可。为了满足一些复杂的需求，Maven还支持更高级的镜像配置：</p>
<p>1.<mirrorOf>*</mirrorOf></p>
<p>匹配所有远程仓库。</p>
<p>2.<mirrorOf>external:*</mirrorOf></p>
<p>匹配所有远程仓库，使用localhost的除外，使用file://协议的除外。也就是说，匹配所有不在本机上的远程仓库。</p>
<p>3.<mirrorOf>repo1,repo2</mirrorOf></p>
<p>匹配仓库repo1和repo2，使用逗号分隔多个远程仓库。</p>
<p>4.<mirrorOf>*,!repo1</miiroOf></p>
<p>匹配所有远程仓库，repo1除外，使用感叹号将仓库从匹配中排除。</p>
<h3 id="部署构件到nexus"><a href="#部署构件到nexus" class="headerlink" title="部署构件到nexus"></a>部署构件到nexus</h3><p>如果只为代理外部公共仓库，那么nexus的代理仓库就已经完全能够满足需求了。对于宿主仓库来说，主要作用是存储组织内部的或者一些无法从公共仓库中获得的第三方构件。</p>
<p>使用maven部署构件至nexus，具体配置如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;distributionManagement&gt;</span><br><span class="line">  &lt;repository&gt;</span><br><span class="line">    &lt;id&gt;nexus-releases&lt;&#x2F;id&gt;</span><br><span class="line">      &lt;name&gt;Nexus Release Repository&lt;&#x2F;name&gt;</span><br><span class="line">      &lt;url&gt;http:&#x2F;&#x2F;42.121.113.40:8981&#x2F;nexus&#x2F;content&#x2F;repositories&#x2F;releases&#x2F;&lt;&#x2F;url&gt;</span><br><span class="line">  &lt;&#x2F;repository&gt;</span><br><span class="line">  &lt;snapshotRepository&gt;</span><br><span class="line">    &lt;id&gt;nexus-snapshots&lt;&#x2F;id&gt;</span><br><span class="line">    &lt;name&gt;Nexus Snapshot Repository&lt;&#x2F;name&gt;</span><br><span class="line">    &lt;url&gt;http:&#x2F;&#x2F;42.121.113.40:8981&#x2F;nexus&#x2F;content&#x2F;repositories&#x2F;snapshots&#x2F;&lt;&#x2F;url&gt;</span><br><span class="line">  &lt;&#x2F;snapshotRepository&gt;</span><br><span class="line">&lt;&#x2F;distributionManagement&gt;</span><br><span class="line">    </span><br><span class="line"> 所有的release构件部署到Nexus的Releases仓库中。由于部署需要登陆，因为我们在settings.xml中配置对应Repository id的用户名和密码。</span><br><span class="line"></span><br><span class="line">&lt;servers&gt;  </span><br><span class="line">      &lt;server&gt;  </span><br><span class="line">        &lt;id&gt;nexus-releases&lt;&#x2F;id&gt;  </span><br><span class="line">        &lt;username&gt;admin&lt;&#x2F;username&gt;  </span><br><span class="line">        &lt;password&gt;admin123&lt;&#x2F;password&gt;  </span><br><span class="line">      &lt;&#x2F;server&gt;  </span><br><span class="line">      &lt;server&gt;  </span><br><span class="line">        &lt;id&gt;nexus-snapshots&lt;&#x2F;id&gt;  </span><br><span class="line">        &lt;username&gt;admin&lt;&#x2F;username&gt;  </span><br><span class="line">       &lt;password&gt;admin123&lt;&#x2F;password&gt;  </span><br><span class="line">      &lt;&#x2F;server&gt;     </span><br><span class="line"> &lt;&#x2F;servers&gt;  </span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.chenwj.cn/2018-06-08/linux%E5%85%A5%E9%97%A8-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/favicon.ico">
      <meta itemprop="name" content="陈伟杰">
      <meta itemprop="description" content="学习，坚持。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="茄子的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018-06-08/linux%E5%85%A5%E9%97%A8-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/" class="post-title-link" itemprop="url">linux入门-文件系统</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-06-08 00:55:19" itemprop="dateCreated datePublished" datetime="2018-06-08T00:55:19+08:00">2018-06-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-08-21 01:03:09" itemprop="dateModified" datetime="2020-08-21T01:03:09+08:00">2020-08-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>2k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="文件系统"><a href="#文件系统" class="headerlink" title="文件系统"></a>文件系统</h1><p>1.文件系统其实就是组织文件的方法。<br>linux支持多种文件系统，最常用的就是ext2  /ext3<br>linux系统都具有通用的结构，包括：超级快 i节点 数据块 目录块四个部分。<br>ext3相对于ext2的优势时其支持日志功能。<br>磁盘分区分为主分区和扩展分区，一块磁盘最多可以扩展4个主分区。<br>磁盘分区完成后需要进行创建文件系统的操作，最后讲该分区挂载到系统中的某个挂载点才可以使用。</p>
<ol start="2">
<li>fdisk 创建文件系统<br>mount 挂载磁盘   挂载点只能是目录  （暂时挂载）<br>/etc/sftab 设置启动自动挂载 </li>
</ol>
<p>3.磁盘检查<br>当磁盘出现逻辑错误时，可以使用fsck来尝试修复。（但是此时磁盘必须时未挂载的状态，可以使用umount命令进行卸载）<br>umount  /DEVICE/PATH 卸载挂载盘（参数可以时设备路径或者挂载点）<br>使用fsck -t TYPE  /DEVICE/PATH   TYPE可以是ext2 ext3 最后时设备的全路径</p>
<p>4.linux的逻辑卷<br>逻辑卷是使用逻辑卷组管理（LVM）创建出来的设备，LVM时介于硬盘裸设备和文件系统的中间层。<br>物理卷（PV）   卷组（VG）时物理组的集合，逻辑卷(LV)是从PV中划出来的一块逻辑磁盘。<br>5.创建物理卷：（pvcreate pvdisplay）<br>首先提供一个磁盘，然后创建三个分区 fdisk    /dev/sdc<br>fdisk -l 查看是否创建成功<br>修改各个分区的id为8e<br>创建PV  pvcreate /dev/sdc1<br>pvscan 查看系统中的PV，pvdisplay可以显示更详细的信息。</p>
<p>6.创建并查询卷组（vgcreate  vgdisplay）<br>创建卷组：vgcreate VG_NAME DEVICE1   DEVICE2  </p>
<p>7.扩容卷组（vgextend）<br>扩展卷组：vgextend VG_NAME DEVICE1 DEVICE2</p>
<p>8.创建逻辑卷（lvcreate lvdisplay）<br>有了卷组就可以创建逻辑卷 lvcreate  -L SIZE -n LV_NAME VG_NAME    -L制定逻辑卷的大小size表示具体逻辑卷的大小 -n表示逻辑卷的名称</p>
<ol start="9">
<li>创建文件系统并挂载<br>逻辑卷和使用福利分区一样，需要先创建文件系统  挂载后才能被系统使用。<br>创建文件系统    mkfs.ext3 /dev/first_VG/first_LV<br>创建一个挂载点  mkdir /root/newLV<br>挂载 mount  /dev/first_VG/first_LV/root/newLV</li>
</ol>
<p>10.硬链接<br>在linux系统中，所有的文件都会有一个编号，成为索引节点。多个文件名指向同一索引节点，这种链接称为硬链接。<br>删除一个链接不会影响索引节点本身和其他链接，只有最后一个链接被删除时，文件的数据块以及目录的链接才会被释放。<br>硬链接有两个限制：<br>不允许给目录创建硬链接；<br>只有在同一个文件系统的文件才可以创建链接。</p>
<p>ls  -li显示文件<br>4849841 drwxr-xr-x  2 zhuningning zhuningning      4096 Sep 11 20:32 ./<br>第一列表示索引节点<br> 第三列表示源文件的关联数，<br>只有此数为0的时候才会真正的被文件系统删除</p>
<p>创建方法： ln  test.txt  test_ln    为test.txt 文件创建链接</p>
<p>11.软链接<br>是指一个包含了另一个文件路径名的文件，可以指向任意文件或者目录，他也不可以跨文件系统。<br>如果删除了源文件，软链接则会断链。(在linux下，会使用特殊标记表示该文件时断链。)<br>源文件和软链接文件的inode时不一样的，代表他们时2个不一样的文件。<br>创建软链接 ln -s  test.txt  test_ln.txt</p>
<h1 id="字符处理"><a href="#字符处理" class="headerlink" title="字符处理"></a>字符处理</h1><p>1.管道：它时一个固定大小的缓冲区，该缓冲区的大小为一字节。<br>2.它可以把一个命令的输入内容当做下一个命令的输入内容，两个命令之间只需要使用管道符  “|” 连接即可。<br>3. 比如：<br>ls -l  /etc/init.d/ |more (第一个命令的输入作为第二个命令的输入)<br>4.grep是基于行的文本搜索工具，<br>参数：<br>-i 不区分大小写<br>-c 统计包含匹配的行数<br>-n 输出行号<br>-v反向匹配</p>
<p>5.sort 对输出内容直接排序<br>参数<br>-n 采用数字排序<br>-t 指定分隔符<br>-k 指定第几行<br>-r 反向排序</p>
<p>cat  sort.txt  | sort<br>默认按照每行的第一个字母进行排序<br>a:4<br>b:3<br>c:2<br>d:1<br>e:5<br>f:11</p>
<p>cat sort.txt |sort -t “:” -k 2<br>d:1<br>f:11<br>c:2<br>b:3<br>a:4<br>e:5</p>
<p>6.uniq 删除连续的完全一致的行<br>参数：<br>-i 忽略大小写<br>-c 计算重复行数<br>cat uniq.txt |uniq<br>abc<br>123<br>abc<br>123<br>cat uniq.txt |sort|uniq -c<br> 2 123<br>          2 abc</p>
<p>7.使用cut截取文本<br>cut  -f 指定的行  -d ‘分隔符’<br>cat /etc/passwd |cut -f1 -d ‘:’</p>
<p>cut -c 指定列的字符<br>cat /etc/passwd |cut -c1-5,7-10</p>
<p>8 split 分割文件</p>
<p>9 paste合并文件</p>
<p>10.split</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.chenwj.cn/2018-06-01/linux%E5%85%A5%E9%97%A8-%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/favicon.ico">
      <meta itemprop="name" content="陈伟杰">
      <meta itemprop="description" content="学习，坚持。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="茄子的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018-06-01/linux%E5%85%A5%E9%97%A8-%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86/" class="post-title-link" itemprop="url">linux入门-文件管理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-06-01 00:52:17" itemprop="dateCreated datePublished" datetime="2018-06-01T00:52:17+08:00">2018-06-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-08-21 01:03:09" itemprop="dateModified" datetime="2020-08-21T01:03:09+08:00">2020-08-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>3.3k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>3 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="文件和目录管理"><a href="#文件和目录管理" class="headerlink" title="文件和目录管理"></a>文件和目录管理</h1><p>1.FHS(文件系统层次标准)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">bin 常见的用户指令</span><br><span class="line">&#x2F;boot 内核和启动文件</span><br><span class="line">&#x2F;dev 设备文件</span><br><span class="line">&#x2F;etc 系统和服务的配置文件</span><br><span class="line">&#x2F;home 系统默认的普通用户的家目录</span><br><span class="line">&#x2F;lib 系统的函数库目录</span><br><span class="line">&#x2F;lost+found ext3文件系统需要的目录，用于磁盘检查</span><br><span class="line">&#x2F;mnt 系统加载文件系统时常用的挂载点</span><br><span class="line">&#x2F;opt 第三方软件安装目录</span><br><span class="line">&#x2F;proc 虚拟文件系统</span><br><span class="line">&#x2F;root root用户的家目录</span><br><span class="line">&#x2F;sbin 存放系统管理命令</span><br><span class="line">&#x2F;tmp 临时文件的存放目录</span><br><span class="line">&#x2F;usr 存放与用户直接相关的文件和目录</span><br><span class="line">&#x2F;media 系统用来挂载光驱等临时文件系统的挂载点</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>2.绝对路径</p>
<p>  绝对路径是以‘/’开头的路径</p>
<p>  pwd 查看当前文件所在的路径</p>
<p>3.特殊目录</p>
<p>每个目录下都有两个文件 （.）(..) 所有以.开始的文件都是隐藏文件 </p>
<p>./代表当前目录 ../代表上层目录</p>
<p>使用ls -la可以看到隐藏文件</p>
<p>4.相对路径</p>
<p>   cd ..进入上层目录   cd / 进入根目录</p>
<p>5.文件的操作</p>
<p>1）创建文件 touch test.txt  如果创建时该文件已经存在，则不会改变文件的内容，会改变文件的创建时间</p>
<p>2）删除文件 rm  test.txt 然后会提示 输入y 确定删除，输入n 反悔</p>
<p>3）移动文件 mv test.txt  /home/chen  后面带有两个参数 第一个时要被移动的文件 第二个参数要移动到的目录； 如果第二个参数是文件名字 则表示重命名操作</p>
<p>4）查看文件 cat  test.txt    如果带一个参数cat -n test.txt  则会显示文件行号</p>
<p>5）查看文件的头部 head -n 100 test.txt  显示文件的前100行</p>
<p>6）查看文件的尾部 tail -n 100 test.txt   更重要的可以使用 tail -f test.txt 动态的追踪文件的尾部 </p>
<p>7）dos格式的文本转换成unix格式的文本 dos2unix</p>
<p>6.目录的相关操作</p>
<ol>
<li><p>进入目录 cd    change directory的缩写</p>
</li>
<li><p>创建目录 mkdir  test/      可以使用-p 参数一次创建一个目录和其子目录  mkdir  -p  dir1/dir2</p>
</li>
<li><p>删除目录 rm  如果目录不为空，则需要先删除目录中的文件。或者可以使用rm -r 删除 ，而rm -rf，则时强制无提示的删除目录以及目录下的文件</p>
</li>
</ol>
<p>4)复制文件或者目录 cp 第一个参数是要复制的源文件，第二个是要复制到的目录或者复制后的文件名字。</p>
<p>cp test.txt  test2.txt (改名字) </p>
<p>cp  test.txt  /temp/ (复制到temp目录下不改名字)  </p>
<p>cp  test.txt  /temp/test2.txt (复制到temp目录下改名字)</p>
<p>复制目录则需要加 -r      cp  -r dir1  dir2</p>
<p>5)文件的时间戳 使用touch命令可以修改文件的时间戳</p>
<p>7.权限含义详解：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">drwxrwxr-x  2 zhuningning zhuningning 4096 Sep 11 23:21 dir1&#x2F;</span><br><span class="line"></span><br><span class="line">权限分为三种： r 代表可读，用4表示。 w 代表可写，用2表示。 x 代表可执行，用1表示。 </span><br><span class="line">-rw-r--r--  的解释如下, ：</span><br><span class="line">第一位的‘-’ 代表文件类型。 【&#39;d&#39; 代表目录，&#39;|&#39; 代表链接 ，‘-’代表普通文件】。</span><br><span class="line">第二位到第四位的‘rw-’，代表该文件的所有者对该文件的权限。</span><br><span class="line">第五位到第七位的‘r--’，代表该文件所在的组的其他用户对该文件的权限。</span><br><span class="line">第八位到第十位的‘r--’，代表其他组的用户对该文件的权限。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">chmod命令：使用例： chmod 760 目录&#x2F;文件，</span><br><span class="line">意思是 给该目录&#x2F;文件的所有者对该目录&#x2F;文件赋予rwx权限，给该目录&#x2F;文件所在的组的其他用户对该目录&#x2F;文件赋予rw-权限，给其他组的用户对该目录&#x2F;文件赋予---权限。</span><br><span class="line"> </span><br><span class="line">chmod 755 abc ：赋予abc权限rwxr-xr-x。</span><br><span class="line">chmod u&#x3D;rwx,g&#x3D;rx,o&#x3D;rx abc ：同上 u&#x3D;用户权限  g&#x3D;组权限 o&#x3D;不同组其他用户权限。</span><br><span class="line">chmod u-x,g+w abc ：给abc去除用户执行的权限，增加组写的权限。-表示去除  +表示增加</span><br><span class="line">chmod a+r abc ：给所有用户添加读的权限。</span><br><span class="line">chmod -R 754 abc ：给abd目录以及目录下的文件赋予权限754</span><br><span class="line"> </span><br><span class="line">改变拥有者（chown）和用户组（chgrp）命令：</span><br><span class="line">chown xiaoming abc ：改变abc的拥有者为xiaoming。</span><br><span class="line">chgrp root abc ：改变abc所属的组为root。</span><br><span class="line">chown root .&#x2F;abc ： 改变abc目录的所有者是root。</span><br><span class="line">chown -R root .&#x2F;abc ：改变abc目录及其下面的所有目录和文件的所有者是root。参数-R 是递归的意思。</span><br><span class="line"></span><br><span class="line">文件的隐藏属性：lsattr test.txt     chattr +a test.txt   表示文件不可以被删除，即使root权限也不可以；  chattr +i test.txt   表示文件不可以被删除&#x2F;修改，即使root权限也不可以</span><br><span class="line">suid权限 （u权限）普通用户可以使用root的身份来执行命令 chmod u+s  files 来授权</span><br><span class="line">sgid 权限（g权限） 组可以使用root身份来执行名  chmod g+s 来授权</span><br><span class="line">sticky权限（s权限），只能使用在目录上，设置了这种权限，任何用户可以创建和修改文件，但是只有文件的创建者和root用户可以删除自己的文件 chmod o+t  dir </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>8.系统创建文件和目录的默认权限</p>
<p>umask（遮罩值） 对于uid大于 99的 umask为022 否则为002 </p>
<p>文件的默认权限是 666 目录的权限是777 </p>
<p>root用户的文件权限是644 目录权限是 755</p>
<p>普通用户的文件权限是664 目录是775</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">给用户组添加SGID权限:</span><br><span class="line">chmod g+s somefile</span><br><span class="line"></span><br><span class="line">给用户添加SUID权限</span><br><span class="line">chmod u+s somefile</span><br></pre></td></tr></table></figure>
<p>Sticky权限还能用于设置在目录上,设置了这种权限的目录,任何用户都可以在该目录创建或者修改文件,但是该文件的创建者和root用户可以删除这个文件</p>
<p>9.查看文件类型（可以显示文件的特殊属性）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">file  &#x2F;tmp&#x2F;</span><br><span class="line">该目录是一个拥有sticky属性的目录  &#x2F;tmp&#x2F;: sticky, directory</span><br><span class="line"></span><br><span class="line">file  &#x2F;etc&#x2F;passwd</span><br><span class="line">该文件是一个ASCII编码的文本文件  &#x2F;etc&#x2F;passwd: ASCII text</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ol start="10">
<li>查找文件</li>
</ol>
<p>1)一般查找 find PATH -name FILENAME   //在某个路径下查找文件</p>
<p>2）locate fileName  //该命令依赖于一个数据库，一般执行命令之前需要执行updatedb命令来更新数据库</p>
<p>3）which/whereis  fileName  //该命令从系统的path变量所定义的目录中找到可执行文件的绝对路径 ，而whereis除此之外还可以还能找到其相关的二进制文件</p>
<p>11.压缩文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">gzip和gunzip 用来压缩和解压单个文件</span><br><span class="line"></span><br><span class="line">tar不仅可以打包文件，还可以讲整个目录中的全部文件整合成一个包，整合包的同时还可以使用gzip进行压缩。可以使用.tar.gz作为后缀简写为.tgz</span><br><span class="line"></span><br><span class="line">tar -zcvf boot.tgz &#x2F;boot </span><br><span class="line"></span><br><span class="line">-z代表使用gzip进行压缩，-c表示创建压缩文件 -v表示是显示当前被压缩的文件，-f代表使用文件名字 也就是boot.tgz</span><br><span class="line"></span><br><span class="line">tar -zxvf  boot.tgz -C &#x2F;tmp  </span><br><span class="line"> -x表示解压的意思  -C 执行解压到&#x2F;tmp命令</span><br><span class="line"> </span><br><span class="line">bzip2 fileName  进行压缩</span><br><span class="line">-z参数进行强制压缩   -d进行强制解压</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>12 .查看文件的大小</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ll -h test.txt</span><br><span class="line">-rwxrwxrwx 1 zhuningning zhuningning 152M Feb  7  2017 crossover_16.1.0-1.deb*</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.chenwj.cn/2018-05-22/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BC%96%E7%A8%8B%E6%8A%80%E6%9C%AF%E6%A0%B8%E5%BF%83-%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%85%B6%E5%AE%83/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/favicon.ico">
      <meta itemprop="name" content="陈伟杰">
      <meta itemprop="description" content="学习，坚持。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="茄子的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018-05-22/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BC%96%E7%A8%8B%E6%8A%80%E6%9C%AF%E6%A0%B8%E5%BF%83-%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%85%B6%E5%AE%83/" class="post-title-link" itemprop="url">多线程编程技术核心-多线程其它</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-05-22 00:42:31" itemprop="dateCreated datePublished" datetime="2018-05-22T00:42:31+08:00">2018-05-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-08-21 01:03:09" itemprop="dateModified" datetime="2020-08-21T01:03:09+08:00">2020-08-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">多线程</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>989</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="线程的状态"><a href="#线程的状态" class="headerlink" title="线程的状态"></a>线程的状态</h1><p>线程状态state枚举类</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">NEW, &#x2F;&#x2F; 实例化后,未执行start方法的</span><br><span class="line">RUNNABLE,&#x2F;&#x2F;线程进入运行的状态</span><br><span class="line">BLOCKED,&#x2F;&#x2F;受阻塞并等待某个监视器锁的线程处于这种状态</span><br><span class="line">WAITING,&#x2F;&#x2F;无期限地等待另一个线程来执行某一特性操作的线程处于这种状态</span><br><span class="line">TIMED_WAITING,&#x2F;&#x2F;等待另一个线程来执行取决于指定等待时间的操作处于这种状态</span><br><span class="line">TERMINATED，&#x2F;&#x2F;已退出的线程处于这种状态</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/images/thread/%E7%BA%BF%E7%A8%8B%E6%96%B9%E6%B3%95%E4%B8%8E%E7%8A%B6%E6%80%81%E5%85%B3%E7%B3%BB%E5%9B%BE.png" alt="线程方法与状态关系图"></p>
<h2 id="验证-new-runnable和terminated状态"><a href="#验证-new-runnable和terminated状态" class="headerlink" title="验证 new runnable和terminated状态"></a>验证 new runnable和terminated状态</h2><p>new状态是线程实例化后还从未执行start()方法的状态，runnable状态是线程进入运行的转改，terminated状态是线程被销毁时的状态</p>
<h1 id="线程组的使用"><a href="#线程组的使用" class="headerlink" title="线程组的使用"></a>线程组的使用</h1><p>可以把线程归属到某一个线程组中。线程组中可以有线程对象，也可以有线程组，组中还可以有线程。</p>
<p>线程组的作用是，可以批量的管理线程或线程组对象，有效地对线程或线程组对象进行组织。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line">    线程组的创建和组内的线程批量停止</span><br><span class="line"> * @author :  chen weijie</span><br><span class="line"> * @Date: 2018-05-30 00:50</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class Run &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        ThreadGroup threadGroup &#x3D; new ThreadGroup(&quot;我的线程组&quot;);</span><br><span class="line"></span><br><span class="line">        try &#123;</span><br><span class="line">            for (int i &#x3D; 0; i &lt; 10; i++) &#123;</span><br><span class="line">                MyThread thread &#x3D; new MyThread(threadGroup, &quot;线层：&quot; + i);</span><br><span class="line">                thread.start();</span><br><span class="line">            &#125;</span><br><span class="line">            Thread.sleep(5000);</span><br><span class="line">            threadGroup.interrupt();</span><br><span class="line">            System.out.println(&quot;调用了interrupt方法。&quot;);</span><br><span class="line">        &#125; catch (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="陈伟杰"
      src="/images/favicon.ico">
  <p class="site-author-name" itemprop="name">陈伟杰</p>
  <div class="site-description" itemprop="description">学习，坚持。</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">74</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">26</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">68</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/chenwj1103" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;chenwj1103" rel="noopener" target="_blank"><i class="github fa-fw"></i>GitHub</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">陈伟杰</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">638k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">9:40</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
